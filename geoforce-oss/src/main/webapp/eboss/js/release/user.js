var urls={};urls.server="http://192.168.15.174/egispboss";urls.user={};urls.user.server=urls.server+"/userService?";urls.user.add=urls.user.server+"method=addUser&callbacks=?";urls.user.search=urls.user.server+"method=queryUserList&callbacks=?";urls.user.update=urls.user.server+"method=updateUser&callbacks=?";urls.user.remove=urls.user.server+"method=deleteUserInfo&callbacks=?";urls.user.detail=urls.user.server+"method=queryUserInfo&callbacks=?";urls.product={};urls.product.server=urls.server+"/moduleService?";urls.product.add=urls.product.server+"method=addModule&callbacks=?";urls.product.search=urls.product.server+"method=queryServiceList&callbacks=?";urls.product.update=urls.product.server+"method=updateModule&callbacks=?";urls.product.detail=urls.product.server+"method=queryModule&callbacks=?";urls.product.remove=urls.product.server+"method=deleteModule&callbacks=?";urls.order={};urls.order.server=urls.server+"/orderService?";urls.order.add=urls.order.server+"method=addOrder&callbacks=?";urls.order.search=urls.order.server+"method=queryOrderList&callbacks=?";urls.order.detail=urls.order.server+"method=queryOrderDetails&callbacks=?";urls.order.audit=urls.order.server+"method=auditOrder&callbacks=?";urls.order.remove=urls.order.server+"method=deleteOrder&callbacks=?";urls.order.update=urls.order.server+"method=updateOrder&callbacks=?";urls.order.itemupdate=urls.order.server+"method=updateOrderItem&callbacks=?";urls.order.itemremove=urls.order.server+"method=deleteOrderItem&callbacks=?";urls.permission={};urls.permission.server=urls.server+"/privilegeService?";urls.permission.add=urls.permission.server+"method=addPrivilege&callbacks=?";urls.permission.search=urls.permission.server+"method=queryPrivilegeList&callbacks=?";urls.permission.detail=urls.permission.server+"method=queryPrivilegeDetail&callbacks=?";urls.permission.update=urls.permission.server+"method=updatePrivilege&callbacks=?";urls.permission.remove=urls.permission.server+"method=deletePrivilege&callbacks=?";urls.role={};urls.role.server=urls.server+"/roleService?";urls.role.add=urls.role.server+"method=addRole&callbacks=?";urls.role.search=urls.role.server+"method=queryRoleList&callbacks=?";urls.role.update=urls.role.server+"method=updateRole&callbacks=?";urls.role.addper=urls.role.server+"method=addPrivileges&callbacks=?";urls.role.delper=urls.role.server+"method=removePrivileges&callbacks=?";urls.role.updateper=urls.role.server+"method=addOrRmPrivileges&callbacks=?";urls.role.remove=urls.role.server+"method=deleteRole&callbacks=?";urls.employee={};urls.employee.server=urls.server+"/staffService?";urls.employee.add=urls.employee.server+"method=addStaff&callbacks=?";urls.employee.search=urls.employee.server+"method=queryStaffList&callbacks=?";urls.employee.detail=urls.employee.server+"method=queryStaffDetail&callbacks=?";urls.employee.update=urls.employee.server+"method=updateStaff&callbacks=?";urls.employee.updatepwd=urls.employee.server+"method=changePassword&callbacks=?";urls.employee.updaterole=urls.employee.server+"method=addOrRmRoles&callbacks=?";urls.employee.login=urls.employee.server+"method=login&callbacks=?";urls.employee.remove=urls.employee.server+"method=deleteStaff&callbacks=?";var pageSize=10;var user={};user.permissions=[];String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};function getWindowHeight(){if(navigator.appName=="Microsoft Internet Explorer"){return document.compatMode=="CSS1Compat"?document.documentElement.clientHeight:document.body.clientHeight}else{return self.innerHeight}}function getWindowWidth(){if(navigator.appName=="Microsoft Internet Explorer"){return document.compatMode=="CSS1Compat"?document.documentElement.clientWidth:document.body.clientWidth}else{return self.innerWidth}}var timer_popup=null;function showPopover(a){$("#popover_content").html(a);$("#popover_result").css("display","block");if(timer_popup){clearTimeout(timer_popup)}timer_popup=setTimeout("hidePopover();",3500)}function hidePopover(){if(timer_popup){clearTimeout(timer_popup)}$("#popover_result").css("display","none")}function showMaskLoading(){$(".overlay").css({display:"block",opacity:"0.8"});$(".loadingbox").stop(true).animate({"margin-top":"300px",opacity:"1"},200)}function hideMaskLoading(){$(".loadingbox").stop(true).animate({"margin-top":"250px",opacity:"0"},400);$(".overlay").css({display:"none",opacity:"0"})}jQuery.cookie=function(b,j,m){if(typeof j!="undefined"){m=m||{};if(j===null){j="";m.expires=-1}var e="";if(m.expires&&(typeof m.expires=="number"||m.expires.toUTCString)){var f;if(typeof m.expires=="number"){f=new Date();f.setTime(f.getTime()+(m.expires*24*60*60*1000))}else{f=m.expires}e="; expires="+f.toUTCString()}var l=m.path?"; path="+m.path:"";var g=m.domain?"; domain="+m.domain:"";var a=m.secure?"; secure":"";document.cookie=[b,"=",encodeURIComponent(j),e,l,g,a].join("")}else{var d=null;if(document.cookie&&document.cookie!=""){var k=document.cookie.split(";");for(var h=0;h<k.length;h++){var c=jQuery.trim(k[h]);if(c.substring(0,b.length+1)==(b+"=")){d=decodeURIComponent(c.substring(b.length+1));break}}}return d}};function createHeader(){var a="";a+='<div class="inner">';a+="   <>";a+="</div>"}function setPage(k,b,h){var e=pageSize;var g="";var a=Math.ceil(k/e);if(b==0){g+='<li class="disabled" title="第一页"><a href="javascript:;">&laquo;</a></li>'}else{g+='<li  title="第一页"><a href="javascript:setpageno('+h+", "+0+');">&laquo;</a></li>'}if(b<3){for(var f=1;(f<=5&&f<=a&&b<=a);f++){if(f!==(b+1)){g+='<li><a href="javascript:setpageno('+h+", "+(f-1)+');">'+f+"</a></li>"}else{g+='<li class="active"><a href="javascript:;">'+f+"</a></li>"}}}else{var j=((a-b>3)?3:a-b);var d=5-j-1;var l=(b-d>0?b-d:1);var c=b+j;for(f=l;f<=c;f++){if(f!==(b+1)){g+='<li><a href="javascript:setpageno('+h+", "+(f-1)+');">'+f+"</a></li>"}else{g+='<li class="active"><a href="javascript:;">'+f+"</a></li>"}}}if(b==(a-1)){g+='<li  title="最后一页" class="disabled"><a href="javascript:;">&raquo;</a></li>'}else{g+='<li  title="最后一页"><a href="javascript:setpageno('+h+", "+(a-1)+');">&raquo;</a></li>'}return g}function setpageno(d,b){var a=$("#"+d);a.attr("page",b);var c=a.attr("data-target");switch(c){case"user":searchUsers();break;case"product":searchProduct();break;case"permission":searchPermissions();break;case"order":searchOrders();break;case"employee":searchEmployees();break;case"role":searchRoles();break;case"key":break;case"userforpopup":getUserListForPopup();break}}function HashMap(){this.size=0;this.entry=new Object();this.put=function(a,b){if(!this.containsKey(a)){this.size++}this.entry[a]=b};this.get=function(a){return this.containsKey(a)?this.entry[a]:null};this.getkey=function(a){for(var b in this.entry){if(this.entry[b]==a){return b}}return null};this.remove=function(a){if(this.containsKey(a)&&(delete this.entry[a])){this.size--}};this.containsKey=function(a){return(a in this.entry)};this.containsValue=function(a){for(var b in this.entry){if(this.entry[b]==a){return true}}return false},this.clear=function(){this.size=0;this.entry={}},this.values=function(){var a=new Array();for(var b in this.entry){a.push(this.entry[b])}return a}}var map_status_product=new HashMap();var map_status_product_key=new HashMap();var map_status_permission=new HashMap();$(document).ready(function(){initcss();$(window).resize(function(){initcss()});$.ajax({type:"GET",async:true,url:urls.employee.detail,dataType:"jsonp",success:function(a){if(a&&a.success&&a.result){initUser(a)}else{showPopover("登录已过有效期，请重新登录。");setTimeout("location.href='../'",1500)}}})});function initUser(f){var d=f.result;user=d;$("#span_me_employee_username").html(d.username);$("#nav_login_username").html(d.username);$("#span_me_employee_realName").html(d.realName);$("#span_me_employee_status").html(d.status);$("#span_me_employee_gender").html(d.gender);$("#span_me_employee_email").html(d.email);$("#span_me_employee_department").html(d.department?d.department:"无");$("#span_me_employee_position").html(d.position);$("#span_me_employee_mobilePhone").html(d.mobilePhone);$("#span_me_employee_phone").html(d.phone?d.phone:"无");var a=d.roleNames?d.roleNames.length:0;var c="";if(a>0){for(var b=a;b--;){c+=d.roleNames[b];if(b!==0){c+=","}}}$("#span_me_employee_roles").html(c?c:"无");a=d.privilegeCodes?d.privilegeCodes:0;c="";if(a>0){for(var b=a;b--;){c+=d.privilegeCodes[b];if(b!==0){c+=","}}}initPage()}function initPage(){$("input").placeholder();$.AutoComplete('input[name="email"]');$.PopupUserList("#txt_order_userid");map_status_product.put("0","RELEASE");map_status_product.put("1","BETA");map_status_product.put("2","REVOCATION");map_status_product.put("3","OTHER");map_status_product_key.put("RELEASE","0");map_status_product_key.put("BETA","1");map_status_product_key.put("REVOCATION","2");map_status_product_key.put("OTHER","3");map_status_permission.put("USING","0");map_status_permission.put("FORBIDDEN","1");map_status_permission.put("ABANDON","1");dealPermissions();bindClicks()}function dealPermissions(){var a=user.privilegeCodes;var b=jQuery.inArray("usermge",a);var c="";if(b!==-1){c+="<li>";c+='	<div class="pointer">';c+='		<div class="arrow"></div>';c+='   	<div class="arrow_border"></div>';c+=" 	</div>";c+=' 	<a href="javascript:;" id="nav_a_usermanage" data-target="user" >';c+='   	<span class="glyphicon glyphicon-user btn-lg" style="padding: 5px 10px;"></span> 用户管理';c+=" 	</a>";c+="</li>"}b=jQuery.inArray("keymge",a);if(b!==-1){c+="<li>";c+='	<div class="pointer">';c+='		<div class="arrow"></div>';c+='   	<div class="arrow_border"></div>';c+=" 	</div>";c+=' 	<a href="javascript:;"  id="nav_a_keymanage" data-target="key">';c+='   	<span class="glyphicon glyphicon-tag btn-lg" style="padding: 5px 10px;"></span> key管理';c+=" 	</a>";c+="</li>"}b=jQuery.inArray("productmge",a);if(b!==-1){c+="<li>";c+='	<div class="pointer">';c+='		<div class="arrow"></div>';c+='   	<div class="arrow_border"></div>';c+=" 	</div>";c+=' 	<a href="javascript:;"  id="nav_a_productmanage" data-target="product" >';c+='   	<span class="glyphicon glyphicon-gift btn-lg" style="padding: 5px 10px;"></span> 产品管理';c+=" 	</a>";c+="</li>"}b=jQuery.inArray("ordermge",a);if(b!==-1){c+="<li>";c+='	<div class="pointer">';c+='		<div class="arrow"></div>';c+='   	<div class="arrow_border"></div>';c+=" 	</div>";c+=' 	<a href="javascript:;"  id="nav_a_ordermanage" data-target="order"  >';c+='   	<span class="glyphicon glyphicon-file btn-lg" style="padding: 5px 10px;"></span> 订单管理';c+=" 	</a>";c+="</li>"}b=jQuery.inArray("permissionmge",a);if(b!==-1){c+="<li>";c+='	<div class="pointer">';c+='		<div class="arrow"></div>';c+='   	<div class="arrow_border"></div>';c+=" 	</div>";c+=' 	<a href="javascript:;"  id="nav_a_permissionmanage" data-target="permission"  >';c+='   	<span class="glyphicon glyphicon-cog btn-lg" style="padding: 5px 10px;"></span> 权限管理';c+=" 	</a>";c+="</li>"}b=jQuery.inArray("rolemge",a);if(b!==-1){c+="<li>";c+='	<div class="pointer">';c+='		<div class="arrow"></div>';c+='   	<div class="arrow_border"></div>';c+=" 	</div>";c+=' 	<a href="javascript:;"  id="nav_a_rolemanage" data-target="role" >';c+='   	<span class="glyphicon glyphicon-credit-card btn-lg" style="padding: 5px 10px;"></span> 角色管理';c+=" 	</a>";c+="</li>"}b=jQuery.inArray("rolemge",a);if(b!==-1){c+="<li>";c+='	<div class="pointer">';c+='		<div class="arrow"></div>';c+='   	<div class="arrow_border"></div>';c+=" 	</div>";c+=' 	<a href="javascript:;"  id="nav_a_employeemanage" data-target="employee" >';c+='   	<span class="glyphicon glyphicon-star-empty btn-lg" style="padding: 5px 10px;"></span> 员工管理';c+=" 	</a>";c+="</li>"}$("#nav_left_menu").append(c);b=jQuery.inArray("usermge_add",a);if(b!==-1){$("#btn_modal_adduser").css("display","")}b=jQuery.inArray("usermge_search",a);if(b==-1){$("#div_usermanage").html("")}var d=$("#thead_users");b=jQuery.inArray("usermge_detail",a);if(b!==-1){d.append("<td>详情</td>")}b=jQuery.inArray("usermge_update",a);if(b!==-1){d.append("<td>修改</td>")}b=jQuery.inArray("usermge_remove",a);if(b!==-1){d.append("<td>删除</td>")}b=jQuery.inArray("productmge_add",a);if(b!==-1){$("#btn_modal_add_product").css("display","")}b=jQuery.inArray("productmge_search",a);if(b===-1){$("#div_productmanage").html("")}d=$("#thead_products");b=jQuery.inArray("productmge_detail",a);if(b!==-1){d.append("<td>详情</td>")}b=jQuery.inArray("productmge_update",a);if(b!==-1){d.append("<td>修改</td>")}b=jQuery.inArray("productmge_remove",a);if(b!==-1){d.append("<td>删除</td>")}b=jQuery.inArray("ordermge_add",a);if(b!==-1){$("#btn_modal_addorder").css("display","")}b=jQuery.inArray("ordermge_search",a);if(b===-1){$("#div_ordermanage").html("")}d=$("#thead_orders");b=jQuery.inArray("ordermge_detail",a);if(b!==-1){d.append("<td>详情</td>")}b=jQuery.inArray("ordermge_update",a);if(b!==-1){d.append("<td>修改</td>")}b=jQuery.inArray("ordermge_audit",a);if(b!==-1){d.append("<td>审核</td>")}b=jQuery.inArray("ordermge_remove",a);if(b!==-1){d.append("<td>删除</td>")}b=jQuery.inArray("permissionmge_add",a);if(b!==-1){$("#btn_modal_addper").css("display","")}b=jQuery.inArray("permissionmge_search",a);if(b===-1){$("#div_permissionmanage").html("")}d=$("#thead_pers");b=jQuery.inArray("permissionmge_update",a);if(b!==-1){d.append("<td>修改</td>")}b=jQuery.inArray("permissionmge_remove",a);if(b!==-1){d.append("<td>删除</td>")}b=jQuery.inArray("rolemge_add",a);if(b!==-1){$("#btn_modal_addrole").css("display","")}b=jQuery.inArray("rolemge_search",a);if(b===-1){$("#div_rolemanage").html("")}d=$("#thead_role");b=jQuery.inArray("rolemge_update",a);if(b!==-1){d.append("<td>修改</td>")}b=jQuery.inArray("rolemge_update_permission",a);if(b!==-1){d.append("<td>修改权限</td>")}b=jQuery.inArray("rolemge_remove",a);if(b!==-1){d.append("<td>删除</td>")}b=jQuery.inArray("employeemge_add",a);if(b!==-1){$("#btn_modal_addemployee").css("display","")}b=jQuery.inArray("employeemge_search",a);if(b===-1){$("#div_employeemanage").html("")}d=$("#thead_employee");b=jQuery.inArray("employeemge_detail",a);if(b!==-1){d.append("<td>详情</td>")}b=jQuery.inArray("employeemge_update",a);if(b!==-1){d.append("<td>修改</td>")}b=jQuery.inArray("employeemge_role",a);if(b!==-1){d.append("<td>赋角色</td>")}b=jQuery.inArray("employeemge_pwd",a);if(b!==-1){d.append("<td>重置密码</td>")}b=jQuery.inArray("employeemge_remove",a);if(b!==-1){d.append("<td>删除</td>")}}function initcss(){var b=getWindowHeight();var a=b-48-46;$(".content").height(a);$(".content-right").width($(".content").width()-$(".sliderbar-nav").width());$(".overlay").css({height:$(document).height()})}function bindClicks(){$(".dashboard-menu > li > a").click(function(){var e="div_"+$(this).attr("id").replace("nav_a_","");var d=$("#"+e);if(d.css("display")!=="none"){return}$(".dashboard-menu > li").removeClass("active");$(this).parent("li").addClass("active");$(".tab-contentbody").css("display","none");d.fadeIn("300");var c=$(this).attr("data-target");var b=-1,a=user.privilegeCodes;switch(c){case"user":b=jQuery.inArray("usermge_search",a);if(b!==-1){searchUsers()}break;case"product":b=jQuery.inArray("productmge_search",a);if(b!==-1){searchProduct()}break;case"permission":b=jQuery.inArray("permissionmge_search",a);if(b!==-1){searchPermissions()}break;case"order":b=jQuery.inArray("ordermge_search",a);if(b!==-1){searchOrders()}break;case"employee":b=jQuery.inArray("employeemge_search",a);if(b!==-1){searchEmployees()}break;case"role":b=jQuery.inArray("rolemge_search",a);if(b!==-1){searchRoles()}break;case"key":break}});$("#div_resetpassword > input").bind("keyup",function(a){a=a?a:window.event;if(a.keyCode==13){verifypassword()}});$("#btn_resetpassword").click(resetPassword);$("#txt_user_name").blur(verfyUsername);$("#txt_user_password").blur(verifyUserPassword);$("#txt_user_passwordsure").blur(verifyUserPasswordSure);$("#txt_user_email").blur(verifyEmail);$("#txt_user_realname").blur(verifyRealname);$("#txt_user_mobile").blur(verifyMobile);$("#txt_user_company").blur(verifyCompany);$("#txt_search_user").bind("keyup",function(a){a=a?a:window.event;if(a.keyCode==13){$("#pager_users").attr("page","0");searchUsers()}});$("#select_search_user_status").change(function(){$("#pager_users").attr("page","0");searchUsers()});$("#btn_search_user").click(function(){$("#pager_users").attr("page","0");searchUsers()});$("#modal_add_user").on("show.bs.modal",resetModalAddUser);$("#txt_product_name").blur(verifyProductName);$("#txt_product_price").blur(verifyProductPrice);$("#txt_product_url").blur(verifyProductUrl);$("#txt_product_code").blur(verifyProductCode);$("#txt_product_icon_url").blur(verifyProductIconUrl);$("#btn_add_product").click(function(){var a=$("#modal_add_product").attr("current");if(a=="0"){addProduct()}else{if(a=="1"){updateProduct()}}});$("#txt_search_product").bind("keyup",function(a){a=a?a:window.event;if(a.keyCode==13){$("#pager_products").attr("page","0");searchProduct()}});$("#select_search_product_status").change(function(){$("#pager_products").attr("page","0");searchProduct()});$("#btn_modal_add_product").click(modalAddProduct);$("#btn_search_product").click(function(){$("#pager_products").attr("page","0");searchProduct()});$("#txt_orderdate_start").blur(verifyOrderDateStart);$("#txt_orderdate_end").blur(verifyOrderDateEnd);$("#modal_update_order").on("hide.bs.modal",function(a){$("#pager_orders").attr("page","0");searchOrders()});$("#btn_search_orders").click(function(a){$("#pager_orders").attr("page","0");searchOrders()});$("#modal_add_order").on("show.bs.modal",function(a){searchAllProducts()});$("#modal_add_order").on("hidden.bs.modal",function(a){$("#popup_userlist").hide()});$(".datepicker > input").datepicker({});$("#txt_search_order").bind("keyup",function(a){a=a?a:window.event;if(a.keyCode==13){$("#pager_orders").attr("page","0");searchOrders()}});$("#select_search_order_status").change(function(){$("#pager_orders").attr("page","0");searchOrders()});$("#collapse_update_order").on("show.bs.collapse",function(){var a=$("#collapse_update_orderitem");if(a.css("display")!=="none"){a.collapse("hide")}});$("#collapse_update_orderitem").on("show.bs.collapse",function(){var a=$("#collapse_update_order");if(a.css("display")!=="none"){a.collapse("hide")}});$("#btn_search_permissions").click(function(){$("#pager_permissions").attr("page","0");searchPermissions()});$("#txt_permission_name").blur(verifyPermissionName);$("#txt_permission_code").blur(verifyPermissionCode);$("#txt_permission_url").blur(verifyPermissionUrl);$("#modal_add_permission").on("show.bs.modal",initPermissionPid);$("#txt_search_per").bind("keyup",function(a){a=a?a:window.event;if(a.keyCode==13){$("#pager_permissions").attr("page","0");searchPermissions()}});$("#select_search_per_status").change(function(){$("#pager_permissions").attr("page","0");searchPermissions()});$("#btn_search_roles").click(function(){$("#pager_roles").attr("page","0");searchRoles()});$("#modal_add_role").on("show.bs.modal",initRolePermissions);$("#txt_role_name").blur(verifyRoleName);$("#txt_search_role").bind("keyup",function(a){a=a?a:window.event;if(a.keyCode==13){$("#pager_roles").attr("page","0");searchRoles()}});$("#txt_employee_name").blur(verifyEmployeeName);$("#txt_employee_password").blur(verifyEmployeePwd);$("#txt_employee_passwordsure").blur(verifyEmployeePasswordSure);$("#txt_employee_realname").blur(verifyEmployeeRealname);$("#txt_employee_job").blur(verifyEmployeeJob);$("#txt_employee_email").blur(verifyEmployeeEmail);$("#txt_employee_mobile").blur(verifyEmployeeMobile);$("#btn_search_employee").click(function(){$("#pager_employees").attr("page","0");searchEmployees()});$("#txt_employee_update_job").blur(verifyEmployeeJobUpdate);$("#txt_employee_update_mobile").blur(verifyEmployeeMobileUpdate);$("#txt_employee_update_password").blur(verifyEmployeePwdUpdate);$("#txt_employee_update_passwordsure").blur(verifyEmployeePasswordSureUpdate);$("#modal_add_employee").on("show.bs.modal",resetEmployeeAddModal);$("#txt_search_employee").bind("keyup",function(a){a=a?a:window.event;if(a.keyCode==13){$("#pager_employees").attr("page","0");searchEmployees()}});$("#select_search_employee_status").change(function(){$("#pager_employees").attr("page","0");searchEmployees()})}function logout(){location.href="../"}function resetPassword(){var a=verifypassword();if(a===false){return}}function verifypassword(){var a=false;a=verifyOldPassword();if(a===false){return a}a=verifyNewPassword();if(a===false){return a}a=verifyNewPasswordSure();return a}function verifyOldPassword(){var a=$("#txt_oldpassword").val();if(a===""){showPopover("请输入旧密码");return false}return true}function verifyNewPassword(){var a=$("#txt_newpassword").val();if(a===""){showPopover("请输入新密码");return false}return true}function verifyNewPasswordSure(){var a=$("#txt_newpasswordsure").val();if(a===""){showPopover("请确认新密码");return false}return true}function verifyEmployeeName(){var a=$("#txt_employee_name").val();var e=$("#span_tip_employee_name");var c=/^(?!_)(?!.*?_$)[a-zA-Z]+[a-zA-Z0-9_]*$/;var d=/^[a-zA-Z0-9\_]{4,20}$/;var b=/^\w$|(^ )|( $)/;if(a==""){e.html("请输入用户名");return false}else{if(a=="null"){e.html('用户名不能为"null"');return false}else{if(a.length<4||a.length>20){e.html("用户名的长度要求大于4并且小于20");return false}else{if(!d.test(a)){e.html("用户名不能包含特殊字符");return false}else{if(b.test(a)||a.indexOf(" ")>0){e.html("用户名不能包空格");return false}}}}}e.html("");return true}function verifyEmployeePwd(){var a=$("#txt_employee_password").val();var e=$("#span_tip_employee_password");var d=/^\s*$/;var b=$("#txt_employee_passwordsure").val();var c=$("#span_tip_employee_passwordsure");if(a==""){e.html("请输入密码");return false}else{if(a.length<6||a.length>20){e.html("密码长度必须大于6并小于20");return false}else{if(d.test(a)||a.indexOf(" ")>=0){e.html("密码中不能包含空格");return false}else{if(b!==""&&b!==a){c.html("两次密码输入不一致");return false}}}}e.html("");return true}function verifyEmployeePasswordSure(){var a=$("#txt_employee_passwordsure").val();var c=$("#txt_employee_password").val();var b=$("#span_tip_employee_passwordsure");if(a==""){b.html("请再次确认密码");return false}if(a!==c){b.html("两次密码输入不一致");return false}b.html("");return true}function verifyEmployeeEmail(){var a=$("#txt_employee_email").val();var c=$("#span_tip_employee_email");var b=/[a-zA-Z0-9]+@\w+[\.][a-z]{2,3}$|[a-zA-Z0-9]+@\w+[\.][a-z]{2,3}[\.][a-z]{2,3}$/;if(a==""){c.html("请输入邮箱");return false}if(b.test(a)&&a.split("@").length==2){c.html("");return true}c.html("邮箱格式不正确");return false}function verifyEmployeeJob(){var a=$("#txt_employee_job").val();var b=$("#span_tip_employee_job");if(a===""||a.length===0){b.html("请输入员工职务");return false}b.html("");return true}function verifyEmployeeRealname(){var a=$("#txt_employee_realname").val();var c=$("#span_tip_employee_realname");var b=/^(?!\s)([\u4E00-\u9FA0]+$|^[a-z·\s]+)$/i;if(a==""){c.html("真实姓名不能为空");return false}if(!b.test(a)){c.html("真实姓名只能为中文或者英文");return false}if(a.length<2||a.length>20){c.html("真实姓名长度必须不小于2并且不大于20");return false}c.html("");return true}function verifyEmployeeMobile(){var a=$("#txt_employee_mobile").val();var c=$("#span_tip_employee_mobile");if(a==""){c.html("请填写手机号码");return false}var b=/1[3,5,6,8]\d{9}$/;if(b.test(a)){c.html("");return true}c.html("手机号码只能以13、15、16或18开头，长度为11位");return false}function verifyAddEmployeeInput(){var a=verifyEmployeeName();if(!a){return a}a=verifyEmployeePwd();if(!a){return a}a=verifyEmployeePasswordSure();if(!a){return a}a=verifyEmployeeRealname();if(!a){return a}a=verifyEmployeeEmail();if(!a){return a}a=verifyEmployeeMobile();if(!a){return a}a=verifyEmployeeJob();return a}function addEmployee(){var a=verifyAddEmployeeInput();if(!a){return a}var b=$("[name='employee_sex']").filter(":checked").val();var c={username:$("#txt_employee_name").val(),password:Base64.encode($("#txt_employee_passwordsure").val()),realName:$("#txt_employee_realname").val(),email:$("#txt_employee_email").val(),position:$("#txt_employee_job").val(),sex:b,mobilePhone:$("#txt_employee_mobile").val(),phone:$("#txt_employee_phone").val(),department:$("#txt_employee_department").val()};$.ajax({type:"GET",async:true,url:urls.employee.add,data:c,dataType:"jsonp",success:function(d){if(d&&d.success){showPopover("用户添加成功");$("#modal_add_employee").modal("hide");searchEmployees()}else{showPopover(d.info)}}})}function resetEmployeeAddModal(){$("#txt_employee_name").val("");$("#span_tip_employee_name").html("");$("#txt_employee_password").val("");$("#span_tip_employee_password").html("");$("#txt_employee_passwordsure").val("");$("#span_tip_employee_passwordsure").html("");$("#txt_employee_realname").val("");$("#span_tip_employee_realname").html("");$("#txt_employee_email").val("");$("#span_tip_employee_email").html("");$("#txt_employee_job").val("");$("#span_tip_employee_job").html("");$("#txt_employee_mobile").val("");$("#span_tip_employee_mobile").html("");$("#txt_employee_phone").val("");$("#txt_employee_department").val("")}var data_employees=[];function searchEmployees(){data_employees=[];var b=Number($("#pager_employees").attr("page"));var e={pageNo:b,pageSize:pageSize};var c=$("#txt_search_employee").val();var a=$("#select_search_employee_status").val();if(c&&c.length>0){e.username=c}if(a!=="-1"){e.status=a}var d=$("#table_employees");d.html("");$.ajax({type:"GET",async:true,url:urls.employee.search,data:e,dataType:"jsonp",success:function(o){if(o&&o.success){if(!o.result||!o.result.items||o.result.items.length===0){showPopover("当前查询到0条数据");return}var p=o.result.items;data_employees=p;var m=p.length,l="";var g=user.privilegeCodes;var f=jQuery.inArray("employeemge_detail",g);var h=jQuery.inArray("employeemge_update",g);var r=jQuery.inArray("employeemge_role",g);var n=jQuery.inArray("employeemge_pwd",g);var j=jQuery.inArray("employeemge_remove",g);for(var k=0;k<m;k++){var s=p[k];l+="<tr>";l+="   <td>"+(k+1)+"</td>";l+="   <td>"+s.username+"</td>";l+="   <td>"+s.realName+"</td>";l+="   <td>"+s.gender+"</td>";l+="   <td>"+s.email+"</td>";l+="   <td>"+(s.department?s.department:"无")+"</td>";l+="   <td>"+(s.position?s.position:"无")+"</td>";if(f!==-1){l+='   <td><a href="javascript:modalemployeedetail('+k+');">详情</a></td>'}if(h!==-1){l+='   <td><a href="javascript:modalemployeeupdate('+k+');">修改</a></td>'}if(r!==-1){l+='   <td><a href="javascript:modalemployeerole('+k+');">赋角色</a></td>'}if(n!==-1){l+='   <td><a href="javascript:modalemployeepassword('+k+');">重置密码</a></td>'}if(j!==-1){l+='   <td><a href="javascript:modalemployeedelete('+k+');">删除</a></td>'}l+="</tr>"}d.html(l);var q=setPage(o.result.total,b,"'pager_employees'");$("#pager_employees > ul").html(q)}else{showPopover(o.info)}}})}function modalemployeedetail(a){var b=data_employees[a].id+"";$.ajax({type:"GET",async:true,url:urls.employee.detail,data:{id:b},dataType:"jsonp",success:function(j){if(j&&j.success&&j.result){var g=j.result;$("#span_detail_employee_id").html(g.id);$("#span_detail_employee_username").html(g.username);$("#span_detail_employee_realName").html(g.realName);$("#span_detail_employee_status").html(g.status);$("#span_detail_employee_gender").html(g.gender);$("#span_detail_employee_email").html(g.email);$("#span_detail_employee_department").html(g.department?g.department:"无");$("#span_detail_employee_position").html(g.position);$("#span_detail_employee_mobilePhone").html(g.mobilePhone);$("#span_detail_employee_phone").html(g.phone?g.phone:"无");var c=g.roleNames?g.roleNames.length:0;var f="";if(c>0){for(var d=c;d--;){f+=g.roleNames[d];if(d!==0){f+=","}}}$("#span_detail_employee_roles").html(f?f:"无");$("#modal_detail_employee").modal("show")}else{showPopover(j.info)}}})}function modalemployeeupdate(a){var b=data_employees[a].id;$.ajax({type:"GET",async:true,url:urls.employee.detail,data:{id:b},dataType:"jsonp",success:function(d){if(d&&d.success&&d.result){var c=d.result;$("#txt_employee_update_id").val(c.id);$("#span_update_employee_username").html(c.username);$("#txt_employee_update_department").val(c.department);$("#txt_employee_update_job").val(c.position);$("#txt_employee_update_mobile").val(c.mobilePhone);$("#txt_employee_phone").val(c.phone);$("#modal_update_employee").modal("show")}else{showPopover(d.info)}}})}function verifyEmployeeJobUpdate(){var a=$("#txt_employee_update_job").val();var b=$("#span_tip_employee_update_job");if(a===""||a.length===0){b.html("请输入员工职务");return false}b.html("");return true}function verifyEmployeeMobileUpdate(){var a=$("#txt_employee_update_mobile").val();var c=$("#span_tip_employee_update_mobile");if(a==""){c.html("请填写手机号码");return false}var b=/1[3,5,6,8]\d{9}$/;if(b.test(a)){c.html("");return true}c.html("手机号码只能以13、15、16或18开头，长度为11位");return false}function updateEmployee(){var a=verifyEmployeeJobUpdate();if(!a){return false}a=verifyEmployeeMobileUpdate();if(!a){return false}var b={id:$("#txt_employee_update_id").val(),position:$("#txt_employee_update_job").val(),mobilePhone:$("#txt_employee_update_mobile").val(),phone:$("#txt_employee_update_phone").val(),department:$("#txt_employee_update_department").val()};$.ajax({type:"GET",async:true,url:urls.employee.update,data:b,dataType:"jsonp",success:function(c){if(c&&c.success){showPopover("修改成功");$("#modal_update_employee").modal("hide");searchEmployees()}else{showPopover(c.info)}}})}function modalemployeerole(a){var b=data_employees[a];$("#txt_employee_id_role").val(b.id);$("#span_employee_name_role").html(b.username);$.ajax({type:"GET",async:true,url:urls.role.search,data:{pageNo:-1},dataType:"jsonp",success:function(k){if(k&&k.success&&k.result){if(!k.result||!k.result.items||k.result.items.length===0){showPopover("暂未成功初始化角色列表");return}var f=k.result.items;var c=f.length;var h="";for(var g=0;g<c;g++){var j=f[g];h+='<input type="checkbox" name="update_employee_role" id="checkbox_employee_roles_'+j.id+'"';var d=verfyHasRole(a,j.id);if(d){h+=' checked="'+d+'"'}h+="><span>"+j.name+"</span>";if((g+1)%2===0){h+="<br>"}}$("#div_role_employee_update").html(h);$("#modal_employee_role").modal("show")}else{showPopover(k.info)}}})}function verfyHasRole(e,f){var d=data_employees[e].roleIds;var b=d.length;if(b===0){return false}for(var c=b;c--;){var a=d[c];if(a===f){return true}}return false}function updateEmployeeRoles(){var a=$('input[name="update_employee_role"]:checked');var c=$("#txt_employee_id_role").val();var b=[];a.each(function(){var e=$(this).prop("id").replace("checkbox_employee_roles_","");b.push(e)});var d={parameter:JSON.stringify({id:c,roles:b})};$.ajax({type:"GET",async:true,url:urls.employee.updaterole,data:d,dataType:"jsonp",success:function(f){if(f&&f.success){showPopover("更新成功");$("#modal_employee_role").modal("hide");searchEmployees()}else{showPopover(f.info)}}})}function modalemployeepassword(a){var b=data_employees[a];$("#txt_employee_updatepwd_id").val(b.id);$("#span_updatepwd_employee_username").html(b.username);$("#txt_employee_update_password").val("");$("#txt_employee_update_passwordsure").val("");$("#span_tip_employee_update_password").html("");$("#span_tip_employee_update_passwordsure").html("");$("#modal_update_employee_pwd").modal("show")}function verifyEmployeePwdUpdate(){var a=$("#txt_employee_update_password").val();var e=$("#span_tip_employee_update_password");var d=/^\s*$/;var b=$("#txt_employee_update_passwordsure").val();var c=$("#span_tip_employee_update_passwordsure");if(a==""){e.html("请输入密码");return false}else{if(a.length<6||a.length>20){e.html("密码长度必须大于6并小于20");return false}else{if(d.test(a)||a.indexOf(" ")>=0){e.html("密码中不能包含空格");return false}else{if(b!==""&&b!==a){c.html("两次密码输入不一致");return false}}}}e.html("");return true}function verifyEmployeePasswordSureUpdate(){var a=$("#txt_employee_update_passwordsure").val();var c=$("#txt_employee_update_password").val();var b=$("#span_tip_employee_update_passwordsure");if(a==""){b.html("请再次确认密码");return false}if(a!==c){b.html("两次密码输入不一致");return false}b.html("");return true}function updateemployeepwd(){var a=verifyEmployeePwdUpdate();if(!a){return false}a=verifyEmployeePasswordSureUpdate();if(!a){return false}var b={id:$("#txt_employee_updatepwd_id").val(),password:Base64.encode($("#txt_employee_update_passwordsure").val())};$.ajax({type:"GET",async:true,url:urls.employee.updatepwd,data:b,dataType:"jsonp",success:function(c){if(c&&c.success){showPopover("密码重置成功");$("#modal_update_employee_pwd").modal("hide")}else{showPopover(c.info)}}})}function modalemployeedelete(a){var b=data_employees[a];$("#txt_employee_delete_id").val(b.id);$("#span_delete_employee_name").html('确定删除员工"'+b.username+'"吗？删除后不可恢复');$("#modal_delete_employee").modal("show")}function deleteEmployee(){var a={id:$("#txt_employee_delete_id").val()};$.ajax({type:"GET",async:true,url:urls.employee.remove,data:a,dataType:"jsonp",success:function(b){if(b&&b.success){showPopover("删除成功");$("#modal_delete_employee").modal("hide");searchEmployees()}else{showPopover(b.info)}}})}var productsList=[];function searchAllProducts(){productsList=[];var a={pageNo:-1};$.ajax({type:"GET",async:true,url:urls.product.search,data:a,dataType:"jsonp",success:function(j){if(j&&j.success){var l=j.result.items;productsList=l;var h=l.length;if(h===0){showPopover("没有可选择的产品");return}var g="<ul>";g+="   <li>";g+='       <input style="margin: 0;" type="checkbox" name="select_all"/>全选';g+="   </li>";var b=getFathersFromArray(l);var o=b.length;for(var f=o;f--;){var n=b[f];var m=n.children.length;g+=getLiHtml(n,0,(m>0));for(var c=m;c--;){var d=n.children[c];g+=getLiHtml(d,50)}}g+="   <li>";g+='       <input style="margin: 0;" type="checkbox" name="select_all"/>全选';g+="   </li>";g+="</ul>";$("#div_products_list").html(g);bindclickforcheckboxs()}else{showPopover(j.info)}}})}function getLiHtml(c,d,b){var a='<li style="border-bottom: 1px solid #f5f5f5;padding-left:'+d+'px;">';a+='   <input type="checkbox" style="margin: 0;" ';if(d===0){a+=' name="pro_parent_'+c.id+'"'}else{a+=' id="'+c.id+'" name="pro_kids_'+c.pid+'"'}a+='   onClick="subprice()">';a+='   <span class="name">'+c.name+"</span>";if(d!==0||b===false){a+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";a+='价格:&nbsp;<input class="text-input" id="txt_price_'+c.id+'" type="text" name="price" value="'+c.price+'" onkeyup="subprice()">';a+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";a+='限制:&nbsp;<input  id="txt_limit_'+c.id+'" type="text" class="text-input" name="limit" value="'+c.limit+'">'}a+="   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;时间:&nbsp;";a+='   <input type="text"  class="text-date-start" name="start" ';a+='   id="txt_orderitemdate_start_'+c.id+'" ';a+='   style="" readonly="true" onfocus="pickDateStart()"/>';a+='   <span class="wordto" style="line-height: 22px;font-size: 12px;">至</span>';a+='   <input type="text"  class="text-date-end" name="end"  ';a+='   id="txt_orderitemdate_end_'+c.id+'" ';a+='   style="" readonly="true" onfocus="pickDateEnd()"/>';a+="</li>";return a}function bindclickforcheckboxs(){$('input[name^="pro_parent_"]').change(function(){var c=$(this);var b=c.prop("checked");var d=c.attr("name").replace("pro_parent_","");var a=$("input[name='pro_kids_"+d+"']");a.prop("checked",b);if(!b){$('input[name="select_all"]').prop("checked",b)}subprice()});$('input[name="select_all"]').change(function(d){var c=$(this);var b=c.prop("checked");var a=$("input[name^='pro_']");a.prop("checked",b);$('input[name="select_all"]').prop("checked",b);subprice()});$('input[name^="pro_kids_"]').change(function(d){var c=$(this);var e=c.attr("name").replace("pro_kids_","");var b=c.prop("checked");if(b){$("input[name='pro_parent_"+e+"']").prop("checked",b)}else{var a=$('input[name^="pro_kids_'+e+'"]:checked');if(a.length===0){$("input[name='pro_parent_"+e+"']").prop("checked",b)}}subprice()})}function getFathersFromArray(m){var a=[];var l=m.length;if(l===0){return a}for(var d=l;d--;){var n=m[d];if(n.pid===""){n.children=[];a.push(n)}}var o=a.length;if(o===0){var e='<div class="hintno">';e+="  <span>尚未定制方案，现在去";e+='      <a href="../">定制</a>';e+="  </span>";e+="</div>";$(".content-body").html(e);return}for(var c=l;c--;){var n=m[c];for(var b=o;b--;){var g=a[b];if(n.pid===g.id){g.children.push(n);a[b]=g;break}}}return a}function checkRepeat(e,b){var a=b.length;if(a===0){return false}for(var c=a;c--;){var d=b[c];if(e===d.id){return true}}return false}function pickDateStart(){WdatePicker({skin:"whyGreen",minDate:"%y-%M-%d"})}function pickDateEnd(){WdatePicker({skin:"whyGreen",minDate:"%y-%M-%d"})}function subprice(){var a=0;$("input[name^='pro_parent_']:checked").each(function(){var c=$(this).attr("name").replace("pro_parent_","");var b=$("#txt_price_"+c);if(b&&b.length>0){a+=Number(b.val())}});$("input[name^='pro_kids_']:checked").each(function(){var c=$(this).attr("id");var b=$("#txt_price_"+c);a+=Number(b.val())});$("#txt_order_price").val(a)}function verifyUserIDForOrder(){var a=$("#txt_order_userid").val();var b=$("#span_tip_order_userid");if(a.length===0||a===""){b.html("请输入用户ID");showPopover("请输入用户ID");return false}b.html("");return true}function verifyOrderDateStart(){var a=$("#txt_orderdate_start").val();var b=$("#span_tip_orderdate");if(a.length===0||a===""){b.html("请输入服务开始时间");return false}b.html("");return true}function verifyOrderDateEnd(){var b=$("#txt_orderdate_end").val();var d=$("#span_tip_orderdate");if(b.length===0||b===""){d.html("请输入服务结束时间");return false}var e=$("#txt_orderdate_start").val();if(e!==""){var c=new Date(e.replace(/-/g,"/"));var a=new Date(b.replace(/-/g,"/"));if(a<=c){d.html("结束时间须大于开始时间");return false}}d.html("");return true}function verifyProductSelected(){var b=$("input[name^='pro_parent_']:checked");if(b.length===0){showPopover("请选择服务模块");return false}var a=true;b.each(function(){var h=$(this).attr("name").replace("pro_parent_","");var f=$("#txt_price_"+h).val();if(f===""){showPopover("请为选中的产品输入价格");a=false;return a}var g=$("#txt_orderitemdate_start_"+h).val();if(g===""){showPopover("请为选中的产品输入开始时间");a=false;return a}var d=$("#txt_orderitemdate_end_"+h).val();if(d===""){showPopover("请为选中的产品输入结束时间");a=false;return a}var e=Number(g.replace(/-/g,""));var c=Number(d.replace(/-/g,""));if(c<=e){showPopover("结束时间不能早于开始时间");a=false;return a}});return a}function verifyOrderInput(){var a=verifyUserIDForOrder();if(!a){return a}a=verifyProductSelected();return a}function addOrder(){var a=verifyOrderInput();if(!a){return a}var d=[];var c=$("input[name^='pro_parent_']:checked");c.each(function(){var j=$(this).attr("name").replace("pro_parent_","");var i={moduleId:j,useTime:$("#txt_orderitemdate_start_"+j).val(),deadline:$("#txt_orderitemdate_end_"+j).val()};var h=$("#txt_limit_"+j).val();if(h&&h.length>0){var g=Number(h);i.useLimit=g;i.consultPrice=$("#txt_price_"+j).val()}d.push(i)});var b=$("input[name^='pro_kids_']:checked");b.each(function(){var j=$(this);var g=j.attr("name").replace("pro_kids_","");var l=j.attr("id");var i={moduleId:l,useLimit:$("#txt_limit_"+l).val(),consultPrice:$("#txt_price_"+l).val()};var k=$("#txt_orderitemdate_start_"+l).val();if(k===""){i.useTime=$("#txt_orderitemdate_start_"+g).val()}else{i.useTime=k}var h=$("#txt_orderitemdate_end_"+l).val();if(h===""){i.deadline=$("#txt_orderitemdate_end_"+g).val()}else{i.deadline=h}d.push(i)});var f={userId:$("#txt_order_userid").attr("userid"),remarks:$("#txt_order_remark").val(),consultPrice:$("#txt_order_price").val(),orderItems:d};var e={parameter:JSON.stringify(f)};$.ajax({type:"GET",async:true,url:urls.order.add,data:e,dataType:"jsonp",success:function(g){if(g&&g.success){showPopover("订单添加成功");$("#modal_add_order").modal("hide");searchOrders()}else{showPopover(g.info)}}})}var data_orders=[];function searchOrders(){data_orders=[];var b=Number($("#pager_orders").attr("page"));var e={pageNo:b,pageSize:pageSize};var d=$("#table_orders");d.html("");var c=$("#txt_search_order").val();if(c.length>0){e.username=c;e.email=c}var a=$("#select_search_order_status").val();if(a!=="-1"){e.status=a}$.ajax({type:"GET",async:true,url:urls.order.search,data:e,dataType:"jsonp",success:function(n){if(n&&n.success){if(!n.result||!n.result.items||n.result.items.length===0){showPopover("当前查询到0条数据");return}var p=n.result.items;data_orders=p;var m=p.length,l="";var g=user.privilegeCodes;var f=jQuery.inArray("ordermge_detail",g);var h=jQuery.inArray("ordermge_update",g);var o=jQuery.inArray("ordermge_audit",g);var j=jQuery.inArray("ordermge_remove",g);for(var k=0;k<m;k++){var r=p[k];l+="<tr>";l+="   <td>"+(k+1)+"</td>";l+="   <td>"+r.username+"</td>";l+="   <td>"+r.email+"</td>";l+="   <td>"+r.totalAmount+"</td>";l+="   <td>"+r.consultPrice+"</td>";l+="   <td>"+r.status+"</td>";if(f!==-1){l+='   <td><a href="javascript:modalorderdetail('+k+');">详情</a></td>'}if(h!==-1){l+='   <td><a href="javascript:modalorderupdate('+k+');">修改</a></td>'}if(o!==-1){l+='   <td><a href="javascript:modalorderaudit('+k+');">审核</a></td>'}if(j!==-1){l+='   <td><a href="javascript:modalorderdelete('+k+');">删除</a></td>'}l+="</tr>"}d.html(l);var q=setPage(n.result.total,b,"'pager_orders'");$("#pager_orders > ul").html(q)}else{showPopover(n.info)}}})}function modalorderdetail(a){var c=data_orders[a].id;var b={id:c};$.ajax({type:"GET",async:true,url:urls.order.detail,data:b,dataType:"jsonp",success:function(m){if(m.success&&m.result){var p=m.result;$("#span_detail_orderid").html(p.orderId);$("#span_detail_order_userid").html(p.userid);$("#span_detail_order_username").html(p.userName);$("#span_detail_ordertotalprice").html(p.totalPrice);$("#span_detail_orderconsultPrice").html(p.consultPrice);$("#span_detail_orderstatus").html(p.status);$("#span_detail_submitTime").html(p.submitTime);var j='<ul class="list-group">';var d=getFathersFromOrderItems(p.orderItems);var l=d.length;for(var h=l;h--;){var n=d[h];j+='<li class="list-group-item" style="padding: 5px 10px;">';j+='<span class="firstnodulename" style="font-weight: bold;">'+n.moduleName+"</span>";if(n.startUseTime!==""&&n.type===3){j+='&nbsp;&nbsp;<span class="span-s-12">价格：'+n.consultPrice+"</span>";j+='&nbsp;&nbsp;<span class="span-s-12">限制：'+n.limit+"</span>";j+='&nbsp;&nbsp;<span class="span-s-12">时间：'+n.startUseTime.substring(0,10)+"至"+n.deadline.substring(0,10)+"</span>"}j+="</li>";var o=n.children.length;for(var f=o;f--;){var g=n.children[f];j+=getOrderItemDetailLiHtml(g)}}j+="</ul>";$("#div_detail_order_productlist").html(j);$("#span_detail_order_remarks").html(p.remarks?p.remarks:"无");$("#modal_detail_order").modal("show")}else{showPopover(m.info)}}})}function getOrderItemDetailLiHtml(b){var a='<li class="list-group-item" style="padding: 5px 5px 5px 40px;">';a+='<span class="firstnodulename">'+b.moduleName+"</span>";a+='&nbsp;&nbsp;<span class="span-s-12">价格：'+b.consultPrice+"</span>";a+='&nbsp;&nbsp;<span class="span-s-12">限制：'+b.limit+"</span>";if(b.startUseTime!==""){a+='&nbsp;&nbsp;<span class="span-s-12">时间：'+b.startUseTime.substring(0,10)+"至"+b.deadline.substring(0,10)+"</span>"}a+="</li>";return a}function modalorderaudit(a){var b=data_orders[a].id;$("#txt_audit_orderid").val(b);$("#modal_audit_order").modal("show")}function auditOrder(){var b=$("#txt_audit_orderid").val();var a={id:b,status:$("#txt_audit_order").val(),auditRemarks:$("#txt_delete_order_auditRemarks").val()};$.ajax({type:"GET",async:true,url:urls.order.audit,data:a,dataType:"jsonp",success:function(c){if(c.success){showPopover("审核成功");$("#modal_audit_order").modal("hide");searchOrders()}else{showPopover(c.info)}}})}function modalorderdelete(a){var b=data_orders[a].id;$("#txt_delete_orderid").val(b);$("#span_delete_order").html("确定要删除该订单吗？删除后不可恢复");$("#modal_delete_order").modal("show")}function deleteOrder(){var b=$("#txt_delete_orderid").val();var a={id:b};$.ajax({type:"GET",async:true,url:urls.order.remove,data:a,dataType:"jsonp",success:function(c){if(c.success){showPopover("删除成功");$("#modal_delete_order").modal("hide");searchOrders()}else{showPopover(c.info)}}})}function getFathersFromOrderItems(h){var a=[];var g=h.length;if(g===0){return a}for(var d=g;d--;){var l=h[d];if(l.pModuleId===""){l.children=[];a.push(l)}}var m=a.length;if(m===0){return a}for(var c=g;c--;){var l=h[c];for(var b=m;b--;){var e=a[b];if(l.pModuleId===e.moduleId){e.children.push(l);a[b]=e;break}}}return a}function modalorderupdate(a){var c=data_orders[a].id;$("#txt_order_update_orderid").val(c);var b={id:c};$.ajax({type:"GET",async:true,url:urls.order.detail,data:b,dataType:"jsonp",success:function(q){if(q.success&&q.result){var d=q.result;$("#txt_order_update_date_start").val(d.startUserTime);$("#txt_order_update_date_end").val(d.deadline);$("#txt_order_update_price").val(d.consultPrice);$("#txt_order_update_remark").val(d.remarks);var o='<ul class="list-group">';var h=getFathersFromOrderItems(d.orderItems);var p=h.length;var l=user.privilegeCodes;var j=jQuery.inArray("ordermge_update",l);var t=jQuery.inArray("ordermge_remove",l);for(var n=p;n--;){var s=h[n];if(s.type===3){o+=getUpdateOrderItemsLiHtml(s,j,t)}else{o+='<li class="list-group-item" style="padding: 10px 5px;" id="li_update_orderitem_'+s.id+'" moduleId="'+s.moduleId+'">';o+='<span class="firstnodulename" style="font-weight:bold;">'+s.moduleName+"</span>";o+="</li>"}var f=s.children;var u=f.length;for(var m=u;m--;){var g=f[m];o+=getUpdateOrderItemsLiHtml(g,j,t)}}o+="</ul>";$("#div_update_order_products_list").html(o);$("#modal_update_order").modal("show")}else{showPopover(q.info)}}})}function getUpdateOrderItemsLiHtml(f,e,b,d){var c="";if(f.type===3){c='<li class="list-group-item" style="padding: 10px 5px;" id="li_update_orderitem_'+f.id+'" parentId="'+f.pModuleId+'">';c+='<span class="firstnodulename" style="font-weight:bold;">'+f.moduleName+"</span>"}else{c='<li class="list-group-item" style="padding: 10px 5px 10px 40px;" id="li_update_orderitem_'+f.id+'" parentId="'+f.pModuleId+'">';c+='名称：<span class="firstnodulename">'+f.moduleName+"</span>"}if(e!==-1){c+="<span>折后价：</span>";c+='<input style="width: 80px; padding:0 6px;" id="txt_update_orderitem_price_'+f.id+'" type="text" value="'+f.consultPrice+'">';c+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";c+="<span>限制：</span>";c+='<input  style="width: 80px; padding:0 6px;" id="txt_update_orderitem_limit_'+f.id+'" type="text" value="'+f.limit+'">';c+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";c+='   <input type="text" class="text-date-start" name="start" id="txt_uporderitemdate_start_'+f.id+'" value="'+f.startUseTime.substring(0,10)+'" style="background-color:#fff;cursor:pointer;width:80px;height: 22px;padding: 0 0;" readonly="true" onClick="WdatePicker()"/>';c+='   <span class="wordto" style="line-height: 22px;font-size: 12px;">至</span>';c+='   <input type="text" class="input-sm form-control" name="end" id="txt_uporderitemdate_end_'+f.id+'" value="'+f.deadline.substring(0,10)+'" style="background-color:#fff;cursor:pointer;width:80px; height: 22px;padding: 0 0;" readonly="true" onClick="WdatePicker()"/>'}else{c+='<span>价格：</span><input id="txt_update_orderitem_price_'+f.id+'" type="text" value="'+f.consultPrice+'" readonly="true">';c+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";c+='<span>限制：</span><input id="txt_update_orderitem_limit_'+f.id+'" type="text" value="'+f.limit+'"  readonly="true">'}c+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";var a="'"+f.id+"'";if(e!==-1){c+='<button type="button" class="btn btn-success btn-sm" title="确认修改" onclick="updateOrderItem('+a+')">保存</button>'}c+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";if(b!==-1){c+='<button type="button" class="btn btn-danger btn-sm" title="删除" onClick="deleteOrderItem('+a+')">删除</button>'}c+="</li>";return c}function verifyOrderUpdateDateStart(){var a=$("#txt_order_update_date_start").val();var b=$("#span_tip_orderupdatedate");if(a.length===0||a===""){b.html("请输入服务开始时间");return false}b.html("");return true}function verifyOrderUpdateDateEnd(){var b=$("#txt_order_update_date_end").val();var d=$("#span_tip_orderupdatedate");if(b.length===0||b===""){d.html("请输入服务结束时间");return false}var e=$("#txt_order_update_date_start").val();if(e!==""){var c=new Date(e.replace(/-/g,"/"));var a=new Date(b.replace(/-/g,"/"));if(a<=c){d.html("结束时间须大于开始时间");return false}}d.html("");return true}function verifyOrderUpdatePrice(){var c=/\d/;var a=$("#txt_order_update_price").val();var b=$("#span_tip_orderupdate_price");if(!c.test(a)){b.html("价格格式不正确");return false}b.html("");return true}function verifyOrderUpdateInput(){var a=verifyOrderUpdatePrice();return a}function updateOrder(){var a=verifyOrderUpdateInput();if(!a){return a}var c=$("#txt_order_update_orderid").val();var b={id:c,consultPrice:$("#txt_order_update_price").val(),remark:$("#txt_order_update_remark").val()};$.ajax({type:"GET",async:true,url:urls.order.update,data:b,dataType:"jsonp",success:function(d){if(d.success){$("#modal_update_order").modal("hide");showPopover("修改成功")}else{showPopover(d.info)}}})}function updateOrderItem(b){var a={id:b,consultPrice:$("#txt_update_orderitem_price_"+b).val(),useLimit:$("#txt_update_orderitem_limit_"+b).val(),useTime:$("#txt_uporderitemdate_start_"+b).val(),deadline:$("#txt_uporderitemdate_end_"+b).val()};$.ajax({type:"GET",async:true,url:urls.order.itemupdate,data:a,dataType:"jsonp",success:function(c){if(c.success){showPopover("修改成功")}else{showPopover(c.info)}}})}function deleteOrderItem(b){if(confirm("确认要删除该订单项？删除后不可恢复")){var a={id:b};$.ajax({type:"GET",async:true,url:urls.order.itemremove,data:a,dataType:"jsonp",success:function(f){if(f.success){showPopover("删除成功");var c=$("#li_update_orderitem_"+b);var g=c.attr("parentId");var d=$("li[parentId='"+g+"']");if(d.length===1){$("li[moduleId='"+g+"']").remove()}c.remove()}else{showPopover(f.info)}}})}}jQuery.PopupUserList=function(a){var b=$(a);var e,f,c;var d="";d+='<div class="AutoComplete" style="background-color: #fff;border: 1px solid #ddd; " id="popup_userlist">';d+='  <div style="width: 100%;text-align:right;">';d+='      <img id="popup_userlist_close" style="cursor: pointer;" src="images/close.png"/>';d+="  </div>";d+='  <ul class="AutoComplete_ul" id="popup_userlist_ul">';d+="  </ul>";d+='  <div id="pager_users_for_popup" style="padding-left: 10px; width: 100%; text-align: center;" page="0" data-target="userforpopup">';d+='      <ul class="pagination pagination-sm">';d+="      </ul>";d+="  </div>";d+="</div>";$("body").append(d);getUserListForPopup();e=$("#popup_userlist");e.data("elt",b);$("#popup_userlist_close").click(function(){e.hide()});b.click(function(h){var g=$(this);e.show().css({left:g.offset().left,top:g.offset().top+g.outerHeight(true)-7,position:"absolute",zIndex:"9999999",width:g.width()})}).focus(function(){e.data("elt",$(this))}).blur(function(){})};function getUserListForPopup(){var c="";var b=$("#pager_users_for_popup");var a=Number(b.attr("page"));var d={pageNo:a,pageSize:10};$.ajax({type:"GET",async:false,url:urls.user.search,data:d,dataType:"jsonp",success:function(m){if(m.result&&m.result.userInfos.length<1){showPopover("查询到0条用户数据");return c}var h=m.result.userInfos;var f=h.length;for(var k=f;k--;){var g=h[k];c+='<li email="'+g.email+'" userid="'+g.id+'">'+g.email+"</li>"}$("#popup_userlist_ul").html(c);var j=$("#popup_userlist_ul > li");j.click(function(){var e=$(this);$("#txt_order_userid").val(e.attr("email")).attr("userid",e.attr("userid"));$("#popup_userlist").hide()});var l=setPage(m.result.totalCount,a,"'pager_users_for_popup'");$("#pager_users_for_popup > ul").html(l)}})}function verifyPermissionName(){var a=$("#txt_permission_name").val();var b=$("#span_tip_permission_name");if(a.length===0||a===""){b.html("请输入权限名称");return false}b.html("");return true}function verifyPermissionCode(){var a=$("#txt_permission_code").val();var b=$("#span_tip_permission_code");if(a.length===0||a===""){b.html("请输入权限代码");return false}b.html("");return true}function verifyPermissionUrl(){var a=$("#txt_permission_url").val();var b=$("#span_tip_permission_url");if(a.length===0||a===""){b.html("请输入权限url");return false}b.html("");return true}function addPermission(){var a=verifyPermissionName();if(!a){return false}a=verifyPermissionCode();if(!a){return false}a=verifyPermissionUrl();if(!a){return false}var b={name:$("#txt_permission_name").val(),code:$("#txt_permission_code").val(),remarks:$("#txt_permission_remarks").val(),pid:$("#txt_permission_pid").val(),url:$("#txt_permission_url").val(),status:$("#txt_permission_addstate").val()};$.ajax({type:"GET",async:true,url:urls.permission.add,data:b,dataType:"jsonp",success:function(c){if(c&&c.success){showPopover("权限添加成功");$("#modal_add_permission").modal("hide");searchPermissions()}else{showPopover(c.info)}}})}var data_permissions=[];function searchPermissions(){data_permissions=[];var a=Number($("#pager_permissions").attr("page"));var d={pageNo:a,pageSize:pageSize};var e=$("#select_search_per_status").val();if(e!=="-1"){d.level=e}var b=$("#txt_search_per").val();if(b.length>0){d.name=b}var c=$("#table_permissions");c.html("");$.ajax({type:"GET",async:true,url:urls.permission.search,data:d,dataType:"jsonp",success:function(m){if(m&&m.success){if(!m.result||!m.result.items||m.result.items.length===0){showPopover("当前查询到0条数据");return}var n=m.result.items;data_permissions=n;var l=n.length,k="";var f=user.privilegeCodes;var g=jQuery.inArray("permissionmge_update",f);var h=jQuery.inArray("permissionmge_remove",f);for(var j=0;j<l;j++){var p=n[j];k+="<tr>";k+="   <td>"+(j+1)+"</td>";k+="   <td>"+p.pid+"</td>";k+="   <td>"+p.name+"</td>";k+="   <td>"+p.status+"</td>";k+="   <td>"+p.level+"</td>";k+="   <td>"+p.code+"</td>";k+="   <td>"+p.url+"</td>";k+="   <td>"+(p.remarks?p.remarks:"无")+"</td>";if(p.id<81||p.code==="productmge_detail"){if(g!==-1){k+='   <td><a href="javascript:;"class="btn btn-default btn-sm disabled" style="padding:2px;font-size:10px;" role="button">修改</a></td>'}if(h!==-1){k+='   <td><a href="javascript:;"class="btn btn-default btn-sm disabled" style="padding:2px;font-size:10px;"  role="button">删除</a></td>'}continue}if(g!==-1){k+='   <td><a href="javascript:modalperupdate('+j+');">修改</a></td>'}if(h!==-1){k+='   <td><a href="javascript:modalperdelete('+j+');">删除</a></td>'}k+="</tr>"}c.html(k);var o=setPage(m.result.total,a,"'pager_permissions'");$("#pager_permissions > ul").html(o)}else{showPopover(m.info)}}})}function initPermissionPid(){$("#txt_permission_name").val("");$("#txt_permission_code").val("");var a={pageNo:-1,level:1};$.ajax({type:"GET",async:true,url:urls.permission.search,data:a,dataType:"jsonp",success:function(h){if(h&&h.success){var f='<option value="">顶级权限</option>';if(!h.result||!h.result.items||h.result.items.length===0){$("#txt_permission_pid").html(f);showPopover("暂未成功初始化PID");return}var c=h.result.items;var b=c.length;for(var d=0;d<b;d++){var g=c[d];f+='<option value="'+g.id+'">'+g.name+"</option>"}$("#txt_permission_pid").html(f)}else{var f='<option value="">顶级权限</option>';$("#txt_permission_pid").html(f)}}})}function modalperupdate(a){var c=data_permissions[a];var b=map_status_permission.get(c.status);$("#txt_permission_state").val(b);$("#txt_permission_update_id").val(c.id);$("#txt_permission_update_remarks").val(c.remarks);$("#modal_update_permission").modal("show")}function updatePermission(){var b=$("#txt_permission_update_id").val();var a={id:b,status:$("#txt_permission_state").val(),remarks:$("#txt_permission_update_remarks").val()};$.ajax({type:"GET",async:true,url:urls.permission.update,data:a,dataType:"jsonp",success:function(c){if(c&&c.success){showPopover("修改成功");$("#modal_update_permission").modal("hide");searchPermissions()}else{showPopover(c.info)}}})}function modalperdelete(a){var b=data_permissions[a];$("#txt_delete_permission_id").val(b.id);$("#span_delete_permission").html('确定要删除权限"'+b.name+'"吗？删除后不可恢复。');$("#modal_delete_permission").modal("show")}function deletePermission(){var a=$("#txt_delete_permission_id").val();$.ajax({type:"GET",async:true,url:urls.permission.remove,data:{id:a},dataType:"jsonp",success:function(b){if(b&&b.success){showPopover("删除成功");$("#modal_delete_permission").modal("hide");searchPermissions()}else{showPopover(b.info)}}})}var regBlank=/(^ )|( $)/;function verifyProductName(){var a=$("#txt_product_name").val();var c=$("#span_tip_productname");var b=/(^ )|( $)/;if(a==""){c.html("请输入产品名称");return false}else{if(a=="null"){c.html('产品名称不能为"null"');return false}else{if(b.test(a)||a.indexOf(" ")>0){c.html("产品名称不能包空格");return false}}}c.html("");return true}function verifyProductPrice(){var a=$("#txt_product_price").val();var c=$("#span_tip_productprice");var b=new RegExp("^[0-9]*$");if(a==""){c.html("请输入产品价格");return false}if(b.test(a)){c.html("");return true}c.html("产品价格只能包含数字");return false}function verifyProductUrl(){var a=$("#txt_product_url").val();var b=$("#span_tip_producturl");if(a==""){b.html("请输入产品url");return false}else{if(regBlank.test(a)||a.indexOf(" ")>0){b.html("产品url不能包空格");return false}}b.html("");return true}function verifyProductCommercialTel(){var a=$("#txt_product_commercial_tel").val();var b=$("#span_tip_commercial_tel");if(a==""){b.html("请输入商务电话");return false}b.html("");return true}function verifyProductIconUrl(){var a=$("#txt_product_icon_url").val();var b=$("#span_tip_product_icon_url");if(a===""){b.html("请输入产品图标样式名称");return false}else{b.html("");return true}}function verifyProductCode(){var a=$("#txt_product_code").val();var b=$("#span_tip_productcode");if(a===""){b.html("请输入产品代码");return false}else{b.html("");return true}}function verfyProductInput(b){var a=verifyProductName();if(!a&&!(typeof(b)!=="undefined"&&b==="update")){return a}a=verifyProductUrl();if(!a){return a}a=verifyProductPrice();if(!a){return a}a=verifyProductIconUrl();if(!a){return a}return true}function modalAddProduct(){resetProductInput();$("#model_label_add_product").html("新增产品");initFatherCheckBox();$("#modal_add_product").attr("current","0").modal("show");$("#div_product_name").css({display:"block"})}function initFatherCheckBox(){var a={pageNo:-1};$.ajax({type:"GET",async:false,url:urls.product.search,data:a,dataType:"jsonp",success:function(j){if(j&&j.success){var c=j.result.items;var b=c.length;if(b===0){return}var f="";for(var d=0;d<b;d++){if(d===0){f+='<option value="" selected="true">顶级产品</option>'}var g=c[d];if(g.pid===""){f+='<option value="'+g.id+'">'+g.name+"</option>"}}$("#txt_product_pid").html(f)}}})}function addProduct(){var a=verfyProductInput();if(a===false){return}$("#modal_add_product").attr("current","0");var b={name:$("#txt_product_name").val(),pid:$("#txt_product_pid").val(),price:$("#txt_product_price").val(),status:$("#txt_product_status").val(),url:$("#txt_product_url").val(),useLimit:$("#txt_product_limit").val(),ref_url:$("#txt_product_helpurl").val(),remarks:$("#txt_product_remark").val(),code:$("#txt_product_code").val(),icon_url:$("#txt_product_icon_url").val(),type:$("#txt_product_kind").val()};$.ajax({type:"GET",async:true,url:urls.product.add,data:b,dataType:"jsonp",success:function(c){if(c.success){showPopover("添加成功");$("#modal_add_product").modal("hide");searchProduct()}else{showPopover(c.info)}}})}function resetProductInput(){$("#txt_product_name").val("");$("#span_tip_productname").val("");$("#txt_product_pid").val("");$("#txt_product_price").val("");$("#span_tip_productprice").val("");$("#txt_product_status").val("0");$("#txt_product_url").val("");$("#span_tip_producturl").val("");$("#txt_product_commercial_tel").val("");$("#span_tip_commercial_tel").val("");$("#txt_product_limit").val("");$("#txt_product_helpurl").val("");$("#txt_product_remark").val("");$("#txt_product_support_tel").val("")}var products=[];function searchProduct(){products=[];var b=Number($("#pager_products").attr("page"));var e={pageNo:b,pageSize:pageSize};var c=$("#txt_search_product").val();if(c.length>0){e.name=c}var a=$("#select_search_product_status").val();if(a!=="-1"){e.status=a}var d=$("#table_products");d.html("");$.ajax({type:"GET",async:true,url:urls.product.search,data:e,dataType:"jsonp",success:function(o){if(o&&o.success){if(o.result&&o.result.items.length<1){showPopover("查询到0条产品数据");return}var g=o.result.items;products=g;var h=user.privilegeCodes;var f=jQuery.inArray("productmge_detail",h);var j=jQuery.inArray("productmge_update",h);var k=jQuery.inArray("productmge_remove",h);var m="";var n=g.length;for(var l=0;l<n;l++){var q=g[l];m+="<tr>";m+="	<td>"+(l+1)+"</td>";m+="	<td>"+q.name+"</td>";m+="	<td>"+q.price+"</td>";m+="	<td>"+q.limit+"</td>";m+="	<td>"+q.pid+"</td>";m+="	<td>"+q.status+"</td>";if(f!==-1){m+='	<td><a href="javascript:modalproductdetail('+l+');">详情</a></td>'}if(j!==-1){m+='	<td><a href="javascript:modalproductupdate('+l+');">修改</a></td>'}if(k!==-1){m+='	<td><a href="javascript:modalproductdelete('+l+');">删除</a></td>'}m+="</tr>"}d.html(m);var p=setPage(o.result.total,b,"'pager_products'");$("#pager_products > ul").html(p)}else{showPopover(o.info)}}})}function modalproductupdate(a){initFatherCheckBox();var c=products[a].id;var b={id:c};$.ajax({type:"GET",async:true,url:urls.product.detail,data:b,dataType:"jsonp",success:function(g){if(g.success){var f=g.result;var d=$("#modal_add_product");d.attr("current","1");$("#txt_product_id").val(f.id);$("#txt_product_pid").val(f.pid?f.pid:"");$("#txt_product_price").val(f.price);$("#txt_product_status").val(f.status);$("#txt_product_url").val(f.url);$("#txt_product_code").val(f.code?f.code:"");$("#txt_product_limit").val(f.useLimit?f.useLimit:"");$("#txt_product_helpurl").val(f.ref_url?f.ref_url:"");$("#txt_product_remark").val(f.remarks?f.remarks:"");$("#txt_product_icon_url").val(f.icon_url?f.icon_url:"");$("#txt_product_kind").val(f.type?f.type:"1");$("#model_label_add_product").html("修改产品："+f.name);$("#div_product_name").css({display:"none"});d.modal("show")}else{showPopover(g.info)}}})}function updateProduct(){var a=verfyProductInput("update");if(!a){return}var b={id:$("#txt_product_id").val(),pid:$("#txt_product_pid").val(),price:$("#txt_product_price").val(),status:$("#txt_product_status").val(),url:$("#txt_product_url").val(),icon_url:$("#txt_product_icon_url").val(),useLimit:$("#txt_product_limit").val(),ref_url:$("#txt_product_helpurl").val(),remarks:$("#txt_product_remark").val(),code:$("#txt_product_code").val(),type:$("#txt_product_kind").val()};$.ajax({type:"GET",async:true,url:urls.product.update,data:b,dataType:"jsonp",success:function(c){if(c.success){showPopover("修改成功");$("#modal_add_product").modal("hide");searchProduct()}else{showPopover(c.info)}}})}function modalproductdetail(a){var c=products[a].id;var b={id:c};$.ajax({type:"GET",async:true,url:urls.product.detail,data:b,dataType:"jsonp",success:function(f){if(f.success){var d=f.result;$("#span_detail_productid").html(d.id);$("#span_detail_productname").html(d.name);$("#span_detail_productstatus").html(d.status);$("#span_detail_productprice").html(d.price);$("#span_detail_producturl").html(d.url?d.url:"无");$("#span_detail_productlimit").html(d.useLimit?d.useLimit:"无");$("#span_detail_productcode").html(d.code?d.code:"无");$("#span_detail_product_ref_rul").html(d.ref_url?d.ref_url:"无");$("#span_detail_productl_icon_url").html(d.icon_url?d.icon_url:"无");$("#span_detail_product_remarks").html(d.remarks?d.remarks:"无");$("#modal_detail_product").modal({keyboard:false})}else{showPopover(f.info)}}})}function modalproductdelete(a){var b=products[a];$("#txt_delete_productid").val(b.id);$("#span_delete_product").html('确定要删除产品"'+b.name+'"吗？删除后不可恢复。');$("#modal_delete_product").modal("show")}function deleteProduct(){var b=$("#txt_delete_productid").val();var a={id:b};$.ajax({type:"GET",async:true,url:urls.product.remove,data:a,dataType:"jsonp",success:function(c){if(c.success){$("#modal_delete_product").modal("hide");showPopover("删除成功");searchProduct()}else{showPopover(c.info)}}})}var data_roles=[];function searchRoles(){data_roles=[];var a=Number($("#pager_roles").attr("page"));var d={pageNo:a,pageSize:pageSize};var b=$("#txt_search_role").val();if(b.length>0){d.name=b}var c=$("#table_roles");c.html("");$.ajax({type:"GET",async:true,url:urls.role.search,data:d,dataType:"jsonp",success:function(n){if(n&&n.success){if(!n.result||!n.result.items||n.result.items.length===0){showPopover("当前查询到0条数据");return}var o=n.result.items;data_roles=o;var m=o.length,l="";var g=user.privilegeCodes;var h=jQuery.inArray("rolemge_update",g);var f=jQuery.inArray("rolemge_update_permission",g);var j=jQuery.inArray("rolemge_remove",g);for(var k=0;k<m;k++){var q=o[k];l+="<tr>";l+="   <td>"+(k+1)+"</td>";l+="   <td>"+q.name+"</td>";l+="   <td>"+q.status+"</td>";if(h!==-1){l+='   <td><a href="javascript:modalroleupdate('+k+');">修改</a></td>'}if(f!==-1){l+='   <td><a href="javascript:modalroleupdateper('+k+');">更新权限</a></td>'}if(j!==-1){l+='   <td><a href="javascript:modalroledelete('+k+');">删除</a></td>'}l+="</tr>"}c.html(l);var p=setPage(n.result.total,a,"'pager_roles'");$("#pager_roles > ul").html(p)}else{showPopover(n.info)}}})}function getFathersFromPermissions(h){var a=[];var g=h.length;if(g===0){return a}for(var d=g;d--;){var l=h[d];if(l.pid===""){l.children=[];a.push(l)}}var m=a.length;if(m===0){return a}for(var c=g;c--;){var l=h[c];for(var b=m;b--;){var e=a[b];if(l.pid===e.id){e.children.push(l);a[b]=e;break}}}return a}function initRolePermissions(){var a={pageNo:-1};$.ajax({type:"GET",async:true,url:urls.permission.search,data:a,dataType:"jsonp",success:function(c){if(c&&c.success){if(!c.result||!c.result.items||c.result.items.length===0){showPopover("暂未成功初始化权限列表");return}var b=c.result.items;showPermissionsForRoleUpdate(b)}}})}function showPermissionsForRoleUpdate(g){var a=getFathersFromPermissions(g);var f=a.length;var e='<input style="margin: 0;" type="checkbox" name="select_all"/>全选<br>';for(var d=0;d<f;d++){var l=a[d];e+='<input type="checkbox" name="pro_parent_'+l.id+'">';e+="<span>"+l.name+"</span>";e+="<br>";var j=l.children.length;for(var b=0;b<j;b++){var c=l.children[b];e+='<input style="margin-left: 30px;" type="checkbox" id="'+c.id+'" name="pro_kids_'+c.pid+'" >';e+="<span>"+c.name+"</span>";e+="<br>"}}$("#div_role_permissions").html(e);$('input[name^="pro_parent_"]').change(function(){var k=$(this);var i=k.prop("checked");var m=k.attr("name").replace("pro_parent_","");var h=$("input[name='pro_kids_"+m+"']");h.prop("checked",i);if(!i){$('input[name="select_all"]').prop("checked",i)}});$('input[name="select_all"]').change(function(m){var k=$(this);var i=k.prop("checked");var h=$("input[name^='pro_']");h.prop("checked",i);$('input[name="select_all"]').prop("checked",i)});$('input[name^="pro_kids_"]').change(function(n){var m=$(this);var o=m.attr("name").replace("pro_kids_","");var k=m.prop("checked");var h=$("input[name='pro_parent_"+o+"']");if(!k){h.prop("checked",k)}var i=$('input[name^="pro_kids_'+o+'"]:checked');if(i.length===0){h.prop("checked",k)}})}function verifyRoleName(){var a=$("#txt_role_name").val();var b=$("#span_tip_role_name");if(a===""||a.length===0){b.html("请输入角色名称");return false}b.html("");return true}function verifyRolePers(){var a=$("input[name^='pro_']:checked");if(a.length===0){showPopover("请选择权限");return false}return true}function addRole(){var a=verifyRoleName();if(!a){return a}a=verifyRolePers();if(!a){return a}var d=[];var c=$("input[name^='pro_parent_']:checked");c.each(function(){var g=$(this).attr("name").replace("pro_parent_","");d.push(g)});var b=$("input[name^='pro_kids_']:checked");b.each(function(){var g=$(this).attr("name").replace("pro_kids_","");d.push(g)});var f={name:$("#txt_role_name").val(),remarks:$("#txt_role_remarks").val(),privileges:d,status:$("#txt_role_addstate").val()};var e={parameter:JSON.stringify(f)};$.ajax({type:"GET",async:true,url:urls.role.add,data:e,dataType:"jsonp",success:function(g){if(g&&g.success){showPopover("添加成功");$("#modal_add_role").modal("hide");searchRoles()}else{showPopover(g.info)}}})}function modalroleupdate(a){var b=data_roles[a];$("#txt_role_update_id").val(b.id);$("#span_update_role_name").html(b.name);$("#txt_role_update_state").val(b.status);$("#txt_role_update_remarks").val(b.remarks);$("#modal_update_role").modal("show")}function updateRole(){var a={id:$("#txt_role_update_id").val(),status:$("#txt_role_update_state").get(0).selectedIndex,remarks:$("#txt_role_update_remarks").val()};$.ajax({type:"GET",async:true,url:urls.role.update,data:a,dataType:"jsonp",success:function(b){if(b&&b.success){showPopover("修改成功");$("#modal_update_role").modal("hide");searchRoles()}else{showPopover(b.info)}}})}function modalroleupdateper(a){var b=data_roles[a];$("#txt_role_permission_update_id").val(b.id);$("#span_update_role_permission_name").html(b.name);var c={pageNo:-1};$.ajax({type:"GET",async:true,url:urls.permission.search,data:c,dataType:"jsonp",success:function(o){if(o&&o.success){if(!o.result||!o.result.items||o.result.items.length===0){showPopover("暂未成功初始化权限列表");return}var p=o.result.items;var m="";var d=getFathersFromPermissions(p);var n=d.length;var m='<input style="margin: 0;" type="checkbox" name="select_all"/>全选<br>';for(var l=0;l<n;l++){var r=d[l];m+='<input type="checkbox" name="pro_parent_'+r.id+'"';var f=verfyHasPer(a,r.id);if(f){m+=' checked="'+f+'"'}m+=" ><span>"+r.name+"</span>";m+="<br>";var q=r.children.length;for(var g=0;g<q;g++){var j=r.children[g];m+='<input style="margin-left: 30px;" type="checkbox" id="'+j.id+'" name="pro_kids_'+j.pid+'"';var f=verfyHasPer(a,r.id);if(f){m+=' checked="'+f+'"'}m+=" ><span>"+j.name+"</span>";m+="<br>"}}$("#div_role_permissions_update").html(m);$('input[name^="pro_parent_"]').change(function(){var i=$(this);var h=i.prop("checked");var k=i.attr("name").replace("pro_parent_","");var e=$("input[name='pro_kids_"+k+"']");e.prop("checked",h);if(!h){$('input[name="select_all"]').prop("checked",h)}});$('input[name="select_all"]').change(function(k){var i=$(this);var h=i.prop("checked");var e=$("input[name^='pro_']");e.prop("checked",h);$('input[name="select_all"]').prop("checked",h)});$('input[name^="pro_kids_"]').change(function(s){var k=$(this);var t=k.attr("name").replace("pro_kids_","");var i=k.prop("checked");var e=$("input[name='pro_parent_"+t+"']");if(!i){e.prop("checked",i)}var h=$('input[name^="pro_kids_'+t+'"]:checked');if(h.length===0){e.prop("checked",i)}});$("#modal_update_role_permission").modal("show")}else{showPopover(o.info)}}})}function updateRolePers(){var c=$("#txt_role_permission_update_id").val();var e=[];var b=$("input[name^='pro_parent_']:checked");b.each(function(){var f=$(this).attr("name").replace("pro_parent_","");e.push(f)});var a=$("input[name^='pro_kids_']:checked");a.each(function(){var f=$(this).attr("id");e.push(f)});var d={parameter:JSON.stringify({id:c,privileges:e})};$.ajax({type:"GET",async:true,url:urls.role.updateper,data:d,dataType:"jsonp",success:function(f){if(f&&f.success){showPopover("更新成功");$("#modal_update_role_permission").modal("hide");searchRoles()}else{showPopover(f.info)}}})}function verfyHasPer(e,f){var d=data_roles[e].privileges;var b=d.length;if(b===0){return false}for(var c=b;c--;){var a=d[c];if(a.id===f){return true}}return false}function modalroledelete(a){var b=data_roles[a];$("#txt_role_delete_id").val(b.id);$("#span_delete_role_name").html('确实要删除角色"'+b.name+'"吗？删除后不可恢复');$("#modal_delete_role").modal("show")}function deleteRole(){var a={id:$("#txt_role_delete_id").val()};$.ajax({type:"GET",async:true,url:urls.role.remove,data:a,dataType:"jsonp",success:function(b){if(b&&b.success){showPopover("删除成功");$("#modal_delete_role").modal("hide");searchRoles()}else{showPopover(b.info)}}})}function verfyUsername(){var a=$("#txt_user_name").val();var e=$("#span_tip_username");var d=/^[a-zA-Z0-9\_]{4,20}$/;var c=/^(?!_)(?!.*?_$)[a-zA-Z]+[a-zA-Z0-9_]*$/;var b=/^\w$|(^ )|( $)/;var f="";if(a==""){e.html("请输入用户名");return false}else{if(a=="null"){e.html('用户名不能为"null"');return false}else{if(a.length<4||a.length>20){e.html("用户名的长度要求大于4并且小于20");return false}else{if(!c.test(a)){e.html("用户名只能包含英文、数字、下划线，不能以数字或下划线开头，不能以下划线结尾");return false}else{if(b.test(a)||a.indexOf(" ")>0){e.html("用户名不能包空格");return false}}}}}e.html("");return true}function verifyUserPassword(){var a=$("#txt_user_password").val();var d=$("#span_tip_userpassword");var c=/^\s*$/;var b=$("#txt_user_passwordsure").val();if(a==""){d.html("请输入密码");return false}else{if(a.length<6||a.length>20){d.html("密码长度必须大于6并小于20");return false}else{if(c.test(a)||a.indexOf(" ")>=0){d.html("密码中不能包含空格");return false}else{if(b!=""&&b!==a){d.html("两次密码输入不一致");return false}}}}d.html("");return true}function verifyUserPasswordSure(){var a=$("#txt_user_passwordsure").val();var c=$("#txt_user_password").val();var b=$("#span_tip_userpasswordsure");if(a==""){b.html("请再次确认密码");return false}if(a!==c){b.html("两次密码输入不一致");return false}b.html("");return true}function verifyEmail(){var a=$("#txt_user_email").val();var c=$("#span_tip_email");var b=/[a-zA-Z0-9]+@\w+[\.][a-z]{2,3}$|[a-zA-Z0-9]+@\w+[\.][a-z]{2,3}[\.][a-z]{2,3}$/;if(a==""){c.html("请输入邮箱");return false}if(b.test(a)&&a.split("@").length==2){c.html("");return true}c.html("邮箱格式不正确");return false}function verifyRealname(){var a=$("#txt_user_realname").val();var c=$("#span_tip_realname");var b=/^(?!\s)([\u4E00-\u9FA0]+$|^[a-z·\s]+)$/i;if(a==""){c.html("真实姓名不能为空");return false}if(!b.test(a)){c.html("真实姓名只能为中文或者英文");return false}if(a.length<2||a.length>20){c.html("真实姓名长度必须不小于2并且不大于20");return false}c.html("");return true}function verifyMobile(){var a=$("#txt_user_mobile").val();var c=$("#span_tip_mobile");if(a==""){c.html("请填写手机号码");return false}var b=/1[3,5,6,8]\d{9}$/;if(b.test(a)){c.html("");return true}c.html("手机号码只能以13、15、16或18开头，长度为11位");return false}function verifyCompany(){var a=$("#txt_user_company").val();var b=$("#span_tip_company");if(a==""){b.html("请填写公司名称");return false}b.html("");return true}function verifyDepartment(){var a=$("#txt_user_department").val();var b=$("#span_tip_department");b.html("");return true}function verifyPhone(){var a=$("#txt_user_phone").val();var b=$("#span_tip_phone");b.html("");return true}function verifyUserInfo(){var a=false;a=verfyUsername();if(!a){$("#collapse_add_userone").collapse("show");return a}a=verifyUserPassword();if(!a){$("#collapse_add_userone").collapse("show");return a}a=verifyUserPasswordSure();if(!a){$("#collapse_add_userone").collapse("show");return a}a=verifyEmail();if(!a){$("#collapse_add_usertwo").collapse("show");return a}a=verifyCompany();if(!a){$("#collapse_add_userone").collapse("show");return a}a=verifyMobile();if(!a){$("#collapse_add_userthree").collapse("show");return a}return a}function addUser(){var a=verifyUserInfo();if(!a){return false}var b=$("[name='sex']").filter(":checked").val();var c={username:$("#txt_user_name").val(),password:Base64.encode($("#txt_user_passwordsure").val()),email:$("#txt_user_email").val(),realName:$("#txt_user_realname").val(),mobilephone:$("#txt_user_mobile").val(),telephone:$("#txt_user_phone").val(),fax:$("#txt_user_fax").val(),remarks:$("#txt_user_remark").val(),address:$("#txt_user_address").val(),zipcode:$("#txt_user_zipcode").val(),sex:b,companyName:$("#txt_user_company").val(),companyEmail:$("#txt_user_companyEmail").val(),companyPhone:$("#txt_user_companyPhone").val(),companyAddress:$("#txt_user_companyAddress").val(),companyRemarks:$("#txt_user_companyRemarks").val(),remarks:$("#txt_user_remarks").val()};$.ajax({type:"GET",async:true,url:urls.user.add,data:c,dataType:"jsonp",success:function(d){if(d&&d.success){showPopover("用户添加成功");$("#modal_add_user").modal("hide");searchUsers()}else{showPopover(d.info)}}})}function resetModalAddUser(){$("#txt_user_name").val("");$("#span_tip_username").html("4-20位，字母、数字、下划线组合");$("#txt_user_password").val("");$("#span_tip_userpassword").html("4-20位，字母、数字、下划线组合");$("#txt_user_passwordsure").val("");$("#span_tip_userpasswordsure").html("");$("#txt_user_email").val("");$("#span_tip_email").html("");$("#txt_user_realname").val("");$("#span_tip_realname").html("");$("#txt_user_mobile").val("");$("#span_tip_mobile").html("");$("#txt_user_company").val("");$("#span_tip_company").html("");$("#txt_user_department").val("");$("#span_tip_department").html("");$("#txt_user_phone").val("");$("#span_tip_phone").html("");$("#txt_user_fax").val("");$("#span_tip_fax").html("");$("#txt_user_zipcode").val("");$("#span_tip_zipcode").html("");$("#txt_user_address").val("");$("#span_tip_address").html("");$("#txt_user_remark").val("");$("#span_tip_remark").html("")}var users=[];function searchUsers(){users=[];var b=Number($("#pager_users").attr("page"));var e={pageNo:b,pageSize:pageSize};var a=$("#select_search_user_status").val();if(a!=="-1"){e.status=a}var c=$("#txt_search_user").val();if(c!==""&&c.length!==0){e.username=c;e.email=c}var d=$("#table_users");d.html("");$.ajax({type:"GET",async:true,url:urls.user.search,data:e,dataType:"jsonp",success:function(n){if(n&&n.success){if(n.result&&n.result.userInfos.length<1){showPopover("查询到0条用户数据");return}users=n.result.userInfos;var m=users.length;var l="";var g=user.privilegeCodes;var f=jQuery.inArray("usermge_detail",g);var h=jQuery.inArray("usermge_update",g);var j=jQuery.inArray("usermge_remove",g);for(var k=0;k<m;k++){var p=users[k];l+="<tr>";l+="	<td>"+(k+1)+"</td>";l+="	<td>"+p.username+"</td>";l+="	<td>"+p.email+"</td>";l+="	<td>"+decodeURIComponent(p.realName)+"</td>";l+="	<td>"+p.status+"</td>";l+="	<td>"+p.mobilephone+"</td>";if(f!==-1){l+='	<td><a href="javascript:modaluserdetail('+k+')">详情</a></td>'}if(h!==-1){l+='	<td><a href="javascript:modaluserupdate('+k+')">修改</a></td>'}if(j!==-1){l+='	<td><a href="javascript:modaluserdelete('+k+')">删除</a></td>'}l+="</tr>"}d.html(l);var o=setPage(n.result.totalCount,b,"'pager_users'");$("#pager_users > ul").html(o)}else{showPopover(n.info)}}})}function modaluserdetail(a){var c=users[a].id;var b={id:c};$.ajax({type:"GET",async:true,url:urls.user.detail,data:b,dataType:"jsonp",success:function(f){if(f.success){var d=f.result;$("#span_detail_userid").html(d.id);$("#span_detail_username").html(d.username?d.username:"无");$("#span_detail_realname").html(d.realName?d.realName:"无");$("#span_detail_email").html(d.email?d.email:"无");$("#span_detail_status").html(d.status?d.status:"无");$("#span_detail_fax").html(d.fax?d.fax:"无");$("#span_detail_company").html(d.companyName?d.companyName:"无");$("#span_detail_companyAddress").html(d.companyAddress?d.companyAddress:"无");$("#span_detail_companyEmail").html(d.companyEmail?d.companyEmail:"无");$("#span_detail_companyPhone").html(d.companyPhone?d.companyPhone:"无");$("#span_detail_companyRemarks").html(d.companyRemarks?d.companyRemarks:"无");$("#span_detail_mobile").html(d.mobilePhone?d.mobilePhone:"无");$("#span_detail_phone").html(d.telephone?d.telephone:"无");$("#span_detail_sex").html(d.sex?d.sex:"无");$("#span_detail_remarks").html(d.remarks?d.remarks:"无");$("#span_detail_zipcode").html(d.zipcode?d.zipcode:"无");$("#modal_detail_user").modal({keyboard:false})}else{showPopover(f.info)}}})}function modaluserupdate(a){var c=users[a].id;var b={id:c};$.ajax({type:"GET",async:true,url:urls.user.detail,data:b,dataType:"jsonp",success:function(f){if(f.success){var d=f.result;$("#txt_update_userid").val(d.id);$("#txt_update_username").html(d.username);$("#txt_update_userstatus").val(d.status?d.status:4);$("#txt_update_userremarks").val(d.remarks?d.remarks:"");$("#modal_update_user").modal({keyboard:false})}else{showPopover(f.info)}}})}function updateUser(){var b=$("#txt_update_userid").val();var a={id:b,status:$("#txt_update_userstatus").val(),remarks:$("#txt_update_userremarks").val()};console.log(a);$.ajax({type:"GET",async:true,url:urls.user.update,data:a,dataType:"jsonp",success:function(c){if(c&&c.success){showPopover("用户修改成功");$("#modal_update_user").modal("hide");searchUsers()}else{showPopover(c.info)}}})}function modaluserdelete(b){var a=users[b];$("#txt_delete_userid").val(a.id);$("#span_delete_user").html('确定要删除用户"'+a.username+'"吗？删除后不可恢复。');$("#modal_delete_user").modal({keyboard:false})}function deleteUser(){var b=$("#txt_delete_userid").val();var a={id:b};$.ajax({type:"GET",async:true,url:urls.user.remove,data:a,dataType:"jsonp",success:function(c){if(c.success){$("#modal_delete_user").modal("hide");showPopover("删除成功");searchUsers()}else{showPopover(c.info)}}})}function verifypassword(){var a=false;a=verifyOldPassword();if(a===false){return a}a=verifyNewPassword();if(a===false){return a}a=verifyNewPasswordSure();return a}function verifyOldPassword(){var a=$("#txt_oldpassword").val();if(a===""){showPopover("请输入旧密码");return false}return true}function verifyNewPassword(){var a=$("#txt_newpassword").val();if(a===""){showPopover("请输入新密码");return false}return true}function verifyNewPasswordSure(){var a=$("#txt_newpasswordsure").val();if(a===""){showPopover("请确认新密码");return false}return true};