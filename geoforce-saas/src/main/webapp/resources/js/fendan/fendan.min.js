$(function() {
	Map.initMap()
});
var Map = {};
Map.initMap = function() {
	controls_zoombars = [ new SuperMap.Control.Navigation({
		dragPanOptions : {
			enableKinetic : !0
		}
	}) ], map = new SuperMap.Map("map", {
		controls : controls_zoombars,
		allOverlays : !0
	}), Map.init(), layer_branches = new SuperMap.Layer.Vector("branches"), layer_orders = new SuperMap.Layer.Vector("orders", {
		renderers : [ "Canvas2" ]
	});
	var e = new SuperMap.Strategy.GeoText;
	e.style = SuperMap.Egisp.Zone.getRegionTextStyle(), layer_region_label = new SuperMap.Layer.Vector("Label", {
		renderers : [ "Canvas2" ],
		strategies : [ e ]
	}), layer_region = new SuperMap.Layer.Vector("region", {
		renderers : [ "Canvas2" ]
	}), layer_edit_branch = new SuperMap.Layer.Vector("edit_branch", {
		renderers : [ "Canvas2" ]
	}), layer_boundry = new SuperMap.Layer.Vector("boundry", {
		renderers : [ "Canvas2" ]
	}), layer_cloudpois = new SuperMap.Layer.Vector("cloud_pois", {
		renderers : [ "Canvas2" ]
	}), map.addLayers([ layer_boundry, layer_cloudpois, layer_region, layer_region_label, layer_branches, layer_orders, layer_edit_branch ]), layer_branches.setVisibility(!1), layer_region.setVisibility(!1), layer_region_label.setVisibility(!1), map.setCenter(new SuperMap.LonLat(12958400.883957, 4852082.440605948), 11), SuperMap.Egisp.SMCity.initUserCity(Map.initDatas);SuperMap.Egisp.Zone.getRegionSelectStyle();control_select = new SuperMap.Control.SelectFeature([ layer_orders, layer_branches, layer_region ], {
		onSelect : Map.regionSelect,
		onUnselect : Map.regionUnSelect,
		multiple : !1,
		hover : !1
	}), map.addControl(control_select), control_select.activate();
	var a = new SuperMap.Control.OverviewMap({
			id : "overviewMap",
			maximized : !1
		}),
		t = new SuperMap.Layer.CloudLayer({
			url : urls.map_img
		});
	a.layers = [ t ], map.addControl(a), map.events.on({
		zoomend : Map.zoomEnd
	})
}, Map.initDatas = function() {
	SuperMap.Egisp.SMCity.cityTagClick = function() {
		Map.searchBranches()
	}
}, Map.ipLocate = function() {
	SuperMap.Egisp.showMask(), SuperMap.Egisp.IPLocate(urls.ip_locate, function(e) {
		SuperMap.Egisp.hideMask(), SuperMap.Egisp.SMCity.init(e)
	}, function() {
		SuperMap.Egisp.hideMask(), SuperMap.Egisp.SMCity.init({
			city : "北京"
		})
	})
}, Map.zoomEnd = function(e) {
	var a = e.object.zoom;
	$(".olAlphaImg").attr("title", a);
	var t = btn.attr("isShowRegion") ? !0 : !1;
	a > 4 ? (btn.prop("checked", t), layer_region.setVisibility(t), layer_region_label.setVisibility(t), layer_boundry.setVisibility(!0)) : (btn.prop("checked", !1), layer_region.setVisibility(!1), layer_region_label.setVisibility(!1), layer_boundry.setVisibility(!1))
}, Map.showBranchLayer = function() {
	var e = $(this),
		a = e.prop("checked");
	layer_branches.setVisibility(a), a && 0 === layer_branches.features.length ? Map.searchBranches() : Map.isDragging || map.removeAllPopup()
}, Map.regionSelect = function(e) {
	var a = e.attributes.type;
	switch (a) {
	case "point":
		Map.selectBranch(e);
		break;case "region":
		selectedFeature = e, e.style = SuperMap.Egisp.Zone.getRegionSelectStyle(e.attributes.name), layer_region.redraw();
		break;case "order":
		Map.selectOrder(e);
		break;case "order-edit":
		Map.openEditOrderPopup(e.attributes);
		break;case "point-national":
		SuperMap.Egisp.SMCity.showCurrentProvince(e.attributes.province, e.attributes.admincode), SuperMap.Egisp.SMCity.cityTagClick()
	}
}, Map.regionUnSelect = function(e) {
	var a = e.attributes.type;
	"region" === a && (e.style = e.attributes.oldStyle, layer_region.redraw(), selectedFeature = null, $("#txt_areaName, #txt_areaId").val(""))
}, Map.showRegionLayer = function() {
	var e = $(this),
		a = e.prop("checked");
	if (a) {
		var t = $(".smcity").attr("admincode");
		if (!t || "" === t) return SuperMap.Egisp.showHint("如果查看区划，请选择省市"), void e.prop("checked", !1);
		var r = map.getZoom();
		if (5 > r) return SuperMap.Egisp.showHint("请将地图放大到5级以上再显示区划"), void e.prop("checked", !1);
		Map.searchRegions(), e.attr("isShowRegion", "true")
	} else e.removeAttr("isShowRegion");
	layer_region.setVisibility(a), layer_region_label.setVisibility(a)
}, Map.searchRegions = function() {
	layer_region.removeAllFeatures(), layer_region_label.removeAllFeatures();
	var e = $(".smcity"),
		a = e.attr("admincode"),
		t = e.attr("level");
	if ("" === a) return void SuperMap.Egisp.showPopover("查询区划请选择省");
	SuperMap.Egisp.showMask();
	var r = {
		admincode : a,
		level : t
	};
	SuperMap.Egisp.Zone.search(r, function(e) {
		SuperMap.Egisp.hideMask(), Map.showRegionsToMap(e)
	}, function() {
		SuperMap.Egisp.hideMask(), SuperMap.Egisp.showPopover("当前查询到0条区划数据"), layer_region.removeAllFeatures(), layer_region_label.removeAllFeatures()
	})
}, Map.showRegionsToMap = function(e) {
	var a = e.length;
	if (0 === a) return void SuperMap.Egisp.showPopover("当前查询到0条区划数据");
	for (var t = [], r = [], i = a; i--;) {
		var o = e[i];
		o.name || (o.name = "");var p = o.points,
			s = o.parts;
		if (s && 0 != s.length) {
			var n = o;
			n.parts = null, n.points = null, n.type = "region";
			var l = SuperMap.Egisp.Zone.DrawRegion(s, p),
				u = SuperMap.Egisp.Zone.getRegionStyle(o.name);
			n.oldStyle = u;
			var c = new SuperMap.Feature.Vector(l, n, u);
			t.push(c);
			var d = new SuperMap.Geometry.GeoText(o.center.x, o.center.y, o.name),
				m = new SuperMap.Feature.Vector(d);
			m.style = SuperMap.Egisp.Zone.getRegionTextStyle(), m.attributes = {
				type : "text-region"
			}, r.push(m)
		}
	}
	layer_region.addFeatures(t), layer_region_label.addFeatures(r)
}, Map.clear = function() {
	$("#btn_showBranch, #btn_showRegion").prop("checked", !1), $("#btn_showRegion").removeAttr("isShowRegion"), layer_region.removeAllFeatures(), layer_region.setVisibility(!1), layer_region_label.removeAllFeatures(), layer_region_label.setVisibility(!1), layer_branches.removeAllFeatures(), layer_branches.setVisibility(!1), map.removeAllPopup(), Map.popup = null, SuperMap.Egisp.Order.Table.clear(), layer_orders.removeAllFeatures(), Map.endDragBranch()
}, Map.pan = function() {
	Map.endDragBranch(), map.removeAllPopup(), Map.popup = null
}, Map.search = function() {
	var e = $(".data-list .search-input").val(),
		a = $("#data_pager"),
		t = Number(a.attr("page")) + 1,
		r = {
			pageSize : 10,
			pageNo : t
		};
	"" != e && (r.batch = e), SuperMap.Egisp.showMask(), layer_orders.removeAllFeatures(), SuperMap.Egisp.Order.search(r, function(e) {
		SuperMap.Egisp.hideMask(), SuperMap.Egisp.Order.Table.refresh(e), Map.showOrdersToMap(e);
		var a = $(".data-list .search-input");
		"" == a.val() && a.val(e[0].batch)
	}, function(e) {
		SuperMap.Egisp.hideMask(), SuperMap.Egisp.Order.Table.clear(), SuperMap.Egisp.showPopover(e)
	})
}, Map.showOrdersToMap = function(e) {
	layer_orders.removeAllFeatures();
	for (var a = [], t = e.length, r = t; r--;) {
		var i = e[r],
			o = new SuperMap.Geometry.Point(i.smx, i.smy),
			p = new SuperMap.Feature.Vector(o);
		p.style = {
			externalGraphic : urls.server + "/resources/assets/map/poi-green.png",
			graphicWidth : 20,
			graphicHeight : 30,
			graphicTitle : i.address,
			cursor : "pointer"
		}, i.order = r + 1, p.attributes = i, p.attributes.type = "order", a.push(p)
	}
	layer_orders.addFeatures(a)
}, Map.selectOrder = function(e) {
	var a = e.attributes;
	Map.openOrderAttrPopup(a)
}, Map.openOrderAttrPopup = function(e) {
	var a = SuperMap.Egisp.Order.getAttrPopupHtml(e),
		t = new SuperMap.LonLat(e.smx, e.smy);
	Map.popup = null, Map.popup = new SuperMap.Popup.FramedCloud("popup-near", t, new SuperMap.Size(300, 70), a, null, !1, null), Map.popup.autoSize = !0, Map.popup.panMapIfOutOfView = !0, Map.popup.relativePosition = "tr", map.removeAllPopup(), map.addPopup(Map.popup), e.lonlat = t, $(".popup-close").unbind("click").click(function() {
		Map.popup.hide()
	}), $(".popup-edit").unbind("click").click(function() {
		Map.showEditOrder(e)
	}), $("#table_orders tbody tr").removeClass("action");
	var r = $('#table_orders tbody tr[data-id="' + e.id + '"]').addClass("action"),
		i = $(".data-list .data-results"),
		o = r[0].offsetTop,
		p = i[0].scrollTop;
	(Math.abs(o - p) > i.height() || p > o) && i.animate({
		scrollTop : o
	}, 100)
}, Map.getOrderFromLayerById = function(e) {
	var a = layer_orders.features,
		t = a.length;
	if (1 > t) return null;
	for (var r = t; r--;) {
		var i = a[r];
		if (i.attributes.id === e) return i
	}
	return null
}, Map.checkImportFileSize = function() {
	var e = document.getElementById("txt_import_orders"),
		a = $(".data-import .body .import-hint.black");
	if (urls.ie_case) {
		if ("" == e.value) return SuperMap.Egisp.showPopover("请选择文件"), a.html(""), !1;
		var t = e.value,
			r = t.split("\\");
		return t = r[r.length - 1], a.html(t), !0
	}
	var i = e.files,
		a = $(".data-import .body .import-hint.black");
	if (!i || i.length < 1) return SuperMap.Egisp.showPopover("请选择文件"), a.html(""), !1;
	var o = i[0];
	return o.size > 2048e3 ? (a.html("文件大于2M，请重新选择"), !1) : (a.html(o.name + "(" + o.size + "b)"), !0)
}, Map.importOrders = function() {
	var e = Map.checkImportFileSize();
	if (e) {
		SuperMap.Egisp.showMask();
		var a = {
			success : function(e) {
				if (SuperMap.Egisp.hideMask(), e = urls.ie_case ? $.parseJSON($(e).text()) : JSON.parse(e), e.isSuccess) {
					$(".data-import").fadeOut("fast"), $("p.unclose-hint").html(e.info), $("#modal_showHint").modal({
						backdrop : "static",
						keyboard : !1
					}), map.removeAllPopup(), Map.endDragBranch(), layer_edit_branch.removeAllFeatures(), SuperMap.Egisp.showPopover("文件上传成功");
					var a = [];
					if (e.result && e.result.records && e.result.records.length > 0) {
						a = e.result.records, SuperMap.Egisp.Order.Table.refresh(a), Map.showOrdersToMap(a);
						var t = SuperMap.Egisp.setPage(e.result.totalCount, e.result.page - 1, "'data_pager'");
						$("#data_pager > ul").html(t), $("#data_pager").show(), $(".page-marker").html("第" + e.result.page + "/" + Math.ceil(e.result.totalCount / 10) + "页"), $(".data-list .search-input").val(a[0].batch)
					}
				} else SuperMap.Egisp.showPopover(e.info ? e.info : "订单导入失败")
			}
		};
		$("#form_import_data").ajaxSubmit(a)
	}
}, Map.showSuccessData = function() {
	Map.showDatas(SuperMap.Egisp.Order.Table.data_success)
}, Map.showFailedData = function() {
	Map.showDatas(SuperMap.Egisp.Order.Table.data_failed)
}, Map.showDatas = function(e) {
	map.removeAllPopup(), layer_orders.removeAllFeatures(), Map.endDragBranch();
	var a = e.length;
	return 0 === a ? ($(".data-list table tbody").html(""), void $(".data-list .totality").html("(0条)")) : (Map.showOrdersToMap(e), void SuperMap.Egisp.Order.Table.refresh(e))
}, Map.showEditOrder = function(e) {
	layer_edit_branch.removeAllFeatures();
	var a = e.lonlat,
		t = new SuperMap.Geometry.Point(a.lon, a.lat),
		r = new SuperMap.Feature.Vector(t);
	r.style = {
		externalGraphic : urls.server + "/resources/assets/map/editBranch.png",
		graphicWidth : 20,
		graphicHeight : 30,
		graphicTitle : "手动分单",
		cursor : "pointer"
	}, e.x = t.x, e.y = t.y, e.type = "order-edit", r.attributes = e, layer_edit_branch.addFeatures(r), Map.enableEdit()
}, Map.openEditOrderPopup = function(e) {
	var a = SuperMap.Egisp.Order.getEditPopupHtml(e);
	Map.popup = new SuperMap.Popup.FramedCloud("popup-edit", e.lonlat, new SuperMap.Size(300, 70), a, null, !1, null), Map.popup.autoSize = !0, Map.popup.panMapIfOutOfView = !0, Map.popup.relativePosition = "tr", map.removeAllPopup(), map.addPopup(Map.popup), $(".popup-close").unbind("click").click(function() {
		Map.endDragBranch(), map.removeAllPopup(), Map.popup = null
	}), $(".popup-sure").attr("data-id", e.id).unbind("click").click(Map.editOrder)
}, Map.editOrder = function() {
	var e = $(this).attr("data-id"),
		a = Map.popup.lonlat,
		t = {
			id : e,
			smx : a.lon,
			smy : a.lat
		};
	SuperMap.Egisp.showMask(), SuperMap.Egisp.Order.manual(t, function() {
		SuperMap.Egisp.showPopover("操作成功"), map.removeAllPopup(), Map.endDragBranch(), Map.search()
	}, function(e) {
		var a = e.info ? e.info : "操作失败";
		SuperMap.Egisp.showPopover(a)
	})
}, $(function() {
	$(".zoom-in").on("click", function() {
		map.zoomIn()
	}), $(".zoom-out").on("click", function() {
		map.zoomOut()
	}), $(".map-zoom").html(map.getZoom()), map.events.on({
		moveend : function() {
			$(".map-zoom").html(map.getZoom())
		}
	});
	var e = map.getControl("overviewMap");
	e.showToggle = function(e) {
		this.maximizeDiv.style.display = e ? "" : "none", this.minimizeDiv.style.display = e ? "none" : "", console.log(e), e ? $(".zoom-control").removeClass("higher") : $(".zoom-control").addClass("higher")
	}
}), Map.using = !0, Map.layer = null, Map.layer_townboundry = null, Map.showTownBoundry = !1, Map.cloud_resolutions = [ 156543.033928041, 78271.5169640203, 39135.7584820102, 19567.8792410051, 9783.93962050254, 4891.96981025127, 2445.98490512563, 1222.99245256282, 611.496226281409, 305.748113140704, 152.874056570352, 76.4370282851761, 38.218514142588, 19.109257071294, 9.55462853564701, 4.77731426782351, 2.38865713391175, 1.19432856695588, .59716428347793 ], Map.init = function(e) {
	var a = Dituhui.User.special ? urls.map_img_special : urls.map_img;
	Map.layer = new SuperMap.Layer.CloudLayer({
		url : a
	}), map.addLayer(Map.layer), map.setLayerIndex(Map.layer, 0), map.setBaseLayer(Map.layer), e === !0 && (Map.showTownBoundry = !0, Map.layer_townboundry = new SuperMap.Layer.CloudLayer({
		url : urls.map_townboundry,
		s : 2,
		resolutions : Map.cloud_resolutions.slice(12)
	}), map.addLayer(Map.layer_townboundry), map.setLayerIndex(Map.layer_townboundry, 1)), $("a.to-supermap").click(Map.use), $(".nav-tools .second-menu a").removeClass("action").addClass("normal"), $("a.to-supermap").removeClass("normal").addClass("action")
}, Map.use = function() {
	if (!Map.using) {
		var e = map.getCenter(),
			a = map.getZoom();
		Baidu.unuse(), Map.layer = new SuperMap.Layer.CloudLayer({
			url : urls.map_img
		}), map.addLayer(Map.layer), map.setLayerIndex(Map.layer, 0), map.setBaseLayer(Map.layer);
		var t = $("#btn_showCountryBoundry");
		t.length > 0 && ($("#btn_showCountryBoundry").parents("li.sec").removeClass("hide"), map.addLayer(layer_countyboundry), map.setLayerIndex(layer_countyboundry, 1)), Map.showTownBoundry === !0 && (Map.layer_townboundry = new SuperMap.Layer.CloudLayer({
			url : urls.map_townboundry,
			s : 2,
			resolutions : Map.cloud_resolutions.slice(12)
		}), map.addLayer(Map.layer_townboundry), map.setLayerIndex(Map.layer_townboundry, 1)), Map.using = !0;
		var r = Baidu.restoreCoord(e.lon, e.lat);
		map.setCenter(new SuperMap.LonLat(r.x, r.y), a + 2), Map.redrawBoundry(), Map.redrawDataPoints(), $(".map-copyright").html("&copy;2014 SuperMap - GS(2014)6070号-data&copy;Navinfo"), $(".nav-tools .second-menu a").removeClass("action").addClass("normal"), $("a.to-supermap").removeClass("normal").addClass("action")
	}
}, Map.unuse = function() {
	if (Map.using) {
		Map.using = !1, map.removeLayer(Map.layer, !1), Map.layer = null, Map.showTownBoundry === !0 && (map.removeLayer(Map.layer_townboundry, !1), Map.layer_townboundry = null);
		var e = $("#btn_showCountryBoundry");
		e.length > 0 && ($("#btn_showCountryBoundry").parents("li.sec").addClass("hide"), map.removeLayer(layer_countyboundry))
	}
}, Map.redrawBoundry = function() {
	for (var e = layer_boundry.features, a = [], t = e.length; t--;) {
		var r = e[t],
			i = r.attributes,
			o = Dituhui.Zone.DrawRegion(i.geo.parts, i.geo.points),
			p = new SuperMap.Feature.Vector(o, i, r.style);
		a.push(p)
	}
	layer_boundry.removeAllFeatures(), layer_boundry.addFeatures(a)
}, Map.redrawDataPoints = function() {
	1 == $("#btn_showBranch").prop("checked") && Map.searchBranches(), 1 == $("#btn_showRegion").prop("checked") && Map.searchRegions(), layer_cloudpois.features.length > 0 && Map.searchFromCloud(), map.removeAllPopup()
}, $(function() {
	Dituhui.Point.Style.search()
}), Map.searchBranches = function() {
	layer_branches.removeAllFeatures();
	var e = {
		pageNo : -1
	};
	Dituhui.Point.Search(e, function(e) {
		var a = $(".smcity").attr("level");
		"0" != a ? Map.showBranchesToMap(e) : Dituhui.Point.National.display(e)
	}, function() {})
}, Map.showBranchesToMap = function(e) {
	layer_branches.removeAllFeatures();
	var a = e ? e.length : 0;
	if (0 === a) return void Dituhui.showPopover("当前查询到0条网点数据");
	for (var t = [], r = 0; a > r; r++) {
		var i = e[r];
		if (i.smx && 0 != i.smx) {
			i.iconStyle || (i.iconStyle = urls.server + "/resources/assets/map/red/s.png");
			{
				var o = Dituhui.Point.getBranchStyle(i.iconStyle);
				new SuperMap.Size(o.width, o.height)
			}
			if (Baidu && Baidu.using) {
				var p = Baidu.getCoord(i.smx, i.smy);
				i.smx = p.x, i.smy = p.y
			}
			var s = new SuperMap.Geometry.Point(i.smx, i.smy),
				n = new SuperMap.Feature.Vector(s);
			n.style = Dituhui.Point.getBranchStyle(i), n.attributes = i, n.attributes.type = "point", t.push(n)
		}
	}
	layer_branches.addFeatures(t)
}, Map.selectBranch = function(e) {
	var a = e.attributes;
	a.lonlat = new SuperMap.LonLat(a.smx, a.smy), Map.openBranchAttrPopup(a)
}, Map.openBranchAttrPopup = function(e) {
	var a = (e.netPicPath ? urls.server + "/pointService/getImg?path=" + e.netPicPath : "assets/map/branch.png", '<div class="map-popup">');
	a += Dituhui.Point.getAttrPopupHtml(e, !1), a += "</div>", Map.popup = new SuperMap.Popup.FramedCloud("popup-near", e.lonlat, new SuperMap.Size(300, 70), a, null, !1, null), Map.popup.autoSize = !0, Map.popup.panMapIfOutOfView = !0, Map.popup.relativePosition = "tr", map.removeAllPopup(), map.addPopup(Map.popup);
	var t = $(".bind-cars");
	Dituhui.Point.getBindingCars(e.id, function(e) {
		t.html(e)
	}, function() {
		t.html("")
	}), Map.Pictures.search(e.id), $(".popup-close").unbind("click").click(function() {
		Map.popup.hide()
	}), $(".popup-edit").unbind("click").click(function() {
		Map.showEditOrder(e)
	})
}, Map.Pictures = {}, Map.Pictures.search = function(e) {
	Dituhui.Point.Pictures.search(e, function(e) {
		var a = e.length;
		Map.Pictures.view(e);
		var t = '<img src="' + urls.server + "/pointService/getImg?path=" + e[0].filepath.replace(/\\/g, "/") + '">';
		t += '<div class="count"><span>' + a + "张</span></div>", $(".photo").removeClass("none").html(t).unbind("click").click(function() {
			$(".view-pictures").removeClass("hide")
		}), $(".upload-pictures-title").html("图集(" + a + ")")
	}, function() {
		$(".photo").removeClass("none").unbind("click").addClass("none").html("")
	})
}, Map.Pictures.view = function(e) {
	for (var a = [], t = 0, r = e.length; r > t; t++) a.push({
			image : urls.server + "/pointService/getImg?path=" + e[t].filepath.replace(/\\/g, "/")
		});
	Map.Pictures.viewPictures(a)
};
var rotateAngle = 0,
	galleria_zoom = 0;
Map.Pictures.viewPictures = function(e) {
	rotateAngle = 0, galleria_zoom = 0, Galleria.destroy && Galleria.destroy(), 0 == Galleria.getLoadedThemes().length && Galleria.loadTheme(urls.server + "/resources/js/public/galleria/themes/classic/galleria.classic.min.js"), Galleria.run("#images", {
		dataSource : e,
		image_crop : !0,
		transition : "fade",
		maxScaleRatio : 1,
		thumbCrop : !1
	}), $(".show-img-btn.zoom-in").unbind("click").click(function() {
		if (!(galleria_zoom >= 5)) {
			var e = $($(".images").data("galleria").getActiveImage()),
				a = e.width(),
				t = e.height();
			e.width(1.2 * a), e.height(1.2 * t);
			var r = e.parent(".galleria-image").width() / 2 - e.width() / 2;
			e.css("left", r);
			var i = e.parent(".galleria-image").height() / 2 - e.height() / 2;
			e.css("top", i), galleria_zoom++
		}
	}), $(".show-img-btn.turn-left").unbind("click").click(function() {
		rotateAngle -= 90, $($(".images").data("galleria").getActiveImage()).rotate({
			animateTo : rotateAngle
		})
	}), $(".show-img-btn.turn-right").unbind("click").click(function() {
		rotateAngle += 90, console.log($($(".images").data("galleria").getActiveImage())), $($(".images").data("galleria").getActiveImage()).rotate({
			animateTo : rotateAngle
		})
	}), $(".show-img-btn.full-img").unbind("click").click(function() {
		var e = $(".images").data("galleria").getActiveImage();
		window.open(e.src.split("@")[0])
	}), $(".show-img-btn.shut").click(function() {
		$(".view-pictures").addClass("hide")
	}), $(".show-img-btn.zoom-out").unbind("click").click(function() {
		if (!(-5 >= galleria_zoom)) {
			var e = $($(".images").data("galleria").getActiveImage()),
				a = e.width(),
				t = e.height();
			e.width(a / 1.2), e.height(t / 1.2);
			var r = e.parent(".galleria-image").width() / 2 - e.width() / 2;
			e.css("left", r);
			var i = e.parent(".galleria-image").height() / 2 - e.height() / 2;
			e.css("top", i), galleria_zoom--
		}
	})
}, $(function() {
	var e = getWindowWidth(),
		a = (getWindowHeight(), urls.getUrlArgs());
	if (Dituhui.User.currentModuleId = a.orderItemId ? a.orderItemId : "", a && "false" == a.isLogined && $(".data-guide").show(), $('li[option="show-children"]').hover(function() {
			$(this).find(" > div").show()
		}, function() {
			$(this).find(" > div").hide()
		}), $(".close, .btn-cancel").click(function() {
			var e = $(this);
			$(e.attr("data-target")).fadeOut("fast")
		}), $("#btn_showBranch").change(Map.showBranchLayer), $("#btn_showRegion").change(Map.showRegionLayer), $("a.clear-map").click(Map.clear), $("a.pan-map").click(Map.pan), $('a[option="add-point"]').click(Map.drawPoint), $(".popover-result, .popover-hint").css({
			left : .5 * (e - 250) + "px"
		}), $("#txt_keyword_cloud").keyup(function(e) {
			13 === e.keyCode && Map.searchFromCloud()
		}), $("a.to-supermap").click(Map.toSuperMap), $("a.to-google").click(Map.toGoogleMap), $("a.to-tianditu").click(Map.toTiandituMap), $(".data-list .head .first").click(Page.cssTableFirst), $(".data-list .head .second").click(Page.cssTableSecond), $(".data-list .head .third").click(Page.cssTableThird), $(".data-list .head .title").click(Page.cssTableTitleClick), $(".data-list .head .import").click(function() {
			$(".data-import").fadeIn("fast")
		}), $("a.btn-select-file").click(function() {
			$(this).find("+ input").click()
		}), $("#form_import_data").attr("action", urls.server + "/orderService/upload?moduleId=" + Dituhui.User.currentModuleId), $("#btn_import_orders").click(Map.importOrders), $('a[option="update-cell"]').click(Map.updateCell), $(".text-cell-edit").keyup(function(e) {
			13 === e.keyCode && Map.updateCell()
		}), $('a[option="add-column-server"]').click(Map.addColumn), $('a[option="rename-column-server"]').click(Map.renameColumn), $(".text-column-add").keyup(function(e) {
			13 === e.keyCode && Map.addColumn()
		}), $(".a-data-success").click(Map.showSuccessData), $(".a-data-failed").click(Map.showFailedData), $(".data-list .search-input").keyup(function(e) {
			if (13 === e.keyCode) {
				var a = $(this).val();
				if ("" == a || 0 === a.length) return void Dituhui.showPopover("请输入订单批次查询");
				$("#pager_orders").attr("page", 0), Map.search()
			}
		}), $(".data-list .btn-search").click(function() {
			var e = $(".data-list .search-input").val();
			return "" == e || 0 === e.length ? void Dituhui.showPopover("请输入订单批次查询") : ($("#pager_orders").attr("page", 0), void Map.search())
		}), $(".data-list .head .import").click(function() {
			$(".data-import").fadeIn("fast")
		}), "Microsoft Internet Explorer" == navigator.appName) {
		var t = navigator.appVersion.split(";");
		t = parseInt(t[1].replace(/[ ]/g, "").replace(/MSIE/g, "")), 10 > t && ($(".btn-select-file").hide(), $("#txt_import_orders").css("display", "block"), urls.ie_case = !0)
	}
	$(".data-guide .start").click(function() {
		$(".data-guide").hide()
	}), Page.initcss(), $(window).resize(Page.initcss), Map.search()
});
var Page = {
		initcss : function() {
			setTimeout(function() {
				map.updateSize()
			}, 100)
		},
		cssTableFirst : function() {
			var e = $(this),
				a = $(".data-list"),
				t = a.attr("status");
			switch (t) {
			case "min":
				a.attr("status", "left-max"), e.removeClass("up").addClass("bottom").attr("title", "向下缩放");
				break;case "left-max":
				a.attr("status", "min"), e.removeClass("bottom").addClass("up").attr("title", "向上展开");
				break;case "bottom-max":
				a.attr("status", "min"), e.removeClass("bottom").addClass("up").attr("title", "向下缩放"), a.find(".second").removeClass("up").addClass("right").attr("title", "向右展开");
				break;case "max":
				a.attr("status", "left-max"), e.removeClass("left").addClass("bottom").attr("title", "向下缩放"), a.find(".second").removeClass("bottom").addClass("right").attr("title", "向右展开")
			}
		},
		cssTableSecond : function() {
			var e = (getWindowWidth(), getWindowHeight(), $(this)),
				a = $(".data-list"),
				t = a.attr("status");
			switch (t) {
			case "min":
				a.attr("status", "bottom-max"), e.removeClass("right").addClass("up").attr("title", "向上展开"), a.find(".first").removeClass("up").addClass("bottom").attr("title", "向下缩放");
				break;case "bottom-max":
				a.attr("status", "max"), e.removeClass("up").addClass("bottom").attr("title", "向下缩放"), a.find(".first").removeClass("bottom").addClass("left").attr("title", "向左缩放");
				break;case "max":
				a.attr("status", "bottom-max"), e.removeClass("bottom").addClass("up").attr("title", "向上展开"), a.find(".first").removeClass("left").addClass("bottom").attr("title", "向下缩放");
				break;case "left-max":
				a.attr("status", "max"), e.removeClass("right").addClass("bottom").attr("title", "向下缩放"), a.find(".first").removeClass("bottom").addClass("left").attr("title", "向左缩放")
			}
		},
		cssTableThird : function() {
			var e = $(".data-list");
			e.attr("status", "min"), e.find(".second").removeClass("bottom").addClass("right").attr("title", "向右展开"), e.find(".first").removeClass("left").addClass("up").attr("title", "向上展开")
		},
		cssTableTitleClick : function() {
			var e = (getWindowWidth(), getWindowHeight(), $(".data-list"));
			"min" == e.attr("status") && (e.attr("status", "left-max"), e.find(".first").removeClass("up").addClass("bottom").attr("title", "向下缩放"), e.find(".second").removeClass("bottom").addClass("right").attr("title", "向右展开"))
		}
	},
	drag = null,
	layer_edit_temp = null;
Map.isDragging = !1, Map.enableEdit = function() {
	var e = layer_edit_branch.features[0];
	layer_edit_temp = new SuperMap.Layer.Vector("edit_temp"), map.addLayer(layer_edit_temp), layer_edit_temp.addFeatures(e), layer_edit_branch.removeAllFeatures(), drag = new SuperMap.Control.DragFeature(layer_edit_temp), map.addControl(drag), drag.activate(), Map.isDragging = !0, drag.onComplete = function(e, a) {
		var t = map.getLonLatFromPixel(a);
		if (e.attributes.lonlat = t, null != Map.popup && "popup-edit" === Map.popup.id) Map.popup.hide(), Map.popup.lonlat = t, Map.popup.show();else {
			var r = e.attributes;
			Map.openEditOrderPopup(r)
		}
	}
}, Map.endDragBranch = function() {
	layer_edit_temp && (layer_edit_temp.removeAllFeatures(), drag.deactivate(), map.removeControl(drag), drag = null, map.removeLayer(layer_edit_temp, !0), layer_edit_temp.destroy(), layer_edit_temp = null, Map.isDragging = !1)
};