!function(t,e){if("function"==typeof define&&define.amd)define(["jquery"],e);else if("object"==typeof module&&module.exports){var a;try{a=require("jquery")}catch(i){a=null}module.exports=e(a)}else t.Slider=e(t.jQuery)}(this,function(t){var e;return function(t){"use strict";function e(){}function a(t){function a(e){e.prototype.option||(e.prototype.option=function(e){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e))})}function o(e,a){t.fn[e]=function(o){if("string"==typeof o){for(var n=i.call(arguments,1),s=0,l=this.length;l>s;s++){var c=this[s],u=t.data(c,e);if(u)if(t.isFunction(u[o])&&"_"!==o.charAt(0)){var d=u[o].apply(u,n);if(void 0!==d&&d!==u)return d}else r("no such method '"+o+"' for "+e+" instance");else r("cannot call methods on "+e+" prior to initialization; attempted to call '"+o+"'")}return this}var p=this.map(function(){var i=t.data(this,e);return i?(i.option(o),i._init()):(i=new a(this,o),t.data(this,e,i)),t(this)});return!p||p.length>1?p:p[0]}}if(t){var r="undefined"==typeof console?e:function(t){console.error(t)};return t.bridget=function(t,e){a(e),o(t,e)},t.bridget}}var i=Array.prototype.slice;a(t)}(t),function(t){function a(e,a){function i(t,e){var a="data-slider-"+e,i=t.getAttribute(a);try{return JSON.parse(i)}catch(o){return i}}"string"==typeof e?this.element=document.querySelector(e):e instanceof HTMLElement&&(this.element=e);var o,r,n,s=this.element.style.width,l=!1,c=this.element.parentNode;if(this.sliderElem)l=!0;else{this.sliderElem=document.createElement("div"),this.sliderElem.className="slider";var u=document.createElement("div");u.className="slider-track",o=document.createElement("div"),o.className="slider-selection",r=document.createElement("div"),r.className="slider-handle min-slider-handle",n=document.createElement("div"),n.className="slider-handle max-slider-handle",u.appendChild(o),u.appendChild(r),u.appendChild(n);var d=function(t){var e=document.createElement("div");e.className="tooltip-arrow";var a=document.createElement("div");a.className="tooltip-inner",t.appendChild(e),t.appendChild(a)},p=document.createElement("div");p.className="tooltip tooltip-main",d(p);var h=document.createElement("div");h.className="tooltip tooltip-min",d(h);var m=document.createElement("div");m.className="tooltip tooltip-max",d(m),this.sliderElem.appendChild(u),this.sliderElem.appendChild(p),this.sliderElem.appendChild(h),this.sliderElem.appendChild(m),c.insertBefore(this.sliderElem,this.element),this.element.style.display="none"}t&&(this.$element=t(this.element),this.$sliderElem=t(this.sliderElem)),a=a?a:{};for(var v=Object.keys(this.defaultOptions),f=0;f<v.length;f++){var g=v[f],y=a[g];y="undefined"!=typeof y?y:i(this.element,g),y=null!==y?y:this.defaultOptions[g],this.options||(this.options={}),this.options[g]=y}this.eventToCallbackMap={},this.sliderElem.id=this.options.id,this.touchCapable="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,this.tooltip=this.sliderElem.querySelector(".tooltip-main"),this.tooltipInner=this.tooltip.querySelector(".tooltip-inner"),this.tooltip_min=this.sliderElem.querySelector(".tooltip-min"),this.tooltipInner_min=this.tooltip_min.querySelector(".tooltip-inner"),this.tooltip_max=this.sliderElem.querySelector(".tooltip-max"),this.tooltipInner_max=this.tooltip_max.querySelector(".tooltip-inner"),l===!0&&(this._removeClass(this.sliderElem,"slider-horizontal"),this._removeClass(this.sliderElem,"slider-vertical"),this._removeClass(this.tooltip,"hide"),this._removeClass(this.tooltip_min,"hide"),this._removeClass(this.tooltip_max,"hide"),["left","top","width","height"].forEach(function(t){this._removeProperty(this.trackSelection,t)},this),[this.handle1,this.handle2].forEach(function(t){this._removeProperty(t,"left"),this._removeProperty(t,"top")},this),[this.tooltip,this.tooltip_min,this.tooltip_max].forEach(function(t){this._removeProperty(t,"left"),this._removeProperty(t,"top"),this._removeProperty(t,"margin-left"),this._removeProperty(t,"margin-top"),this._removeClass(t,"right"),this._removeClass(t,"top")},this)),"vertical"===this.options.orientation?(this._addClass(this.sliderElem,"slider-vertical"),this.stylePos="top",this.mousePos="pageY",this.sizePos="offsetHeight",this._addClass(this.tooltip,"right"),this.tooltip.style.left="100%",this._addClass(this.tooltip_min,"right"),this.tooltip_min.style.left="100%",this._addClass(this.tooltip_max,"right"),this.tooltip_max.style.left="100%"):(this._addClass(this.sliderElem,"slider-horizontal"),this.sliderElem.style.width=s,this.options.orientation="horizontal",this.stylePos="left",this.mousePos="pageX",this.sizePos="offsetWidth",this._addClass(this.tooltip,"top"),this.tooltip.style.top=-this.tooltip.outerHeight-14+"px",this._addClass(this.tooltip_min,"top"),this.tooltip_min.style.top=-this.tooltip_min.outerHeight-14+"px",this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top=-this.tooltip_max.outerHeight-14+"px"),this.options.value instanceof Array?this.options.range=!0:this.options.range&&(this.options.value=[this.options.value,this.options.max]),this.trackSelection=o||this.trackSelection,"none"===this.options.selection&&this._addClass(this.trackSelection,"hide"),this.handle1=r||this.handle1,this.handle2=n||this.handle2,l===!0&&(this._removeClass(this.handle1,"round triangle"),this._removeClass(this.handle2,"round triangle hide"));var b=["round","triangle","custom"],_=-1!==b.indexOf(this.options.handle);_&&(this._addClass(this.handle1,this.options.handle),this._addClass(this.handle2,this.options.handle)),this.offset=this._offset(this.sliderElem),this.size=this.sliderElem[this.sizePos],this.setValue(this.options.value),this.handle1Keydown=this._keydown.bind(this,0),this.handle1.addEventListener("keydown",this.handle1Keydown,!1),this.handle2Keydown=this._keydown.bind(this,1),this.handle2.addEventListener("keydown",this.handle2Keydown,!1),this.touchCapable?(this.mousedown=this._mousedown.bind(this),this.sliderElem.addEventListener("touchstart",this.mousedown,!1)):(this.mousedown=this._mousedown.bind(this),this.sliderElem.addEventListener("mousedown",this.mousedown,!1)),"hide"===this.options.tooltip?(this._addClass(this.tooltip,"hide"),this._addClass(this.tooltip_min,"hide"),this._addClass(this.tooltip_max,"hide")):"always"===this.options.tooltip?(this._showTooltip(),this._alwaysShowTooltip=!0):(this.showTooltip=this._showTooltip.bind(this),this.hideTooltip=this._hideTooltip.bind(this),this.sliderElem.addEventListener("mouseenter",this.showTooltip,!1),this.sliderElem.addEventListener("mouseleave",this.hideTooltip,!1),this.handle1.addEventListener("focus",this.showTooltip,!1),this.handle1.addEventListener("blur",this.hideTooltip,!1),this.handle2.addEventListener("focus",this.showTooltip,!1),this.handle2.addEventListener("blur",this.hideTooltip,!1)),this.options.enabled?this.enable():this.disable()}var i={formatInvalidInputErrorMsg:function(t){return"Invalid input value '"+t+"' passed in"},callingContextNotSliderInstance:"Calling context element does not have instance of Slider bound to it. Check your code to make sure the JQuery object returned from the call to the slider() initializer is calling the method"};if(e=function(t,e){return a.call(this,t,e),this},e.prototype={_init:function(){},constructor:e,defaultOptions:{id:"",min:0,max:10,step:1,precision:0,orientation:"horizontal",value:5,range:!1,selection:"before",tooltip:"show",tooltip_split:!1,handle:"round",reversed:!1,enabled:!0,formatter:function(t){return t instanceof Array?t[0]+" : "+t[1]:t},natural_arrow_keys:!1},over:!1,inDrag:!1,getValue:function(){return this.options.range?this.options.value:this.options.value[0]},setValue:function(t,e){t||(t=0);var a=this.getValue();this.options.value=this._validateInputValue(t);var i=this._applyPrecision.bind(this);this.options.range?(this.options.value[0]=i(this.options.value[0]),this.options.value[1]=i(this.options.value[1]),this.options.value[0]=Math.max(this.options.min,Math.min(this.options.max,this.options.value[0])),this.options.value[1]=Math.max(this.options.min,Math.min(this.options.max,this.options.value[1]))):(this.options.value=i(this.options.value),this.options.value=[Math.max(this.options.min,Math.min(this.options.max,this.options.value))],this._addClass(this.handle2,"hide"),this.options.value[1]="after"===this.options.selection?this.options.max:this.options.min),this.diff=this.options.max-this.options.min,this.percentage=this.diff>0?[100*(this.options.value[0]-this.options.min)/this.diff,100*(this.options.value[1]-this.options.min)/this.diff,100*this.options.step/this.diff]:[0,0,100],this._layout();var o=this.options.range?this.options.value:this.options.value[0];return e===!0&&this._trigger("slide",o),a!==o&&this._trigger("change",{oldValue:a,newValue:o}),this._setDataVal(o),this},destroy:function(){this._removeSliderEventHandlers(),this.sliderElem.parentNode.removeChild(this.sliderElem),this.element.style.display="",this._cleanUpEventCallbacksMap(),this.element.removeAttribute("data"),t&&(this._unbindJQueryEventHandlers(),this.$element.removeData("slider"))},disable:function(){return this.options.enabled=!1,this.handle1.removeAttribute("tabindex"),this.handle2.removeAttribute("tabindex"),this._addClass(this.sliderElem,"slider-disabled"),this._trigger("slideDisabled"),this},enable:function(){return this.options.enabled=!0,this.handle1.setAttribute("tabindex",0),this.handle2.setAttribute("tabindex",0),this._removeClass(this.sliderElem,"slider-disabled"),this._trigger("slideEnabled"),this},toggle:function(){return this.options.enabled?this.disable():this.enable(),this},isEnabled:function(){return this.options.enabled},on:function(e,a){return t?(this.$element.on(e,a),this.$sliderElem.on(e,a)):this._bindNonQueryEventHandler(e,a),this},getAttribute:function(t){return t?this.options[t]:this.options},setAttribute:function(t,e){return this.options[t]=e,this},refresh:function(){return this._removeSliderEventHandlers(),a.call(this,this.element,this.options),t&&t.data(this.element,"slider",this),this},relayout:function(){return this._layout(),this},_removeSliderEventHandlers:function(){this.handle1.removeEventListener("keydown",this.handle1Keydown,!1),this.handle1.removeEventListener("focus",this.showTooltip,!1),this.handle1.removeEventListener("blur",this.hideTooltip,!1),this.handle2.removeEventListener("keydown",this.handle2Keydown,!1),this.handle2.removeEventListener("focus",this.handle2Keydown,!1),this.handle2.removeEventListener("blur",this.handle2Keydown,!1),this.sliderElem.removeEventListener("mouseenter",this.showTooltip,!1),this.sliderElem.removeEventListener("mouseleave",this.hideTooltip,!1),this.sliderElem.removeEventListener("touchstart",this.mousedown,!1),this.sliderElem.removeEventListener("mousedown",this.mousedown,!1)},_bindNonQueryEventHandler:function(t,e){void 0===this.eventToCallbackMap[t]&&(this.eventToCallbackMap[t]=[]),this.eventToCallbackMap[t].push(e)},_cleanUpEventCallbacksMap:function(){for(var t=Object.keys(this.eventToCallbackMap),e=0;e<t.length;e++){var a=t[e];this.eventToCallbackMap[a]=null}},_showTooltip:function(){this.options.tooltip_split===!1?this._addClass(this.tooltip,"in"):(this._addClass(this.tooltip_min,"in"),this._addClass(this.tooltip_max,"in")),this.over=!0},_hideTooltip:function(){this.inDrag===!1&&this.alwaysShowTooltip!==!0&&(this._removeClass(this.tooltip,"in"),this._removeClass(this.tooltip_min,"in"),this._removeClass(this.tooltip_max,"in")),this.over=!1},_layout:function(){var t;if(t=this.options.reversed?[100-this.percentage[0],this.percentage[1]]:[this.percentage[0],this.percentage[1]],this.handle1.style[this.stylePos]=t[0]+"%",this.handle2.style[this.stylePos]=t[1]+"%","vertical"===this.options.orientation)this.trackSelection.style.top=Math.min(t[0],t[1])+"%",this.trackSelection.style.height=Math.abs(t[0]-t[1])+"%";else{this.trackSelection.style.left=Math.min(t[0],t[1])+"%",this.trackSelection.style.width=Math.abs(t[0]-t[1])+"%";var e=this.tooltip_min.getBoundingClientRect(),a=this.tooltip_max.getBoundingClientRect();e.right>a.left?(this._removeClass(this.tooltip_max,"top"),this._addClass(this.tooltip_max,"bottom"),this.tooltip_max.style.top="18px"):(this._removeClass(this.tooltip_max,"bottom"),this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top=this.tooltip_min.style.top)}var i;if(this.options.range){i=this.options.formatter(this.options.value),this._setText(this.tooltipInner,i),this.tooltip.style[this.stylePos]=(t[1]+t[0])/2+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px"),"vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px");var o=this.options.formatter(this.options.value[0]);this._setText(this.tooltipInner_min,o);var r=this.options.formatter(this.options.value[1]);this._setText(this.tooltipInner_max,r),this.tooltip_min.style[this.stylePos]=t[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip_min,"margin-top",-this.tooltip_min.offsetHeight/2+"px"):this._css(this.tooltip_min,"margin-left",-this.tooltip_min.offsetWidth/2+"px"),this.tooltip_max.style[this.stylePos]=t[1]+"%","vertical"===this.options.orientation?this._css(this.tooltip_max,"margin-top",-this.tooltip_max.offsetHeight/2+"px"):this._css(this.tooltip_max,"margin-left",-this.tooltip_max.offsetWidth/2+"px")}else i=this.options.formatter(this.options.value[0]),this._setText(this.tooltipInner,i),this.tooltip.style[this.stylePos]=t[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px")},_removeProperty:function(t,e){t.style.removeProperty?t.style.removeProperty(e):t.style.removeAttribute(e)},_mousedown:function(t){if(!this.options.enabled)return!1;this._triggerFocusOnHandle(),this.offset=this._offset(this.sliderElem),this.size=this.sliderElem[this.sizePos];var e=this._getPercentage(t);if(this.options.range){var a=Math.abs(this.percentage[0]-e),i=Math.abs(this.percentage[1]-e);this.dragged=i>a?0:1}else this.dragged=0;this.percentage[this.dragged]=this.options.reversed?100-e:e,this._layout(),this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),this.mousemove&&document.removeEventListener("mousemove",this.mousemove,!1),this.mouseup&&document.removeEventListener("mouseup",this.mouseup,!1),this.mousemove=this._mousemove.bind(this),this.mouseup=this._mouseup.bind(this),this.touchCapable&&(document.addEventListener("touchmove",this.mousemove,!1),document.addEventListener("touchend",this.mouseup,!1)),document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("mouseup",this.mouseup,!1),this.inDrag=!0;var o=this._calculateValue();return this._trigger("slideStart",o),this._setDataVal(o),this.setValue(o),this._pauseEvent(t),!0},_triggerFocusOnHandle:function(t){0===t&&this.handle1.focus(),1===t&&this.handle2.focus()},_keydown:function(t,e){if(!this.options.enabled)return!1;var a;switch(e.keyCode){case 37:case 40:a=-1;break;case 39:case 38:a=1}if(a){if(this.options.natural_arrow_keys){var i="vertical"===this.options.orientation&&!this.options.reversed,o="horizontal"===this.options.orientation&&this.options.reversed;(i||o)&&(a=-1*a)}var r=a*this.percentage[2],n=this.percentage[t]+r;n>100?n=100:0>n&&(n=0),this.dragged=t,this._adjustPercentageForRangeSliders(n),this.percentage[this.dragged]=n,this._layout();var s=this._calculateValue();return this._trigger("slideStart",s),this._setDataVal(s),this.setValue(s,!0),this._trigger("slideStop",s),this._setDataVal(s),this._pauseEvent(e),!1}},_pauseEvent:function(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1},_mousemove:function(t){if(!this.options.enabled)return!1;var e=this._getPercentage(t);this._adjustPercentageForRangeSliders(e),this.percentage[this.dragged]=this.options.reversed?100-e:e,this._layout();var a=this._calculateValue();return this.setValue(a,!0),!1},_adjustPercentageForRangeSliders:function(t){this.options.range&&(0===this.dragged&&this.percentage[1]<t?(this.percentage[0]=this.percentage[1],this.dragged=1):1===this.dragged&&this.percentage[0]>t&&(this.percentage[1]=this.percentage[0],this.dragged=0))},_mouseup:function(){if(!this.options.enabled)return!1;this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1),this.inDrag=!1,this.over===!1&&this._hideTooltip();var t=this._calculateValue();return this._layout(),this._trigger("slideStop",t),this._setDataVal(t),!1},_calculateValue:function(){var t;return this.options.range?(t=[this.options.min,this.options.max],0!==this.percentage[0]&&(t[0]=Math.max(this.options.min,this.options.min+Math.round(this.diff*this.percentage[0]/100/this.options.step)*this.options.step),t[0]=this._applyPrecision(t[0])),100!==this.percentage[1]&&(t[1]=Math.min(this.options.max,this.options.min+Math.round(this.diff*this.percentage[1]/100/this.options.step)*this.options.step),t[1]=this._applyPrecision(t[1]))):(t=this.options.min+Math.round(this.diff*this.percentage[0]/100/this.options.step)*this.options.step,t<this.options.min?t=this.options.min:t>this.options.max&&(t=this.options.max),t=parseFloat(t),t=this._applyPrecision(t)),t},_applyPrecision:function(t){var e=this.options.precision||this._getNumDigitsAfterDecimalPlace(this.options.step);return this._applyToFixedAndParseFloat(t,e)},_getNumDigitsAfterDecimalPlace:function(t){var e=(""+t).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return e?Math.max(0,(e[1]?e[1].length:0)-(e[2]?+e[2]:0)):0},_applyToFixedAndParseFloat:function(t,e){var a=t.toFixed(e);return parseFloat(a)},_getPercentage:function(t){!this.touchCapable||"touchstart"!==t.type&&"touchmove"!==t.type||(t=t.touches[0]);var e=100*(t[this.mousePos]-this.offset[this.stylePos])/this.size;return e=Math.round(e/this.percentage[2])*this.percentage[2],Math.max(0,Math.min(100,e))},_validateInputValue:function(t){if("number"==typeof t)return t;if(t instanceof Array)return this._validateArray(t),t;throw new Error(i.formatInvalidInputErrorMsg(t))},_validateArray:function(t){for(var e=0;e<t.length;e++){var a=t[e];if("number"!=typeof a)throw new Error(i.formatInvalidInputErrorMsg(a))}},_setDataVal:function(t){var e="value: '"+t+"'";this.element.setAttribute("data",e),this.element.setAttribute("value",t)},_trigger:function(e,a){a=a||0===a?a:void 0;var i=this.eventToCallbackMap[e];if(i&&i.length)for(var o=0;o<i.length;o++){var r=i[o];r(a)}t&&this._triggerJQueryEvent(e,a)},_triggerJQueryEvent:function(t,e){var a={type:t,value:e};this.$element.trigger(a),this.$sliderElem.trigger(a)},_unbindJQueryEventHandlers:function(){this.$element.off(),this.$sliderElem.off()},_setText:function(t,e){"undefined"!=typeof t.innerText?t.innerText=e:"undefined"!=typeof t.textContent&&(t.textContent=e)},_removeClass:function(t,e){for(var a=e.split(" "),i=t.className,o=0;o<a.length;o++){var r=a[o],n=new RegExp("(?:\\s|^)"+r+"(?:\\s|$)");i=i.replace(n," ")}t.className=i.trim()},_addClass:function(t,e){for(var a=e.split(" "),i=t.className,o=0;o<a.length;o++){var r=a[o],n=new RegExp("(?:\\s|^)"+r+"(?:\\s|$)"),s=n.test(i);s||(i+=" "+r)}t.className=i.trim()},_offset:function(e){var a,i,o=0,r=0;if(e.offsetParent)do o+=e.offsetLeft,r+=e.offsetTop,a=t(e).css("transform"),"none"!==a&&(i=a.substr(7,a.length-8).split(","),o+=parseInt(i[4],10),r+=parseInt(i[5],10));while(e=e.offsetParent);return{left:o,top:r}},_css:function(e,a,i){if(t)t.style(e,a,i);else{var o=a.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(t,e){return e.toUpperCase()});e.style[o]=i}}},t){var o=t.fn.slider?"bootstrapSlider":"slider";t.bridget(o,e)}}(t),e}),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(t){"use strict";function e(e){var a=e.data;e.isDefaultPrevented()||(e.preventDefault(),t(e.target).ajaxSubmit(a))}function a(e){var a=e.target,i=t(a);if(!i.is("[type=submit],[type=image]")){var o=i.closest("[type=submit]");if(0===o.length)return;a=o[0]}var r=this;if(r.clk=a,"image"==a.type)if(void 0!==e.offsetX)r.clk_x=e.offsetX,r.clk_y=e.offsetY;else if("function"==typeof t.fn.offset){var n=i.offset();r.clk_x=e.pageX-n.left,r.clk_y=e.pageY-n.top}else r.clk_x=e.pageX-a.offsetLeft,r.clk_y=e.pageY-a.offsetTop;setTimeout(function(){r.clk=r.clk_x=r.clk_y=null},100)}function i(){if(t.fn.ajaxSubmit.debug){var e="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(e):window.opera&&window.opera.postError&&window.opera.postError(e)}}var o={};o.fileapi=void 0!==t("<input type='file'/>").get(0).files,o.formdata=void 0!==window.FormData;var r=!!t.fn.prop;t.fn.attr2=function(){if(!r)return this.attr.apply(this,arguments);var t=this.prop.apply(this,arguments);return t&&t.jquery||"string"==typeof t?t:this.attr.apply(this,arguments)},t.fn.ajaxSubmit=function(e){function a(a){var i,o,r=t.param(a,e.traditional).split("&"),n=r.length,s=[];for(i=0;n>i;i++)r[i]=r[i].replace(/\+/g," "),o=r[i].split("="),s.push([decodeURIComponent(o[0]),decodeURIComponent(o[1])]);return s}function n(i){for(var o=new FormData,r=0;r<i.length;r++)o.append(i[r].name,i[r].value);if(e.extraData){var n=a(e.extraData);for(r=0;r<n.length;r++)n[r]&&o.append(n[r][0],n[r][1])}e.data=null;var s=t.extend(!0,{},t.ajaxSettings,e,{contentType:!1,processData:!1,cache:!1,type:l||"POST"});e.uploadProgress&&(s.xhr=function(){var a=t.ajaxSettings.xhr();return a.upload&&a.upload.addEventListener("progress",function(t){var a=0,i=t.loaded||t.position,o=t.total;t.lengthComputable&&(a=Math.ceil(i/o*100)),e.uploadProgress(t,i,o,a)},!1),a}),s.data=null;var c=s.beforeSend;return s.beforeSend=function(t,a){a.data=e.formData?e.formData:o,c&&c.call(this,t,a)},t.ajax(s)}function s(a){function o(t){var e=null;try{t.contentWindow&&(e=t.contentWindow.document)}catch(a){i("cannot get iframe.contentWindow document: "+a)}if(e)return e;try{e=t.contentDocument?t.contentDocument:t.document}catch(a){i("cannot get iframe.contentDocument: "+a),e=t.document}return e}function n(){function e(){try{var t=o(g).readyState;i("state = "+t),t&&"uninitialized"==t.toLowerCase()&&setTimeout(e,50)}catch(a){i("Server abort: ",a," (",a.name,")"),s(S),M&&clearTimeout(M),M=void 0}}var a=d.attr2("target"),r=d.attr2("action"),n="multipart/form-data",c=d.attr("enctype")||d.attr("encoding")||n;C.setAttribute("target",m),(!l||/post/i.test(l))&&C.setAttribute("method","POST"),r!=p.url&&C.setAttribute("action",p.url),p.skipEncodingOverride||l&&!/post/i.test(l)||d.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),p.timeout&&(M=setTimeout(function(){$=!0,s(x)},p.timeout));var u=[];try{if(p.extraData)for(var h in p.extraData)p.extraData.hasOwnProperty(h)&&u.push(t.isPlainObject(p.extraData[h])&&p.extraData[h].hasOwnProperty("name")&&p.extraData[h].hasOwnProperty("value")?t('<input type="hidden" name="'+p.extraData[h].name+'">').val(p.extraData[h].value).appendTo(C)[0]:t('<input type="hidden" name="'+h+'">').val(p.extraData[h]).appendTo(C)[0]);p.iframeTarget||f.appendTo("body"),g.attachEvent?g.attachEvent("onload",s):g.addEventListener("load",s,!1),setTimeout(e,15);try{C.submit()}catch(v){var y=document.createElement("form").submit;y.apply(C)}}finally{C.setAttribute("action",r),C.setAttribute("enctype",c),a?C.setAttribute("target",a):d.removeAttr("target"),t(u).remove()}}function s(e){if(!y.aborted&&!B){if(L=o(g),L||(i("cannot access response document"),e=S),e===x&&y)return y.abort("timeout"),void w.reject(y,"timeout");if(e==S&&y)return y.abort("server abort"),void w.reject(y,"error","server abort");if(L&&L.location.href!=p.iframeSrc||$){g.detachEvent?g.detachEvent("onload",s):g.removeEventListener("load",s,!1);var a,r="success";try{if($)throw"timeout";var n="xml"==p.dataType||L.XMLDocument||t.isXMLDoc(L);if(i("isXml="+n),!n&&window.opera&&(null===L.body||!L.body.innerHTML)&&--T)return i("requeing onLoad callback, DOM not available"),void setTimeout(s,250);var l=L.body?L.body:L.documentElement;y.responseText=l?l.innerHTML:null,y.responseXML=L.XMLDocument?L.XMLDocument:L,n&&(p.dataType="xml"),y.getResponseHeader=function(t){var e={"content-type":p.dataType};return e[t.toLowerCase()]},l&&(y.status=Number(l.getAttribute("status"))||y.status,y.statusText=l.getAttribute("statusText")||y.statusText);var c=(p.dataType||"").toLowerCase(),u=/(json|script|text)/.test(c);if(u||p.textarea){var d=L.getElementsByTagName("textarea")[0];if(d)y.responseText=d.value,y.status=Number(d.getAttribute("status"))||y.status,y.statusText=d.getAttribute("statusText")||y.statusText;else if(u){var m=L.getElementsByTagName("pre")[0],v=L.getElementsByTagName("body")[0];m?y.responseText=m.textContent?m.textContent:m.innerText:v&&(y.responseText=v.textContent?v.textContent:v.innerText)}}else"xml"==c&&!y.responseXML&&y.responseText&&(y.responseXML=z(y.responseText));try{D=A(y,c,p)}catch(b){r="parsererror",y.error=a=b||r}}catch(b){i("error caught: ",b),r="error",y.error=a=b||r}y.aborted&&(i("upload aborted"),r=null),y.status&&(r=y.status>=200&&y.status<300||304===y.status?"success":"error"),"success"===r?(p.success&&p.success.call(p.context,D,"success",y),w.resolve(y.responseText,"success",y),h&&t.event.trigger("ajaxSuccess",[y,p])):r&&(void 0===a&&(a=y.statusText),p.error&&p.error.call(p.context,y,r,a),w.reject(y,"error",a),h&&t.event.trigger("ajaxError",[y,p,a])),h&&t.event.trigger("ajaxComplete",[y,p]),h&&!--t.active&&t.event.trigger("ajaxStop"),p.complete&&p.complete.call(p.context,y,r),B=!0,p.timeout&&clearTimeout(M),setTimeout(function(){p.iframeTarget?f.attr("src",p.iframeSrc):f.remove(),y.responseXML=null},100)}}}var c,u,p,h,m,f,g,y,b,_,$,M,C=d[0],w=t.Deferred();if(w.abort=function(t){y.abort(t)},a)for(u=0;u<v.length;u++)c=t(v[u]),r?c.prop("disabled",!1):c.removeAttr("disabled");if(p=t.extend(!0,{},t.ajaxSettings,e),p.context=p.context||p,m="jqFormIO"+(new Date).getTime(),p.iframeTarget?(f=t(p.iframeTarget),_=f.attr2("name"),_?m=_:f.attr2("name",m)):(f=t('<iframe name="'+m+'" src="'+p.iframeSrc+'" />'),f.css({position:"absolute",top:"-1000px",left:"-1000px"})),g=f[0],y={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(e){var a="timeout"===e?"timeout":"aborted";i("aborting upload... "+a),this.aborted=1;try{g.contentWindow.document.execCommand&&g.contentWindow.document.execCommand("Stop")}catch(o){}f.attr("src",p.iframeSrc),y.error=a,p.error&&p.error.call(p.context,y,a,e),h&&t.event.trigger("ajaxError",[y,p,a]),p.complete&&p.complete.call(p.context,y,a)}},h=p.global,h&&0===t.active++&&t.event.trigger("ajaxStart"),h&&t.event.trigger("ajaxSend",[y,p]),p.beforeSend&&p.beforeSend.call(p.context,y,p)===!1)return p.global&&t.active--,w.reject(),w;if(y.aborted)return w.reject(),w;b=C.clk,b&&(_=b.name,_&&!b.disabled&&(p.extraData=p.extraData||{},p.extraData[_]=b.value,"image"==b.type&&(p.extraData[_+".x"]=C.clk_x,p.extraData[_+".y"]=C.clk_y)));var x=1,S=2,P=t("meta[name=csrf-token]").attr("content"),k=t("meta[name=csrf-param]").attr("content");k&&P&&(p.extraData=p.extraData||{},p.extraData[k]=P),p.forceSync?n():setTimeout(n,10);var D,L,B,T=50,z=t.parseXML||function(t,e){return window.ActiveXObject?(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t)):e=(new DOMParser).parseFromString(t,"text/xml"),e&&e.documentElement&&"parsererror"!=e.documentElement.nodeName?e:null},E=t.parseJSON||function(t){return window.eval("("+t+")")},A=function(e,a,i){var o=e.getResponseHeader("content-type")||"",r="xml"===a||!a&&o.indexOf("xml")>=0,n=r?e.responseXML:e.responseText;return r&&"parsererror"===n.documentElement.nodeName&&t.error&&t.error("parsererror"),i&&i.dataFilter&&(n=i.dataFilter(n,a)),"string"==typeof n&&("json"===a||!a&&o.indexOf("json")>=0?n=E(n):("script"===a||!a&&o.indexOf("javascript")>=0)&&t.globalEval(n)),n};return w}if(!this.length)return i("ajaxSubmit: skipping submit process - no element selected"),this;var l,c,u,d=this;"function"==typeof e?e={success:e}:void 0===e&&(e={}),l=e.type||this.attr2("method"),c=e.url||this.attr2("action"),u="string"==typeof c?t.trim(c):"",u=u||window.location.href||"",u&&(u=(u.match(/^([^#]+)/)||[])[1]),e=t.extend(!0,{url:u,success:t.ajaxSettings.success,type:l||t.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},e);var p={};if(this.trigger("form-pre-serialize",[this,e,p]),p.veto)return i("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(e.beforeSerialize&&e.beforeSerialize(this,e)===!1)return i("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var h=e.traditional;void 0===h&&(h=t.ajaxSettings.traditional);var m,v=[],f=this.formToArray(e.semantic,v);if(e.data&&(e.extraData=e.data,m=t.param(e.data,h)),e.beforeSubmit&&e.beforeSubmit(f,this,e)===!1)return i("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[f,this,e,p]),p.veto)return i("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var g=t.param(f,h);m&&(g=g?g+"&"+m:m),"GET"==e.type.toUpperCase()?(e.url+=(e.url.indexOf("?")>=0?"&":"?")+g,e.data=null):e.data=g;var y=[];if(e.resetForm&&y.push(function(){d.resetForm()}),e.clearForm&&y.push(function(){d.clearForm(e.includeHidden)}),!e.dataType&&e.target){var b=e.success||function(){};y.push(function(a){var i=e.replaceTarget?"replaceWith":"html";t(e.target)[i](a).each(b,arguments)})}else e.success&&y.push(e.success);if(e.success=function(t,a,i){for(var o=e.context||this,r=0,n=y.length;n>r;r++)y[r].apply(o,[t,a,i||d,d])},e.error){var _=e.error;e.error=function(t,a,i){var o=e.context||this;_.apply(o,[t,a,i,d])}}if(e.complete){var $=e.complete;e.complete=function(t,a){var i=e.context||this;$.apply(i,[t,a,d])}}var M=t("input[type=file]:enabled",this).filter(function(){return""!==t(this).val()}),C=M.length>0,w="multipart/form-data",x=d.attr("enctype")==w||d.attr("encoding")==w,S=o.fileapi&&o.formdata;i("fileAPI :"+S);var P,k=(C||x)&&!S;e.iframe!==!1&&(e.iframe||k)?e.closeKeepAlive?t.get(e.closeKeepAlive,function(){P=s(f)}):P=s(f):P=(C||x)&&S?n(f):t.ajax(e),d.removeData("jqxhr").data("jqxhr",P);for(var D=0;D<v.length;D++)v[D]=null;return this.trigger("form-submit-notify",[this,e]),this},t.fn.ajaxForm=function(o){if(o=o||{},o.delegation=o.delegation&&t.isFunction(t.fn.on),!o.delegation&&0===this.length){var r={s:this.selector,c:this.context};return!t.isReady&&r.s?(i("DOM not ready, queuing ajaxForm"),t(function(){t(r.s,r.c).ajaxForm(o)}),this):(i("terminating; zero elements found by selector"+(t.isReady?"":" (DOM not ready)")),this)}return o.delegation?(t(document).off("submit.form-plugin",this.selector,e).off("click.form-plugin",this.selector,a).on("submit.form-plugin",this.selector,o,e).on("click.form-plugin",this.selector,o,a),this):this.ajaxFormUnbind().bind("submit.form-plugin",o,e).bind("click.form-plugin",o,a)},t.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},t.fn.formToArray=function(e,a){var i=[];if(0===this.length)return i;var r,n=this[0],s=this.attr("id"),l=e?n.getElementsByTagName("*"):n.elements;if(l&&!/MSIE [678]/.test(navigator.userAgent)&&(l=t(l).get()),s&&(r=t(':input[form="'+s+'"]').get(),r.length&&(l=(l||[]).concat(r))),!l||!l.length)return i;var c,u,d,p,h,m,v;for(c=0,m=l.length;m>c;c++)if(h=l[c],d=h.name,d&&!h.disabled)if(e&&n.clk&&"image"==h.type)n.clk==h&&(i.push({name:d,value:t(h).val(),type:h.type}),i.push({name:d+".x",value:n.clk_x},{name:d+".y",value:n.clk_y}));
else if(p=t.fieldValue(h,!0),p&&p.constructor==Array)for(a&&a.push(h),u=0,v=p.length;v>u;u++)i.push({name:d,value:p[u]});else if(o.fileapi&&"file"==h.type){a&&a.push(h);var f=h.files;if(f.length)for(u=0;u<f.length;u++)i.push({name:d,value:f[u],type:h.type});else i.push({name:d,value:"",type:h.type})}else null!==p&&"undefined"!=typeof p&&(a&&a.push(h),i.push({name:d,value:p,type:h.type,required:h.required}));if(!e&&n.clk){var g=t(n.clk),y=g[0];d=y.name,d&&!y.disabled&&"image"==y.type&&(i.push({name:d,value:g.val()}),i.push({name:d+".x",value:n.clk_x},{name:d+".y",value:n.clk_y}))}return i},t.fn.formSerialize=function(e){return t.param(this.formToArray(e))},t.fn.fieldSerialize=function(e){var a=[];return this.each(function(){var i=this.name;if(i){var o=t.fieldValue(this,e);if(o&&o.constructor==Array)for(var r=0,n=o.length;n>r;r++)a.push({name:i,value:o[r]});else null!==o&&"undefined"!=typeof o&&a.push({name:this.name,value:o})}}),t.param(a)},t.fn.fieldValue=function(e){for(var a=[],i=0,o=this.length;o>i;i++){var r=this[i],n=t.fieldValue(r,e);null===n||"undefined"==typeof n||n.constructor==Array&&!n.length||(n.constructor==Array?t.merge(a,n):a.push(n))}return a},t.fieldValue=function(e,a){var i=e.name,o=e.type,r=e.tagName.toLowerCase();if(void 0===a&&(a=!0),a&&(!i||e.disabled||"reset"==o||"button"==o||("checkbox"==o||"radio"==o)&&!e.checked||("submit"==o||"image"==o)&&e.form&&e.form.clk!=e||"select"==r&&-1==e.selectedIndex))return null;if("select"==r){var n=e.selectedIndex;if(0>n)return null;for(var s=[],l=e.options,c="select-one"==o,u=c?n+1:l.length,d=c?n:0;u>d;d++){var p=l[d];if(p.selected){var h=p.value;if(h||(h=p.attributes&&p.attributes.value&&!p.attributes.value.specified?p.text:p.value),c)return h;s.push(h)}}return s}return t(e).val()},t.fn.clearForm=function(e){return this.each(function(){t("input,select,textarea",this).clearFields(e)})},t.fn.clearFields=t.fn.clearInputs=function(e){var a=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var i=this.type,o=this.tagName.toLowerCase();a.test(i)||"textarea"==o?this.value="":"checkbox"==i||"radio"==i?this.checked=!1:"select"==o?this.selectedIndex=-1:"file"==i?/MSIE/.test(navigator.userAgent)?t(this).replaceWith(t(this).clone(!0)):t(this).val(""):e&&(e===!0&&/hidden/.test(i)||"string"==typeof e&&t(this).is(e))&&(this.value="")})},t.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},t.fn.enable=function(t){return void 0===t&&(t=!0),this.each(function(){this.disabled=!t})},t.fn.selected=function(e){return void 0===e&&(e=!0),this.each(function(){var a=this.type;if("checkbox"==a||"radio"==a)this.checked=e;else if("option"==this.tagName.toLowerCase()){var i=t(this).parent("select");e&&i[0]&&"select-one"==i[0].type&&i.find("option").selected(!1),this.selected=e}})},t.fn.ajaxSubmit.debug=!1}),$(function(){Map.initMap()});var Map={popup:null,pop_labels:[]},layer_point_label=null,layer_point_cluster=null;Map.initMap=function(){controls_zoombars=[new SuperMap.Control.Navigation({dragPanOptions:{enableKinetic:!0}})],map=new SuperMap.Map("map",{controls:controls_zoombars,allOverlays:!0}),layer_branches=new SuperMap.Layer.Vector("branches"),layer_point_label=new SuperMap.Layer.Vector("pointLabel"),layer_edit_branch=new SuperMap.Layer.Vector("edit_branch"),layer_boundry=new SuperMap.Layer.Vector("boundry",{renderers:["Canvas2"]}),layer_cloudpois=new SuperMap.Layer.Vector("cloud_pois",{renderers:["Canvas2"]}),layer_point_cluster=new SuperMap.Layer.ClusterLayer("pointCluster",{clusterStyles:Dituhui.Point.Cluster.getStyle()}),map.addLayers([layer_boundry,layer_cloudpois]),Region.init(),map.addLayers([layer_edit_branch,layer_point_label,layer_branches]),layer_branches.setVisibility(!1),layer_point_label.setVisibility(!1),control_drawPoint=new SuperMap.Control.DrawFeature(layer_edit_branch,SuperMap.Handler.Point,{multi:!1}),control_drawPoint.events.on({featureadded:Map.drawPointCompleted}),map.addControls([control_drawPoint]);var t=new SuperMap.Control.OverviewMap({id:"overviewMap",maximized:!1}),e=new SuperMap.Layer.CloudLayer({url:urls.map_img});t.layers=[e],map.addControl(t),map.setCenter(new SuperMap.LonLat(12958400.883957,4852082.440605948),11),Dituhui.SMCity.initUserCity(Map.initDatas);Dituhui.Zone.getRegionSelectStyle();control_select=new SuperMap.Control.SelectFeature([layer_branches,layer_cloudpois,layer_region],{onSelect:Map.regionSelect,onUnselect:Map.regionUnSelect,multiple:!1,hover:!1}),map.addControls([control_select]),control_select.activate(),map.events.on({zoomend:Map.zoomEnd}),Map.init(!0),Baidu.init()},Map.ipLocate=function(){Dituhui.showMask(),Dituhui.IPLocate(urls.ip_locate,function(t){Dituhui.hideMask(),Dituhui.SMCity.init(t)},function(){Dituhui.hideMask(),Dituhui.SMCity.init({city:"北京"})})},Map.initDatas=function(){Dituhui.SMCity.cityTagClick=function(t){$(".search-area .select-group").val("-1"),$("#txt_keyword_search_branches").val("");var e=$("#btn_showRegion").prop("checked");t===!1?Map.searchBranches(!1,e?Map.searchRegions:!1):Map.searchBranches(null,e?Map.searchRegions:!1);var a=$(".smcity");poisearch.city=a.attr("admincode"),2==a.attr("level")&&(poisearch.city=a.attr("admincode").substr(0,4)+"00"),poisearch.changeCity()},Map.getColumns(!0),Dituhui.Point.getImportBranches(),poisearch=new POISearch({id:"txt_keyword_cloud",city:$(".smcity").attr("admincode"),map:map,layer:layer_cloudpois,savePOI:!0})},Map.showBranchLayer=function(){var t=$(this),e=t.prop("checked");e&&0===layer_branches.features.length?Map.searchBranches():(Map.isDragging||map.removeAllPopup(),e||1!=$("#show-point-label").prop("checked")||($("#show-point-label").prop("checked",!1),layer_point_label.setVisibility(!1))),layer_branches.setVisibility(e)},Map.searchBranches=function(t,e){layer_branches.removeAllFeatures(),layer_point_cluster.destroyCluster(),layer_edit_branch.removeAllFeatures(),layer_point_label.removeAllFeatures(),Map.endDragBranch(),Dituhui.Point.Table.clear(),map.removeAllPopup();var a=$(".data-list .search-input").val(),i=$(".data-list .select-group").val(),o=$("#btn_showCluster").prop("checked");(t===!1||a.length>0||"-1"!=i)&&(o=!1);var r={pageNo:-1};a.length>0&&(r.name=a),-1!=i&&(r.groupid=i),r.isForceConverge=o,Dituhui.Point.SearchByCluster(r,function(t){1==t.result.isConverge?Dituhui.Point.National.display(t.result):Map.showBranchesToMap(t.result.records),"function"==typeof e&&e()},function(){"function"==typeof e&&e()})},Map.searchBranchesUnclear=function(){var t=$(".data-list .search-input").val(),e={pageNo:-1};t.length>0&&(e.name=t),Dituhui.Point.Search(e,function(t){var e=$(".smcity").attr("level");"0"!=e?Map.showBranchesToMap(t):Dituhui.Point.National.display(t)},function(){})},Map.showBranchesClusterByCounty=function(t){var e=$(".smcity"),a=e.attr("smx"),i=e.attr("smy"),o={level:3,records:[{count:t+"",county:e.attr("adminname"),province:null,admincode:e.attr("admincode"),city:null,y:i,x:a,countyCluster:!0}]};Dituhui.Point.National.display(o)},Map.showBranchesToMap=function(t){layer_branches.removeAllFeatures(),layer_point_label.removeAllFeatures();var e=t?t.length:0;if(0===e)return void Dituhui.showPopover("当前查询到0条网点数据");for(var a=[],i=[],o=[],r=[],n=Dituhui.User.dcode,s=0;e>s;s++){var l=t[s];if(0==l.status){if(a.push(l),l.iconStyle||(l.iconStyle=urls.server+"/resources/assets/map/red/s.png"),Baidu.using){var c=Baidu.getCoord(l.smx,l.smy);l.smx=c.x,l.smy=c.y}l.belongToOthers=!1,l.dcode=l.dcode?l.dcode:n.substr(0,8),l.dcode.substr(0,n.length)!==n&&(l.belongToOthers=!0);var u=Dituhui.Point.getBranchStyle(l),d=new SuperMap.Geometry.Point(l.smx,l.smy),p=new SuperMap.Feature.Vector(d);p.style=u,p.attributes=l,p.attributes.type="point",o.push(p);var h=new SuperMap.Geometry.Point(l.smx,l.smy),m=u.graphicHeight?Number(u.graphicHeight):0,v=m;m=.5*m+32,v=m-15;var f=Dituhui.Point.Style.getLabelStyle(l.name,-m,v),g=new SuperMap.Feature.Vector(h,{type:"text-point"},f);r.push(g)}else i.push(l)}layer_branches.addFeatures(o),layer_point_label.addFeatures(r),Dituhui.Point.Table.data_success=a.concat(),Dituhui.Point.Table.data_failed=i.concat(),$(".a-data-success > span").html("("+a.length+")"),$(".a-data-failed > span").html("("+i.length+")"),Dituhui.Point.Table.refresh(a)},Map.showBranchesClusterToMap=function(t){layer_point_cluster.destroyCluster();var e=t?t.length:0;if(0===e)return void Dituhui.showPopover("当前查询到0条网点数据");for(var a=[],i=[],o=[],r=[],n=Dituhui.Users.dcode,s=0;e>s;s++){var l=t[s];if(0==l.status){if(a.push(l),l.iconStyle||(l.iconStyle=urls.server+"/resources/assets/map/red/s.png"),Baidu.using){var c=Baidu.getCoord(l.smx,l.smy);l.smx=c.x,l.smy=c.y}l.belongToOthers=!1,l.dcode=l.dcode?l.dcode:n.substr(0,8),l.dcode.substr(0,n.length)!==n&&(l.belongToOthers=!0);var u=Dituhui.Point.getBranchStyle(l),d=new SuperMap.Geometry.Point(l.smx,l.smy),p=new SuperMap.Feature.Vector(d);p.style=u,p.attributes=l,p.attributes.type="point",o.push(p);var h=new SuperMap.Geometry.Point(l.smx,l.smy),m=u.graphicHeight?Number(u.graphicHeight):0,v=m;m=.5*m+32,v=m-15;var f=Dituhui.Point.Style.getLabelStyle(l.name,-m,v),g=new SuperMap.Feature.Vector(h,{type:"text-point"},f);r.push(g)}else i.push(l)}layer_point_cluster.addFeatures(o),layer_point_label.addFeatures(r),Dituhui.Point.Table.data_success=a.concat(),Dituhui.Point.Table.data_failed=i.concat(),$(".a-data-success > span").html("("+a.length+")"),$(".a-data-failed > span").html("("+i.length+")")},Map.showSuccessData=function(){Map.showDatas(Dituhui.Point.Table.data_success)},Map.showFailedData=function(){Map.showDatas(Dituhui.Point.Table.data_failed)},Map.showDatas=function(t){map.removeAllPopup(),layer_branches.removeAllFeatures(),layer_point_label.removeAllFeatures(),Map.endDragBranch();var e=t.length;if(0===e)return $(".data-list table tbody").html(""),void $(".data-list .totality").html("(0条)");for(var a=[],i=[],o=Dituhui.User.dcode,r=0;e>r;r++){{var n=t[r];new SuperMap.LonLat(n.smx,n.smy)}n.iconStyle||(n.iconStyle=urls.server+"/resources/assets/map/red/s.png");{var s=Dituhui.Point.getBranchStyle(n.iconStyle);new SuperMap.Size(s.width,s.height)}if(Baidu.using){var l=Baidu.getCoord(n.smx,n.smy);n.smx=l.x,n.smy=l.y}var c=new SuperMap.Geometry.Point(n.smx,n.smy);if(Baidu.using){var l=Baidu.getCoord(n.smx,n.smy);c=new SuperMap.Geometry.Point(l.x,l.y)}n.belongToOthers=!1,n.dcode=n.dcode?n.dcode:o.substr(0,8),n.dcode.substr(0,o.length)!==o&&(n.belongToOthers=!0);var u=new SuperMap.Feature.Vector(c);u.style=Dituhui.Point.getBranchStyle(n),u.attributes=n,u.attributes.type="point",a.push(u);var d=new SuperMap.Geometry.Point(n.smx,n.smy),p=s.graphicHeight?Number(s.graphicHeight):0,h=p;s.externalGraphic.match("/pointService/getImg")?h=p-15:p=Number(p)+15;var m=Dituhui.Point.Style.getLabelStyle(n.name,-p,h),v=new SuperMap.Feature.Vector(d,{type:"text-point"},m);i.push(v)}layer_branches.addFeatures(a),layer_point_label.addFeatures(i),Dituhui.Point.Table.refresh(t)},Map.selectBranch=function(t){var e=t.attributes;e.lonlat=new SuperMap.LonLat(e.smx,e.smy),Map.openBranchAttrPopup(e)},Map.openBranchAttrPopup=function(t){var e=(t.netPicPath?urls.server+"/pointService/getImg?path="+t.netPicPath:"assets/map/branch.png",'<div class="map-popup">');e+=Dituhui.Point.getAttrPopupHtml(t,t.belongToOthers?!1:!0),e+="</div>";t.lonlat;Map.popup=new SuperMap.Popup.FramedCloud("popup-near",t.lonlat,new SuperMap.Size(300,70),e,null,!1,null),Map.popup.autoSize=!0,Map.popup.panMapIfOutOfView=!0,Map.popup.relativePosition="tr",map.removeAllPopup(),map.addPopup(Map.popup),Dituhui.Point.getBindingCars(t.id,function(t){$(".bind-cars").html(t)},function(){}),$("#txt_upload_point_picture_pointid").val(t.id),Map.Pictures.search(t.belongToOthers?!1:!0),$(".popup-close").unbind("click").click(function(){Map.popup.hide(),layer_branches.visibility===!1&&layer_edit_branch.removeAllFeatures()}),$(".popup-edit").unbind("click").click(function(){Map.showEditBranch(t)}),$(".popup-delete").unbind("click").click(function(){Dituhui.Modal.alert("是否删除网点 <strong>"+t.name+"</strong> ? 删除后不可恢复。",Map.deleteBranch,{"data-id":t.id,"data-name":t.name})}),$(".data-list table tbody tr").removeClass("action");var a=$('.data-list table tbody tr[data-id="'+t.id+'"]').addClass("action"),i=$(".data-list .data-results .overflow-y-auto"),o=a[0].offsetTop,r=i[0].scrollTop;(Math.abs(o-r)>i.height()||r>o)&&i.animate({scrollTop:o},100)},Map.getMarkerById=function(t){var e=layer_branches.features,a=e.length;if(1>a)return null;for(var i=a;i--;){var o=e[i];if(o.attributes.id===t)return o}return null},Map.showEditBranch=function(t){layer_edit_branch.removeAllFeatures();var e=t.lonlat,a=new SuperMap.Geometry.Point(e.lon,e.lat),i=new SuperMap.Feature.Vector(a);i.style={externalGraphic:urls.server+"/resources/assets/map/editBranch.png",graphicWidth:20,graphicHeight:30,graphicTitle:"修改网点",cursor:"pointer"},i.attributes={x:a.x,y:a.y,type:"point-edit"},layer_edit_branch.addFeatures(i),Map.enableEdit();var e=new SuperMap.LonLat(a.x,a.y);Map.openEditBranchPopup(t)};var marker_editing=null;Map.needCaculateCoord=!1,Map.openEditBranchPopup=function(t){marker_editing=t;var e=t,a='<div class="map-popup">';a+='<div class="map-popup-content">';var i=t.failed?!0:!1;a+=Dituhui.Point.getEditPopupHeaderHtml(e.name?e.name:"",i);var o=selectedFeature&&selectedFeature.attributes.areaName?selectedFeature.attributes.areaName:"",r=selectedFeature&&selectedFeature.attributes.areaId?selectedFeature.attributes.areaId:"";a+=Dituhui.Point.getAddPopupFormHtml(2,t,o,r),a+="</div>",a+="</div>",Map.popup=new SuperMap.Popup.FramedCloud("popup-near",t.lonlat,new SuperMap.Size(300,70),a,null,!1,null),Map.popup.autoSize=!0,Map.popup.panMapIfOutOfView=!0,Map.popup.relativePosition="tr",map.removeAllPopup(),map.addPopup(Map.popup),Dituhui.Point.getBindingCars(t.id,function(t,e,a){$("#txt_car_license").val(t),$("#txt_car_ids").val(e),Cars.selected_cars=a},function(){$("#txt_car_license").val(""),$("#txt_car_ids").val(""),Cars.selected_cars=[]}),Dituhui.Point.setPopupDivStyle(),$(".close-popup").unbind("click").click(function(){Dituhui.Modal.ask("确定不保存吗？",Map.cancelAddBranch)}),$(".popup-sure").unbind("click").click(Map.updateBranch),$(".popup-delete").unbind("click").click(function(){Dituhui.Modal.alert("是否删除网点 <strong>"+t.name+"</strong> ? 删除后不可恢复。",Map.deleteBranch,{"data-id":t.id,"data-name":t.name})}),Map.initSelectGroupInPopup(t),$(".photo").click(function(){$(".upload-pictures").removeClass("hide")}),$(".popup-setting").unbind("click").click(function(){$(".setting-fields").removeClass("hide")});var n=$(".ul-point-pictures li.normal").length;if(0==n)$(".preview-img").hide();else{var s=$(".ul-point-pictures li.normal:first-child img").attr("src"),l='<img src="'+s+'">';l+='<div class="count"><span>'+n+"张</span></div>",$(".preview-img").html(l).unbind("click").click(function(){Map.Pictures.viewPictures(),$(".view-pictures").removeClass("hide")})}$(".branch-icon-popup").click(Page.initPoiUpdateStyle),$(".close-icons").unbind("click").click(function(){$(".map-popup-content").show(),$(".map-popup-icons").hide()}),$(".map-popup-icons > ul > li > img").unbind("click").click(function(){$('input[name="iconStyle"]').val($(this).attr("data-src")),$(".map-popup-content").show(),$(".map-popup-icons").hide()}),$(".choose-cars").unbind("click").click(function(){Cars.init()}),Map.needCaculateCoord=!1,$(".smx-popup").change(function(){Map.needCaculateCoord=!0}),$(".smy-popup").change(function(){Map.needCaculateCoord=!0}),$("#txt_name").focus().val($("#txt_name").val())},Map.initSelectGroupInPopup=function(t){t&&t.groupid&&(t.groupid.styleid?(t.styleid=t.groupid.styleid,t.styleid.groupid=t.groupid.id):(t.styleid={},t.styleid.groupid=t.groupid.id));for(var e=Dituhui.Point.Group.data.concat(),a='<option value="0">无</option>',i=e.length;i--;){var o=e[i];a+=t.styleid.groupid==o.id?'<option value="'+o.id+'" selected="true">'+Dituhui.setStringEsc(o.groupname)+"</option>":'<option value="'+o.id+'">'+Dituhui.setStringEsc(o.groupname)+"</option>"}$(".select-group-popup").html(a).change(function(){var t=$(this);$('input[name="groupid"]').val(t.val());var e=$("#txt_branchGroup");e.val(t.val());var a=$("#txt_branchGroup option:selected").text();return $("#txt_styleName").val(a),$(".icon-demo + .bottom").html(a),"none"==t.val()||"0"==t.val()?($('input[name="styleid"], input[name="stylename"], input[name="groupid"]').val(""),void Map.Group.switchStyle(Dituhui.Point.Style.defaultStyle,!0)):void(e.hasClass("icon-style-input")&&(Map.Group.getStyle(t.val()),$('input[name="groupid"]').val(t.val())))})},Map.updateBranch=function(){var t=$("#txt_name").val();if(t.length<1)return void Dituhui.showHint("请输入网点名称");var e=$("#txt_address").val();if(e.length<1)return void Dituhui.showHint("请输入网点地址");var a=checkFileSize();if(0==a)return void $(".hint").html("图片大于100K，请重新选择");if(Map.needCaculateCoord){var i=Number($(".smx-popup").val()),o=Number($(".smy-popup").val());if(isNaN(i)||i>180||-180>i||0==i)return void Dituhui.showHint("请正确输入经度");if(isNaN(o)||o>90||-90>o||0==o)return void Dituhui.showHint("请正确输入纬度");var r=Dituhui.latLonToMeters(new SuperMap.LonLat(Number(i),Number(o)));$('input[name="smx"]').val(r.lon),$('input[name="smy"]').val(r.lat)}var t="",n=$('input[name="groupid"]').val();if($(".icon-edit-container").is(":visible")&&$(".icon-save-container").is(":hidden")){t=$("#txt_styleName").val();var s=$(".icon-demo");if(!s.attr("data-use-custom-ico")){var l={appearance:s.attr("data-back"),apppic:s.attr("data-ico")};if(!("transparent"!=l.appearance&&""!=l.appearance||""!=l.apppic&&"none"!=l.apppic))return void Dituhui.showHint("外观和图案不允许都为无")}if(""==n||"none"==n)$('input[name="stylename"]').val(t),Map.updateBranchServer();else{if(""==t)return void Dituhui.showHint("请输入样式名称");$('input[name="stylename"]').val(t),Dituhui.Modal.alert("将更新所属分组为“"+$("#txt_branchGroup option:selected").text()+"”的图标样式，确定继续？",Map.updateBranchServer)}}else Map.updateBranchServer()},Map.updateBranchServer=function(){$("#form_add_branch").ajaxSubmit(function(t){t=urls.ie_case?$.parseJSON($(t).text()):JSON.parse(t),t.isSuccess?(Dituhui.showPopover("修改成功"),map.removeAllPopup(),Map.endDragBranch(),Map.searchBranches(),"min"!=$(".data-list").attr("status")&&$(".icon-edit-container").is(":visible")&&$(".icon-save-container").is(":hidden")&&($(".icon-save-container, .tab-icon-list").show(),$(".tab-edit").removeClass("hide"),$(".data-list .head .tab-text").click())):Dituhui.showPopover(t.info),Map.Style.search()}),Dituhui.Modal.hide()},Map.deleteBranch=function(){var t=$(this),e=t.attr("data-id");Dituhui.Point.remove(e,function(){Dituhui.showPopover('网点"'+t.attr("data-name")+'"删除成功'),$(".data-modal").addClass("hide"),map.removeAllPopup(),Map.searchBranches()},function(){Dituhui.showPopover('网点"'+t.attr("data-name")+'"删除失败')})},Map.regionSelect=function(t){var e=t.attributes.type;switch(e){case"point":layer_branches.visibility&&(layer_edit_branch.removeAllFeatures(),Map.endDragBranch()),Map.selectBranch(t);break;case"region":Region.select(t);break;case"point-cloud":poisearch.openPopup(t.attributes);break;case"point-national":var a=t.attributes,i=a.adminname,o=a.admincode,r=a.level;if($(".current-city").attr({smx:a.x,smy:a.y}),1==r){var n=Dituhui.SMCity.isZhixia(o.substring(0,2)+"0000");n?Dituhui.SMCity.showCurrentCounty(i,o,""):Dituhui.SMCity.showCurrentCity(i,o)}else 2==r?Dituhui.SMCity.showCurrentCounty(i,o,""):Dituhui.SMCity.showCurrentProvince(i,o);Dituhui.SMCity.cityTagClick();break;case"point-county":Map.searchBranches(!1)}},Map.regionUnSelect=function(t){var e=t.attributes.type;"region"===e&&Region.unselect(t)},Map.clear=function(){$("#btn_showBranch, #btn_showRegion, #show-point-label").prop("checked",!1),$("#btn_showRegion").removeAttr("isShowRegion"),layer_region.removeAllFeatures(),layer_region.setVisibility(!1),layer_region_label.removeAllFeatures(),layer_region_label.setVisibility(!1),layer_branches.removeAllFeatures(),layer_branches.setVisibility(!1),layer_point_label.removeAllFeatures(),layer_point_label.setVisibility(!1),layer_edit_branch.removeAllFeatures(),layer_cloudpois.removeAllFeatures(),$(".header .search-from-cloud .child").addClass("hide"),control_drawPoint.deactivate(),map.removeAllPopup(),Map.popup=null,Map.endDragBranch(),Dituhui.Point.Table.clear(),$(".search-area .select-group").val("-1")},Map.pan=function(){control_drawPoint.deactivate()},Map.drawPoint=function(){var t=$("#btn_showBranch");t.prop("checked")||(t.prop("checked",!0),layer_branches.setVisibility(!0),0===layer_branches.features.length&&Map.searchBranches()),control_drawPoint.activate()},Map.drawPointCompleted=function(t){control_drawPoint.deactivate(),layer_edit_branch.removeAllFeatures();var e=t.feature.geometry,a=new SuperMap.Geometry.Point(e.x,e.y),i=new SuperMap.Feature.Vector(a);i.id="add_branch";var o={name:"新增网点"};i.style=Dituhui.Point.getBranchStyle(o),i.attributes={x:e.x,y:e.y,type:1},layer_edit_branch.addFeatures(i),Map.enableEdit();var r=new SuperMap.LonLat(e.x,e.y);Map.openAddBranchPopup(r),Map.regeocode(r)},Map.openAddBranchPopup=function(t,e,a){var i='<div class="map-popup">';i+='<div class="map-popup-content">',i+=e&&3===e?Dituhui.Point.getEditPopupHeaderHtml(a.name,!1,!0):Dituhui.Point.getAddPopupHeaderHtml();var o=t;if(Baidu&&Baidu.using){var r=t,n=Baidu.restoreCoord(r.lon,r.lat);o=new SuperMap.LonLat(n.x,n.y)}var s=selectedFeature&&selectedFeature.attributes.name?selectedFeature.attributes.name:"",l=selectedFeature&&selectedFeature.attributes.id?selectedFeature.attributes.id:"",c=e?e:1;i+=Dituhui.Point.getAddPopupFormHtml(c,o,s,l,a),i+="</div>",i+=Dituhui.Point.getIconsListHtml(),i+="</div>",Map.popup=new SuperMap.Popup.FramedCloud("popup-near",t,new SuperMap.Size(300,70),i,null,!1,null,!0),Map.popup.autoSize=!0,Map.popup.panMapIfOutOfView=!0,Map.popup.relativePosition="tr",map.removeAllPopup(),map.addPopup(Map.popup),Dituhui.Point.setPopupDivStyle(),$(".close-popup").unbind("click").click(function(){Dituhui.Modal.ask("确定不保存吗？",Map.cancelAddBranch)}),$(".popup-sure").unbind("click").click(Map.addBranch),$(".photo").click(function(){$(".upload-pictures").removeClass("hide")}),$(".branch-icon-popup").click(Page.initPoiUpdateStyle),$(".close-icons").unbind("click").click(function(){$(".map-popup-content").show(),$(".map-popup-icons").hide()}),$(".map-popup-icons > ul > li > img").unbind("click").click(function(){$('input[name="iconStyle"]').val($(this).attr("data-src")),$(".map-popup-content").show(),$(".map-popup-icons").hide()}),$(".choose-cars").unbind("click").click(function(){Cars.init()}),0==$(".ul-point-pictures li.normal").length&&$(".preview-img").hide(),$("#txt_name").focus()},Map.cancelAddBranch=function(){map.removeAllPopup(),layer_edit_branch.removeAllFeatures(),Map.endDragBranch(),$(".data-modal").addClass("hide"),"min"!=$(".data-list").attr("status")&&$(".icon-edit-container").is(":visible")&&$(".icon-save-container").is(":hidden")&&($(".icon-save-container, .tab-icon-list").show(),$(".tab-edit").hide(),$(".data-list .head .tab-text").click())},Map.addBranch=function(){var t=$("#txt_name").val();if(t.length<1)return void Dituhui.showHint("请输入网点名称");var e=$("#txt_address").val();if(e.length<1)return void Dituhui.showHint("请输入网点地址");var a=checkFileSize();if(0==a)return void $(".hint").html("图片大于100K，请重新选择");var t="",i=$('input[name="groupid"]').val();if($(".icon-edit-container").is(":visible")&&$(".icon-save-container").is(":hidden")){t=$("#txt_styleName").val();var o=$(".icon-demo");if(!o.attr("data-use-custom-ico")){var r={appearance:o.attr("data-back"),apppic:o.attr("data-ico")};if(!("transparent"!=r.appearance&&""!=r.appearance||""!=r.apppic&&"none"!=r.apppic))return void Dituhui.showHint("外观和图案不允许都为无")}if(""==i||"none"==i)$('input[name="stylename"]').val(t),Map.addBranchServer();else{if(""==t)return void Dituhui.showHint("请输入样式名称");$('input[name="stylename"]').val(t),Dituhui.Modal.alert("将更新所属分组为“"+$("#txt_branchGroup option:selected").text()+"”的图标样式，确定继续？",Map.addBranchServer)}}else Map.addBranchServer()},Map.addBranchServer=function(){$("#form_add_branch").ajaxSubmit(function(t){t=urls.ie_case?$.parseJSON($(t).text()):JSON.parse(t),t.isSuccess?(Dituhui.showPopover("添加成功"),map.removeAllPopup(),Map.endDragBranch(),Map.searchBranches(),"min"!=$(".data-list").attr("status")&&$(".icon-edit-container").is(":visible")&&$(".icon-save-container").is(":hidden")&&($(".icon-save-container, .tab-icon-list").show(),$(".tab-edit").hide(),$(".data-list .head .tab-text").click())):Dituhui.showPopover(t.info),Map.Style.search()}),Dituhui.Modal.hide()},Map.regeocode=function(t,e){var a=$("#txt_address"),i=a.val();if(a.attr("disabled","disabled").val("正在进行反向地址匹配..."),Baidu&&Baidu.using){var o=Baidu.restoreCoord(t.lon,t.lat);t=new SuperMap.LonLat(o.x,o.y)}var r={smx:t.lon,smy:t.lat};Dituhui.Point.regeocode(r,function(t){t.address||(t.address=i),"undefined"!=typeof e&&""!=i&&(t.address=i),a.val(t.address).removeAttr("disabled");var o=$(".smcity").attr("level");"0"==o&&t.admincode&&t.admincode.length>0&&(t.county&&0!=t.county.length?(Dituhui.SMCity.showCurrentCounty(t.county,t.admincode,t.city),Map.searchBranchesUnclear()):t.city&&0!=t.city.length?(Dituhui.SMCity.showCurrentCity(t.city,t.admincode),Map.searchBranchesUnclear()):t.province&&0!=t.province.length&&(Dituhui.SMCity.showCurrentProvince(t.province,t.admincode),Map.searchBranchesUnclear()))},function(){a.val(i).removeAttr("disabled")})},Map.checkImportFileSize=function(){var t=document.getElementById("txt_import_branches"),e=$(".data-import .body .import-hint.black");if(urls.ie_case){if(""==t.value)return Dituhui.showHint("请选择文件"),e.html(""),!1;var a=t.value,i=a.split("\\");return a=i[i.length-1],e.html(a),!0}var o=t.files,e=$(".data-import .body .import-hint.black");if(!o||o.length<1)return Dituhui.showHint("请选择文件"),e.html(""),!1;var r=o[0];return r.size>2048e3?(e.html("文件大于2M，请重新选择"),!1):(e.html(r.name+"("+r.size+"b)"),!0)},Map.setWindowClose=function(){window.onbeforeunload=function(){return"您还有数据未导入完，是否确定离开？"}},Map.resetWindowClose=function(){window.onbeforeunload=function(){}},Map.importBranches=function(){var t=Map.checkImportFileSize();if(t){Dituhui.Modal.loading("正在导入网点，请稍候..."),$("a.btn-select-file").removeClass("btn-select-file").addClass("btn-during-import");var e=!1;$("#form_import_branches").ajaxSubmit({timeout:9e4,error:function(){e=!0,Map.resetWindowClose(),Dituhui.Modal.hide(),Dituhui.showHint("导入失败"),$("a.btn-during-import").removeClass("btn-during-import").addClass("btn-select-file")},success:function(t){e=!0,$("a.btn-during-import").removeClass("btn-during-import").addClass("btn-select-file"),t=urls.ie_case?$.parseJSON($(t).text()):JSON.parse(t),t.isSuccess?($(".data-import").fadeOut("fast"),Dituhui.Modal.loading(t.info?t.info+"</br>正在解析数据...<br>":"正在解析数据...<br>"),Map.analysisPoints(t.info)):(Map.resetWindowClose(),Dituhui.Modal.loaded_wrong("数据导入失败<br>"+t.info,Map.afterImportWrong))}}),setTimeout(function(){0==e&&Map.setWindowClose()},200)}},Map.analysisPoints=function(t){Dituhui.Point.analysisPoints(!0,function(){Map.resetWindowClose(),Dituhui.Modal.loaded_right("数据已导入完成。<br>"+t,Map.afterImportRight)},function(e){Map.resetWindowClose(),e||(e=t),Dituhui.Modal.loaded_wrong("数据导入失败<br>"+e,Map.afterImportWrong)})},Map.afterImportRight=function(){map.removeAllPopup(),Map.endDragBranch(),layer_edit_branch.removeAllFeatures(),Map.getColumns(!1),Map.Group.search(),$('a[option="showWholeCountry"]').click(),Dituhui.Modal.hide();var t=$("#btn_showBranch");0==t.prop("checked")&&t.click()},Map.afterImportWrong=function(){Dituhui.Modal.hide()},Map.getColumns=function(t){Dituhui.Point.createSysThead(),Dituhui.Point.getCustomColumns(t)},Map.updateCell=function(){Dituhui.Point.Table.updateCell()},Map.updateCellGroup=function(){Dituhui.Point.Table.updateCellGroup()},Map.addColumn=function(){Dituhui.Point.Table.addColumn()},Map.removeColumn=function(){Dituhui.Point.Table.removeColumn()},Map.renameColumn=function(){Dituhui.Point.Table.renameColumn()},Map.zoomEnd=function(t){var e=t.object.zoom,a=$("#btn_showRegion"),i=a.attr("isShowRegion")?!0:!1,o=4;Baidu.using&&(o=2),e>o?(a.prop("checked",i),layer_region.setVisibility(i),layer_region_label.setVisibility(i),layer_boundry.setVisibility(!0)):(a.prop("checked",!1),layer_region.setVisibility(!1),layer_region_label.setVisibility(!1),layer_boundry.setVisibility(!1))},Map.showPointLabels=function(){var t=$("#show-point-label").prop("checked");return layer_point_label.setVisibility(t),void(1==t&&0==$("#btn_showBranch").prop("checked")&&($("#btn_showBranch").prop("checked",!0),layer_branches.setVisibility(t)))},Map.checkAction=function(){return!0};var poisearch;$(function(){var t=urls.getUrlArgs();Dituhui.User.currentModuleId=t.moduleid?t.moduleid:"",t&&"false"==t.isLogined&&$(".data-guide").show();getWindowWidth(),getWindowHeight();if($('li[option="show-children"]').hover(function(){$(this).find(" > div").show()},function(){$(this).find(" > div").hide()}),$(".close, .btn-cancel, .close-modal").click(function(){var t=$(this);t.hasClass("close-fade-out")?$(t.attr("data-target")).fadeOut("fast"):$(t.attr("data-target")).addClass("hide"),".data-update-style"==t.attr("data-target")&&$('button[option="update-style"]').unbind("click").click(Map.Style.edit)}),$("#btn_showBranch").change(Map.showBranchLayer),$("#btn_showRegion").change(Region.show),$("#btn_showCluster").change(Map.searchBranches),$("#show-point-label").change(Map.showPointLabels),$("a.clear-map").click(Map.clear),$("a.pan-map").click(Map.pan),$("a.add-point").click(Map.drawPoint),"8a04a77b56a21dcc01570cbaf9450a15"==userid&&($("a.add-mobile-point").on("click",Map.showMobilePointWindow).parent().removeClass("hide"),$("a.btn-search-mpoint").on("click",Map.searchMobilePoint),$(".hint-mobile-point").hover(function(){$(".hint-part").removeClass("hide")},function(){$(".hint-part").addClass("hide")})),$('button[option="delete-branch"]').click(Map.deleteBranch),$("a.to-supermap").click(Map.toSuperMap),$("a.to-google").click(Map.toGoogleMap),$("a.to-tianditu").click(Map.toTiandituMap),$(".data-list .head .first").click(Page.cssTableFirst),$(".data-list .head .second").click(Page.cssTableSecond),$(".data-list .head .third").click(Page.cssTableThird),$(".data-list .head .title").click(Page.cssTableTitleClick),$(".data-list .head .import").click(function(){$(".data-import").fadeIn("fast")}),$("a.btn-select-file").click(function(){$(this).find("+ input").click()}),$("#form_import_branches").attr("action",urls.server+"/pointService/import?&muduleId="+Dituhui.User.currentModuleId),$("#btn_import_branches").click(Map.importBranches),$('a[option="update-cell"]').click(Map.updateCell),$('a[option="update-cell-group"]').click(Map.updateCellGroup),$(".text-cell-edit").keyup(function(t){13===t.keyCode&&Map.updateCell()}),$('a[option="add-column-server"]').click(Map.addColumn),$('a[option="rename-column-server"]').click(Map.renameColumn),$(".text-column-add").keyup(function(t){13===t.keyCode&&Map.addColumn()}),$(".a-data-success").click(Map.showSuccessData),$(".a-data-failed").click(Map.showFailedData),$(".data-list .search-input").keyup(function(t){13===t.keyCode&&Map.searchBranches()}),$(".data-list .select-group").change(function(){Map.searchBranches()}),$(".data-list .btn-search").click(Map.searchBranches),"Microsoft Internet Explorer"==navigator.appName){var e=navigator.appVersion.split(";");e=parseInt(e[1].replace(/[ ]/g,"").replace(/MSIE/g,"")),10>e&&($(".btn-select-file").hide(),$("#txt_import_branches").css("display","block"),urls.ie_case=!0)}$(".btn-search-cars").click(function(){$("#pager_cars").attr("page","0"),Cars.search()}),$("#btn_bind_cars").click(Cars.sure),$("#btn_select_all_cars").click(Cars.selectAllCar),$(".select-all-car").change(Cars.selectAll),$(".data-guide .next").click(function(){var t=$(this);$(t.attr("data-pre")).hide(),$(t.attr("data-next")).show()}),$(".data-guide .start").click(function(){$(".data-guide").hide()}),$(".data-list .head .tab-icon-style").click(function(){$('.data-list .content[data-display="table"]').hide(),$('.data-list .content[data-display="icon"]').show()
}),$(".data-list .head .tab-text").click(function(){$('.data-list .content[data-display="icon"]').hide(),$('.data-list .content[data-display="table"]').show()}),$('li[data-option="show-icon-box"]').click(Page.changeIconBox),Page.slider=$("#slider_size").slider({min:8,max:48,step:1}),Page.slider.on("slideStop",Page.changeIconSize),$(".icon-selector .color li").click(Page.changeIconColor),$(".icon-selector .back li").click(Page.changeIconBack),$('button[data-option="hide-tab-edit"]').click(Page.hideIconEdit),$('button[data-option="save-icon-style"]').click(Map.Style.editHandler),$('button[option="update-style"]').click(Map.Style.edit),$("select.branch-group").change(Page.changeGroupSelect),$(".text-branchgroup-add").keyup(function(t){13===t.keyCode&&Map.Group.add()}),$('a[option="add-branchgroup-server"]').click(Map.Group.add),$('a[option="remove-branchgroup-server"]').click(Map.Group.removeHandler),$("#form_upload_custom_icon").attr("action",urls.server+"/pointService/saveCustomFile"),$("input.icon-size").bind("change",Page.inputIconSize),$("#form_upload_point_picture").attr("action",urls.server+"/pointService/savePointPicture"),$(".add-point-pictures").click(function(){$("#txt_upload_point_picture").click()}),$(".data-results.head-fixed").scroll(function(t){var e=$(this);e.find(".overflow-y-auto").width(e.width()+t.target.scrollLeft).css({"max-width":t.target.scrollWidth+"px"})}),$(".setting-fields .setting-sure").click(Dituhui.Point.setFields),$(".setting-fields .setting-cancel").click(Dituhui.Point.cancelSetFields),Page.initcss(),$(window).resize(Page.initcss);var a=!1;$(".header-share").on("click",function(){$(".bk-share").removeClass("hide"),a||$("#share_current_url").zclip({path:urls.server+"/resources/js/public/zclip/ZeroClipboard.swf",copy:function(){return $("#currentPage_shareLink").val()},afterCopy:function(){$(".copy-success").removeClass("hide"),setTimeout(function(){$(".copy-success").addClass("hide")},2500)}}),a=!0}),$(".closeBtn.close-share").on("click",function(){$(this).parent().addClass("hide")});var i=location.protocol+"//"+location.host+urls.server+"/resources/mobile/point/index.html?key="+userid;$("#currentPage_shareLink").val(i),$("#share_currentPage_code").qrcode({width:120,height:120,text:i}),Page.initPoiIcos(),Map.Style.search(),Map.Group.search(),Map.CustomIcon.search(),Dituhui.Point.Table.bindTdClick()});var Page={initcss:function(){setTimeout(function(){map.updateSize()},100)},renameColumn:function(){var t,e=$(this),a=e.parents("td"),i=a.offset().left,o=a.offset().top,r=$(".container-point").width(),n=getWindowHeight()-58;t=n-o-a.height()>120?o+a.height()+20:o-120;var s=i;250>r-i&&(s=r-250),$(".text-column-rename").val(e.attr("data-value")).attr({"data-key":e.attr("data-key"),"data-value":e.attr("data-value")}),$(".data-column-rename .box").css({left:s+"px",top:t+"px"}),$(".data-column-rename").fadeIn("fast")}};Page.slider=null,Page.cssTableFirst=function(){var t=($(".container-point").width(),getWindowHeight()-58,$(this)),e=$(".data-list"),a=($(".data-list .data-results"),e.attr("status"));switch(a){case"min":e.attr("status","left-max"),t.removeClass("up").addClass("bottom").attr("title","向下缩放");break;case"left-max":e.attr("status","min"),t.removeClass("bottom").addClass("up").attr("title","向上展开");break;case"bottom-max":e.attr("status","min"),t.removeClass("bottom").addClass("up").attr("title","向上展开"),e.find(".second").removeClass("up").addClass("right").attr("title","向右展开");break;case"max":e.attr("status","left-max"),t.removeClass("left").addClass("bottom").attr("title","向下缩放"),e.find(".second").removeClass("bottom").addClass("right").attr("title","向右展开")}},Page.cssTableSecond=function(){var t=($(".container-point").width(),getWindowHeight()-58,$(this)),e=$(".data-list"),a=($(".data-list .data-results"),e.attr("status"));switch(a){case"min":e.attr("status","bottom-max"),t.removeClass("right").addClass("up").attr("title","向上展开"),e.find(".first").removeClass("up").addClass("bottom").attr("title","向下缩放");break;case"bottom-max":e.attr("status","max"),t.removeClass("up").addClass("bottom").attr("title","向下缩放"),e.find(".first").removeClass("bottom").addClass("left").attr("title","向左缩放");break;case"max":e.attr("status","bottom-max"),t.removeClass("bottom").addClass("up").attr("title","向上展开"),e.find(".first").removeClass("left").addClass("bottom").attr("title","向下缩放");break;case"left-max":e.attr("status","max"),t.removeClass("right").addClass("bottom").attr("title","向下缩放"),e.find(".first").removeClass("bottom").addClass("left").attr("title","向左缩放")}},Page.cssTableThird=function(){var t=$(".data-list");t.attr("status","min"),t.find(".second").removeClass("bottom").addClass("right").attr("title","向右展开"),t.find(".first").removeClass("left").addClass("up").attr("title","向上展开")},Page.cssTableTitleClick=function(){var t=($(".container-point").width(),getWindowHeight()-58,$(".data-list"));"min"==t.attr("status")&&(t.attr("status","left-max"),t.find(".first").removeClass("up").addClass("bottom").attr("title","向下缩放"),t.find(".second").removeClass("bottom").addClass("right").attr("title","向右展开"))},Page.changeIconBox=function(){var t=$(this);$(".icon-selector .box").hide(),$(t.attr("target")).show()},Page.initPoiIcos=function(){var t="";t+='<li data-ico="none"><span class="none">无</span></li>';for(var e=1;56>e;e++){var a=e+"";a=a.length<2?"0"+a:a,t+='<li data-ico="icon-font'+a+'"><span class="iconfont icon-font'+a+'"></span></li>'}$(".icon-selector .box.ico ul").html(t),$(".icon-selector .ico li").click(Page.changeIconFont)},Page.getDeomoAttr=function(){for(var t=["data-size","data-color","data-color-path","data-back","data-ico"],e=["16","e51c23","red","default",""],a={},i=$(".icon-demo"),o=t.length;o--;){var r=t[o],n=i.attr(r);a[r]=n&&n.length>0&&"null"!=n?n:e[o]}return a},Page.changeIconBack=function(){$(".icon-selector .back li").removeClass("action");var t=$(this).addClass("action"),e=t.attr("data-back"),a=$(".icon-demo").removeAttr("data-use-custom-ico");$(".icon-selector .custom li.action").removeClass("action");var i=Page.getDeomoAttr(),o=Dituhui.Point.Style.getStyleSize(i["data-size"],e,i["data-color"]);a.css({"background-image":"url("+urls.server+"/resources/assets/map/"+i["data-color-path"]+"/"+e+".svg)",width:o.size.w+"px",height:o.size.h+"px",margin:o.offset.margin}).attr("data-back",e),$(".branch-icon-popup").attr("data-back",e).removeAttr("data-customfileid"),Dituhui.Point.setPopupDivStyle(),$(".icon-demo > span").removeClass().addClass("iconfont "+i["data-ico"]).css({color:"#"+o.color,"line-height":o.offset.line_height+"px"}),$(".icon-save-container").is(":hidden")&&($('input[name="appearance"]').val(e),$('input[name="customfileid"]').val(""))},Page.changeIconSize=function(t){$(".icon-size").val(t.value),Page.selectIconSize(t.value)},Page.inputIconSize=function(){var t=$(".icon-size"),e=Number(t.val());return e=Number(e),isNaN(e)||e>48||8>e?(Dituhui.showHint("尺寸必须是8-48之间的整数"),void t.val(Page.slider.slider("getValue"))):(Page.slider.slider("setValue",e),void Page.selectIconSize(e))},Page.disableIco=function(t){t=Number(t);var e=$('.icon-selector .ico li[data-ico!="none"]'),a=$('.icon-selector .ico li[data-ico="none"]');12>t?($(".icon-selector .ico li").removeClass("action"),a.addClass("action"),e.addClass("disabled").unbind("click")):e.removeClass("disabled").unbind("click").click(Page.changeIconFont)},Page.selectIconSize=function(t){var e=$(".icon-demo").removeAttr("data-use-custom-ico");$(".icon-selector .custom li.action").removeClass("action"),12>t&&(e.attr("data-ico","none"),$(".branch-icon-popup").attr("data-ico","none")),Page.disableIco(t);var a=Page.getDeomoAttr(),i=Dituhui.Point.Style.getStyleSize(t,a["data-back"],a["data-color"]);e.css({width:i.size.w+"px",height:i.size.h+"px",margin:i.offset.margin,"background-image":"url("+urls.server+"/resources/assets/map/"+a["data-color-path"]+"/"+a["data-back"]+".svg)"}).attr("data-size",t),$(".branch-icon-popup").attr("data-size",t).removeAttr("data-customfileid"),Dituhui.Point.setPopupDivStyle(),$(".icon-demo > span").removeClass().addClass("iconfont "+a["data-ico"]).css({"font-size":t+"px",color:"#"+i.color,"line-height":i.offset.line_height+"px"}),$(".icon-save-container").is(":hidden")&&($('input[name="appsize"]').val(t),$('input[name="customfileid"]').val(""))},Page.changeIconColor=function(){$(".icon-selector .color li").removeClass("action");var t=$(this).addClass("action"),e=t.attr("data-color"),a=$(".icon-demo").removeAttr("data-use-custom-ico");$(".icon-selector .custom li.action").removeClass("action");var i=(Page.getDeomoAttr(),Dituhui.Point.Style.getStyleSize(a.attr("data-size"),a.attr("data-back"),e));a.attr({"data-color":e,"data-color-path":t.attr("data-color-path")}).css({width:i.size.w+"px",height:i.size.h+"px",margin:i.offset.margin,"background-image":"url("+urls.server+"/resources/assets/map/"+t.attr("data-color-path")+"/"+a.attr("data-back")+".svg)"}),$(".icon-demo > span").removeClass().addClass("iconfont "+a.attr("data-ico")).css({"font-size":t.attr("data-size")+"px",color:"#"+i.color,"line-height":i.offset.line_height+"px"}),$(".branch-icon-popup").attr("data-color",e).removeAttr("data-customfileid"),Dituhui.Point.setPopupDivStyle(),$(".icon-save-container").is(":hidden")&&($('input[name="appcolor"]').val(e),$('input[name="customfileid"]').val(""))},Page.changeIconFont=function(){$(".icon-selector .ico li").removeClass("action");var t=$(this).addClass("action"),e=$(".icon-demo").attr("data-ico",t.attr("data-ico")).removeAttr("data-use-custom-ico");$(".icon-selector .custom li.action").removeClass("action");var a=Page.getDeomoAttr(),i=Dituhui.Point.Style.getStyleSize(a["data-size"],a["data-back"],a["data-color"]);e.css({width:i.size.w+"px",height:i.size.h+"px",margin:i.offset.margin,"background-image":"url("+urls.server+"/resources/assets/map/"+a["data-color-path"]+"/"+a["data-back"]+".svg)"}),$(".branch-icon-popup").attr("data-ico",t.attr("data-ico")).removeAttr("data-customfileid"),Dituhui.Point.setPopupDivStyle(),$(".icon-demo > span").removeClass().addClass("iconfont "+t.attr("data-ico")).css({"font-size":t.attr("data-size")+"px",color:"#"+i.color,"line-height":i.offset.line_height+"px"}),$(".icon-save-container").is(":hidden")&&($('input[name="apppic"]').val(t.attr("data-ico")),$('input[name="customfileid"]').val(""))},Page.selectCustomIco=function(){$(".icon-selector .custom ul li:not(.upload-custom-icon)").removeClass("action").attr({title:"选择"});var t=$(this).parent("li:not(.upload-custom-icon)").addClass("action").removeAttr("title"),e=Dituhui.Point.Style.getStyleSize(t.attr("data-height"),"transparent","fff");$(".icon-demo").attr({"data-use-custom-ico":"true"}).css({"background-image":"url("+t.find("img.ico").attr("src")+")",width:t.attr("data-width")+"px",height:t.attr("data-height")+"px",margin:e.offset.margin}),$(".icon-demo > span").removeClass(),$(".branch-icon-popup").attr("data-customfileid",t.attr("data-path")),Dituhui.Point.setPopupDivStyle(),$(".icon-save-container").is(":hidden")&&$('input[name="customfileid"]').val(t.attr("data-id"))},Page.showEditIconStyle=function(){var t=$(this),e=t.find(".icon-branch"),a={},i=$('button[data-option="save-icon-style"]'),o=$("#txt_styleName");"add"==t.attr("data-type")?(a=Dituhui.Point.Style.defaultStyle,a.name="",i.attr("data-type","add"),$(".delete-point-style").hide()):($(".delete-point-style").show(),i.removeAttr("data-type"),a.name=e.attr("data-name"),a.back=e.attr("data-back"),a.size=e.attr("data-size"),a.color=e.attr("data-color"),a.ico=e.attr("data-ico"),a.id=e.attr("data-id"),a.img=e.attr("data-img"),a.groupid=e.attr("data-groupid")),o.val(a.name),"default"===t.attr("data-attr")?(""===e.attr("data-id")?i.attr("data-type","add"):i.removeAttr("data-type"),$("#txt_branchGroup").val("0").attr("disabled","true"),$(".delete-point-style").hide().unbind("click")):($("#txt_branchGroup").val(a.groupid?a.groupid:"0").removeAttr("disabled"),$(".delete-point-style").unbind("click").click(function(){var t="确定要删除该样式？<br>";t+="删除后该样式下的网点将全部还原为默认样式。",Dituhui.Modal.alert(t,Map.Style.remove,{"data-id":a.id})})),Page.setIconSelector(a)},Page.setIconSelector=function(t){$('.data-list .content[data-display="table"]').hide(),$('.data-list .content[data-display="icon"]').show(),$(".tab-icon-list").hide(),$(".tab-edit").show(),$("#txt_styleName").val(t.name),$("#txt_branchGroup").val(t.groupid?t.groupid:"0"),$(".icon-demo + .bottom").html(t.name);var e=$(".icon-demo");$(".icon-selector .back li").removeClass("action"),$('.icon-selector .back li[data-back="'+t.back+'"]').addClass("action"),Page.slider.slider("setValue",Number(t.size)),$(".icon-size").val(t.size),Page.disableIco(t.size),$(".icon-selector .color li").removeClass("action"),$('.icon-selector .color li[data-color="'+t.color+'"]').addClass("action"),$(".icon-selector .ico li").removeClass("action"),t.ico&&t.ico.length>0?$('.icon-selector .ico li[data-ico="'+t.ico+'"]').addClass("action"):$('.icon-selector .ico li[data-ico="none"]').addClass("action"),$(".icon-selector .custom li:not(.upload-custom-icon)").removeClass("action");var a=$('.icon-selector .custom li[data-path="'+t.img+'"]').addClass("action"),i=$(".icon-selector .color li.action");if(e.attr({"data-back":t.back,"data-size":t.size,"data-color-path":i.attr("data-color-path"),"data-color":t.color,"data-ico":t.ico,"data-img":t.img}),t.img&&t.img.length>0){var o=Dituhui.Point.Style.getStyleSize(a.attr("data-height"),"transparent","fff");e.attr({"data-use-custom-ico":"true"}).css({"background-image":"url("+urls.server+"/pointService/getImg?path="+t.img+")",width:a.attr("data-width")+"px",height:a.attr("data-height")+"px",margin:o.offset.margin}),$(".icon-demo > span").removeClass(),$('li[data-option="show-icon-box"][target=".icon-selector .custom"]').click()}else{e.removeAttr("data-use-custom-ico");var o=Dituhui.Point.Style.getStyleSize(t.size,t.back,e.attr("data-color"));e.css({width:o.size.w+"px",height:o.size.h+"px",margin:o.offset.margin,"background-image":"url("+urls.server+"/resources/assets/map/"+i.attr("data-color-path")+"/"+t.back+".svg)"}),$(".icon-demo > span").removeClass().addClass("iconfont "+t.ico).css({"font-size":t.size+"px",color:"#"+o.color,"line-height":o.offset.line_height+"px"}),$('li[data-option="show-icon-box"][target=".icon-selector .back"]').click()}t.id?e.attr("data-id",t.id):e.removeAttr("data-id"),Dituhui.User.isTop||$(".icon-edit-container .icon-selector").hide()},Page.hideIconEdit=function(){$(".tab-edit").hide(),$(".tab-icon-list").show()},Page.changeGroupSelect=function(){{var t=$(this),e=$("#txt_branchGroup option:selected").text();$("#txt_branchGroup").val()}if($("#txt_styleName").val(e),$(".icon-demo + .bottom").html(e),"add-new"==t.val())return void(10==Dituhui.Point.Group.data.length?Dituhui.showHint("最多只可创建10个分组，有更多需求请联系商务"):($(".data-branchgroup-add").fadeIn("fast"),$(".text-branchgroup-add").val(""),$('input[name="styleid"], input[name="stylename"], input[name="groupid"]').val("")));if("remove-group"==t.val()){var a=Dituhui.Point.Group.data;if(0==a.length)return void Dituhui.showHint("当前没有网点分组数据");for(var i=a.length,o="";i--;){var r=a[i];o+='<option value="'+r.id+'">'+Dituhui.setStringEsc(r.groupname)+"</option>"}return $("#txt_styleName").val("默认样式"),$(".icon-demo + .bottom").html("默认样式"),$(".select-groups-toremove").html(o),$(".data-branchgroup-remove").fadeIn("fast"),void Map.Group.switchStyle(Dituhui.Point.Style.defaultStyle,!0)}return"none"==t.val()||"0"==t.val()?($('input[name="styleid"], input[name="stylename"], input[name="groupid"]').val(""),$("#txt_styleName").val("默认样式"),$(".icon-demo + .bottom").html("默认样式"),Map.Group.switchStyle(Dituhui.Point.Style.defaultStyle,!0),void $(".delete-point-style").addClass("hide")):($(".delete-point-style").removeClass("hide"),$("#txt_styleName").val(e),$(".icon-demo + .bottom").html(e),$(".select-group-popup").val(t.val()),$('input[name="groupid"]').val(t.val()),void(t.hasClass("icon-style-input")&&Map.Group.getStyle(t.val())))},Page.reSetSelect=function(){$(".branch-group").val("none"),$('input[name="groupid"]').val("0"),$("input#txt_styleName").val("")},Page.initPoiUpdateStyle=function(){"min"==$(".data-list").attr("status")&&$(".data-list .head .tab-text").click();var t=$(this),e={};e.name=t.attr("data-stylename"),e.back=t.attr("data-back"),e.size=t.attr("data-size"),e.color=t.attr("data-color"),e.ico=t.attr("data-ico"),e.groupid=t.attr("data-groupid"),e.img="",""!=t.attr("data-customfileid")?($(".icon-demo").attr("data-use-custom-ico","true"),e.img=t.attr("data-customfileid"),$('li[data-option="show-icon-box"][target=".icon-selector .custom"]').click()):$(".icon-demo").removeAttr("data-use-custom-ico"),$('input[name="appearance"]').val(e.back),$('input[name="appsize"]').val(e.size),$('input[name="appcolor"]').val(e.color),$('input[name="apppic"]').val(e.ico),$('input[name="appcustom"]').val(e.img);(!e.groupid||""==e.groupid||"0"==e.groupid)&&e.name.length>0?($("#txt_styleName").val(e.name),$("#txt_branchGroup").val(e.groupid?e.groupid:"0").attr("disabled","true")):($("#txt_styleName").val(e.name),$("#txt_branchGroup").val(e.groupid?e.groupid:"0").removeAttr("disabled")),$(".icon-save-container").hide(),Page.setIconSelector(e)};var rotateAngle=0,galleria_zoom=0;Page.viewPictures=function(t){rotateAngle=0,galleria_zoom=0,Galleria.destroy&&Galleria.destroy(),0==Galleria.getLoadedThemes().length&&Galleria.loadTheme(urls.server+"/resources/js/public/galleria/themes/classic/galleria.classic.min.js"),Galleria.run("#images",{dataSource:t,image_crop:!0,transition:"fade",maxScaleRatio:1,thumbCrop:!1}),$(".show-img-btn.zoom-in").unbind("click").click(function(){if(!(galleria_zoom>=5)){var t=$($(".images").data("galleria").getActiveImage()),e=t.width(),a=t.height();t.width(1.2*e),t.height(1.2*a);var i=t.parent(".galleria-image").width()/2-t.width()/2;t.css("left",i);var o=t.parent(".galleria-image").height()/2-t.height()/2;t.css("top",o),galleria_zoom++}}),$(".show-img-btn.turn-left").unbind("click").click(function(){rotateAngle-=90,$($(".images").data("galleria").getActiveImage()).rotate({animateTo:rotateAngle})}),$(".show-img-btn.turn-right").unbind("click").click(function(){rotateAngle+=90,$($(".images").data("galleria").getActiveImage()).rotate({animateTo:rotateAngle})}),$(".show-img-btn.full-img").unbind("click").click(function(){var t=$(".images").data("galleria").getActiveImage();window.open(t.src.split("@")[0])}),$(".show-img-btn.shut").click(function(){$(".view-pictures").addClass("hide")}),$(".show-img-btn.zoom-out").unbind("click").click(function(){if(!(-5>=galleria_zoom)){var t=$($(".images").data("galleria").getActiveImage()),e=t.width(),a=t.height();t.width(e/1.2),t.height(a/1.2);var i=t.parent(".galleria-image").width()/2-t.width()/2;t.css("left",i);var o=t.parent(".galleria-image").height()/2-t.height()/2;t.css("top",o),galleria_zoom--}})},Map.Style={},Map.Style.editHandler=function(){var t=$(".icon-demo"),e=$(this);if(!t.attr("data-use-custom-ico")){var a={appearance:t.attr("data-back"),apppic:t.attr("data-ico")};if(!("transparent"!=a.appearance&&""!=a.appearance||""!=a.apppic&&"none"!=a.apppic))return void Dituhui.showHint("外观和图案不允许都为无")}var i=$("#txt_styleName").val(),o=$("#txt_branchGroup").val();if((!o||"0"==o||"add-new"==o)&&"默认样式"!=i)return void Dituhui.showHint("请选择分组");if("add"==e.attr("data-type")){if((!o||"0"==o||"add-new"==o)&&"默认样式"===i)return void Dituhui.Modal.alert("将更新所有默认样式，确定继续？",Map.Style.add);Map.Style.add()}else{e.attr("data-poiid")?$("button.btn-save-border").attr({"data-poiid":e.attr("data-poiid"),"data-styleid":e.attr("data-styleid")?e.attr("data-styleid"):""}):$("button.btn-save-border").removeAttr("data-poiid").removeAttr("data-styleid");var r="";r=o&&"0"!=o&&"add-new"!=o?"将更新所属分组为“"+$("#txt_branchGroup option:selected").text()+"”的图标样式，确定继续？":"默认样式"===i?"将更新所有默认样式，确定继续？":"将更新名称为“"+i+"”的图标样式，确定继续？",Dituhui.Modal.alert(r,Map.Style.edit)}},Map.Style.add=function(){var t={},e=$(".icon-demo");t=e.attr("data-use-custom-ico")?{customfileid:$(".icon-selector .custom li.action").attr("data-id")}:{appearance:e.attr("data-back"),appsize:e.attr("data-size"),appcolor:e.attr("data-color"),apppic:e.attr("data-ico")};var a=$("#txt_styleName").val();t.stylename=a,"默认样式"===a&&(t.allflag=1);var i=$("#txt_branchGroup").val();i&&"0"!=i&&"add-new"!=i||(i=""),t.groupid=i,Dituhui.Point.Style.add(t,function(){Dituhui.showPopover("保存样式成功"),Map.Style.search(),Map.searchBranches(),$(".tab-edit").hide(),$(".tab-icon-list").show(),Dituhui.Modal.hide()},function(t){Dituhui.showHint(t),Dituhui.Modal.hide()})},Map.Style.edit=function(){var t=$(this),e={},a=$(".icon-demo");e=a.attr("data-use-custom-ico")?{customfileid:$(".icon-selector .custom li.action").attr("data-id")}:{appearance:a.attr("data-back"),appsize:a.attr("data-size"),appcolor:a.attr("data-color"),apppic:a.attr("data-ico"),customfileid:""};var i=$("#txt_styleName").val();e.stylename=i,"默认样式"==i&&(e.allflag="1");var o=$("#txt_branchGroup").val();o&&"0"!=o&&"add-new"!=o||(o=""),e.groupid=o,e.styleid=a.attr("data-id"),t.attr("data-poiid")&&(e.pointid=t.attr("data-poiid"),e.styleid=t.attr("data-styleid")?t.attr("data-styleid"):""),Dituhui.Point.Style.edit(e,function(){Dituhui.showPopover("保存样式成功"),Dituhui.Modal.hide(),Map.Style.search(),$(".tab-edit").hide(),$(".tab-icon-list").show(),$("button.btn-save-border").removeAttr("data-type").removeAttr("data-poiid").removeAttr("data-styleid"),Map.searchBranches()},function(t){Dituhui.showHint(t)})},Map.Style.search=function(){Dituhui.Point.Style.search()},Map.Style.remove=function(){var t=$(this),e=t.attr("data-id");Dituhui.Modal.hide(),Dituhui.Point.Style.remove(e,function(){Dituhui.showPopover("自定义样式删除成功"),Map.Style.search(),Page.hideIconEdit(),Map.searchBranches()},function(t){Dituhui.showHint(t)})},Map.Group={},Map.Group.search=function(){Dituhui.Point.Group.search()},Map.Group.add=function(){var t=$.trim($(".text-branchgroup-add").val());if(""==t||0==t.length)return void Dituhui.showHint("分组名称不能为空");if("无"==t)return void Dituhui.showHint("分组名称不能为“无”");var e={groupname:t};Dituhui.Point.Group.add(e)},Map.Group.removeHandler=function(){$(".data-branchgroup-remove").hide();var t=$(".select-groups-toremove").val(),e=$(".select-groups-toremove").find("option:selected").text();Dituhui.Modal.alert('确定要删分组"'+e+'"？<br>删除后该分组下的网点将全部还原为默认样式，无所属分组。',function(){Dituhui.Point.Group.remove(t)})},Map.Group.getStyle=function(t){Dituhui.Point.Group.getStyle(t,function(t,e){Map.Group.switchStyle(t,e)},function(){})},Map.Group.switchStyle=function(t,e){t.stylename=$("#txt_branchGroup option:selected").text();var a;$(".icon-selector .back li, .icon-selector .color li, .icon-selector .ico li, .icon-selector .custom li").removeClass("action");var i=t;"undefined"!=typeof e&&e||(i={back:t.appearance?t.appearance:"",ico:t.apppic?t.apppic:"",color:t.appcolor?t.appcolor:"",size:t.appsize?t.appsize:"",img:t.appcustom?t.appcustom.replace(/\\/g,"/"):"",width:t.def1?t.def1.split(",")[0]:16,height:t.def1?t.def1.split(",")[1]:16,color_path:Dituhui.Point.Style.getColor(t.appcolor).path,id:t.id}),i.color_path||(i.color_path=i.colorpath);var o=$(".icon-demo");if(i.img||t.appcustom){a=Dituhui.Point.Style.getStyleSize(i.height,"transparent","fff");var r=i.width,n=i.height;o.css({width:r+"px",height:n+"px",margin:a.offset.margin,"background-image":"url("+urls.server+"/pointService/getImg?path="+i.img+")"}).attr("data-use-custom-ico","true"),$('.icon-selector .custom li[data-path="'+i.img+'"]').addClass("action"),$('input[name="customfileid"]').val($(".icon-selector .custom li.action").attr("data-id")),$('li[data-option="show-icon-box"][target=".icon-selector .custom"]').click()}else a=Dituhui.Point.Style.getStyleSize(i.size,i.back,i.color),o.css({width:a.size.w+"px",height:a.size.h+"px",margin:a.offset.margin,"background-image":"url("+urls.server+"/resources/assets/map/"+i.color_path+"/"+i.back+".svg)"}),o.find("span").removeClass().addClass("iconfont "+i.ico).css({"font-size":i.size+"px",color:"#"+a.color,"line-height":a.offset.line_height+"px"}),$('.icon-selector .back li[data-back="'+i.back+'"]').addClass("action"),Page.slider.slider("setValue",Number(i.size)),Page.disableIco(i.size),$(".icon-size").val(i.size),$('.icon-selector .color li[data-color="'+i.color+'"]').addClass("action"),$('.icon-selector .ico li[data-ico="'+i.ico+'"]').addClass("action");o.attr({"data-back":i.back,"data-ico":i.ico,"data-color":i.color,"data-size":i.size,"data-img":i.img,"data-color-path":i.color_path,"data-id":i.id}),$(".branch-icon-popup").attr({"data-back":i.back,"data-ico":i.ico,"data-color":i.color,"data-size":i.size,"data-customfileid":i.img}),Dituhui.Point.setPopupDivStyle(),$('input[name="appearance"]').val(i.back),$('input[name="appsize"]').val(i.size),$('input[name="appcolor"]').val(i.color),$('input[name="apppic"]').val(i.ico),$('input[name="appcustom"]').val(i.img),$('input[name="styleid"]').val(i.id)},Map.CustomIcon={},Map.CustomIcon.data=[],Map.CustomIcon.search=function(){Dituhui.Point.CustomIcon.search()},Map.CustomIcon.add=function(){var t=$("#txt_import_custom_icon").val();""!=t&&0!=t.length&&(Dituhui.showMask(),$("#form_upload_custom_icon").ajaxSubmit({timeout:15e3,error:function(){Dituhui.hideMask(),Dituhui.showHint("上传失败")},success:function(t){Dituhui.hideMask(),t.isSuccess?($("#txt_import_custom_icon").val(""),Map.CustomIcon.search()):Dituhui.showHint(t.info?t.info:"上传失败")}}))},Map.CustomIcon.remove=function(){Dituhui.Point.CustomIcon.remove($(".btn-delete-custom-icon").attr("data-id"))},Map.showMobilePointWindow=function(){Dituhui.Point.SearchMapsFromMobile(function(t){for(var e="",a=t.length,i=0;a>i;i++){var o=t[i];"MARKER"==o.app_name&&(e+='<option value="'+o.id+'">',e+=o.title,e+="</option>")}$("#select_mpoint").html(e).find("option:first").prop("selected","selected"),$(".sync-mobile-point").removeClass("hide")},function(t){Dituhui.showHint(t?t:"未获取到您在大众版的点标记地图")})},Map.searchMobilePoint=function(){var t=$("#select_mpoint").val();return t&&""!=t?void Dituhui.Point.SearchFromMobile({mapurl:"http://c.dituhui.com/maps/"+t+"/get_markers"},function(t){$(".sync-mobile-point").addClass("hide"),0==t.result?Dituhui.showPopover("采集到0个网点"):Dituhui.Modal.loaded_right("采集到"+t.result+"个网点",function(){Map.searchBranches(),Dituhui.Modal.hide()})},function(t){Dituhui.showHint(t?t:"网点采集失败")}):void Dituhui.showHint("请选择一个点标记地图")};var Cars={data_type:[],data_cars:[],selected_cars_ids:"",selected_cars_license:"",selected_cars:[]};Cars.init=function(){Cars.search(),0===Cars.data_type.length&&Cars.searchType()},Cars.search=function(){Dituhui.showMask();var t=$("#pager_cars"),e=Number(t.attr("page"))+1,a={curPage:e},i=$("#txt_license").val();""!=i&&(a.lisence=i);var o=$("#txt_sim").val();""!=o&&(a.sim=o);var r=$(".select-car-type").val();null!=r&&"-1"!=r&&(a.type=r),$.ajax({type:"GET",async:!0,url:urls.server+"/pointService/queryCars?",data:a,dataType:"json",success:function(t){return Dituhui.hideMask(),t&&t.result&&t.result.total>0?(Cars.data_cars=t.result,void Cars.showCars()):(Dituhui.showPopover("查询到0条车辆数据"),void Cars.clear())},error:function(){Dituhui.hideMask(),Dituhui.showPopover("查询到0条车辆数据"),Cars.clear()}})},Cars.showCars=function(){for(var t=Cars.data_cars.rows.concat(),e=t.length,a="",i=0;e>i;i++){var o=t[i];a+="<tr>";var r=Cars.getSelected(o.id);a+='<td><input type="checkbox" class="select-car" data-id="'+o.id+'" data-license="'+o.license+'"',a+=r?' checked="true"':"",a+=" ></td>",a+="<td>"+(i+1)+"</td>",a+="<td>"+o.license+"</td>",a+="<td>"+o.terminalCode+"</td>",a+="<td>"+o.sim+"</td>",a+="<td>"+o.typeName+"</td>",a+="<td>"+o.driverName+"</td>",a+="</tr>"}$(".table-cars tbody").html(a),$(".data-cars").fadeIn("fast");var n=Dituhui.setPage(Cars.data_cars.records,Cars.data_cars.page-1,"'pager_cars'");$("#pager_cars > ul").html(n),$("#pager_cars").show(),$(".select-car").unbind("click").click(function(){var t=$(this),e=t.prop("checked");e?Cars.selectCar(t.attr("data-id"),t.attr("data-license")):(Cars.removeSelectCar(t.attr("data-id")),$(".select-all-car").prop("checked",!1))})},Cars.selectAll=function(){var t=$(this).prop("checked");$(".select-car").each(t?function(){var t=$(this),e=t.prop("checked");e||(t.prop("checked",!0),Cars.selectCar(t.attr("data-id"),t.attr("data-license")))}:function(){var t=$(this),e=t.prop("checked");e&&(t.prop("checked",!1),Cars.removeSelectCar(t.attr("data-id")))})},Cars.selectCar=function(t,e){var a=Cars.selected_cars.concat(),i=a.length;if(0===i)return Cars.selected_cars.push({id:t,license:e}),!1;for(var o=i;o--;){var r=a[o];if(r.id===t)return!1}Cars.selected_cars.push({id:t,license:e})},Cars.removeSelectCar=function(t){var e=Cars.selected_cars.concat(),a=e.length;if(0===a)return!1;for(var i=a;i--;){var o=e[i];if(o.id===t){e=e.splice(i);break}}Cars.selected_cars=e.concat()},Cars.getSelected=function(t){var e=Cars.selected_cars.concat(),a=e.length;if(0===a)return!1;for(var i=a;i--;){var o=e[i];if(o.id===t)return!0}return!1},Cars.searchType=function(){var t={type:19};$.ajax({type:"GET",async:!0,url:urls.server+"/pointService/queryCarTypes?",data:t,dataType:"json",success:function(t){if(t.isSuccess&&t.result){0===t.result.length?Dituhui.showPopover("未查询到车辆类型数据"):(Cars.data_type=t.result,Cars.showDataType())}else Dituhui.showPopover("获取车辆类型失败")},error:function(){Dituhui.showPopover("获取车辆类型失败")}})},Cars.showDataType=function(){var t=Cars.data_type.concat();if(0!==t.length){for(var e=t.length,a='<option value="-1" selected="true">全部</option>',i=0;e>i;i++){var o=t[i];a+='<option value="'+o.code+'">'+o.name+"</option>"}$(".select-car-type").html(a)}},Cars.clear=function(){$("#pager_cars").attr("page","1").hide(),$(".table-cars tbody").html(""),Cars.selected_cars=[],Cars.selected_cars_license="",Cars.selected_cars_ids="",$(".select-all-car").prop("checked",!1)},Cars.sure=function(){for(var t="",e="",a=Cars.selected_cars.concat(),i=a.length;i--;){var o=a[i];""!==t&&(t+="_",e+=","),t+=o.id,e+=o.license}selected_cars_ids=t,selected_cars_numbers=e,$("#txt_car_license").val(selected_cars_numbers),$("#txt_car_ids").val(selected_cars_ids),$(".data-cars").fadeOut("fast")},Cars.selectAllCar=function(){$(".select-car").each(function(){var t=$(this),e=t.prop("checked");e||(t.prop("checked",!0),Cars.selectCar(t.attr("data-id"),t.attr("data-license")))}),$(".select-all-car").prop("checked",!0)},Map.current_map="sm",Map.toTiandituMap=function(){if("tdt"!==Map.current_map){var t=map.getCenter(),e=map.getZoom();layer_tdt_img=new SuperMap.Layer.Tianditu({projection:"EPSG:4326"}),layer_tdt_label=new SuperMap.Layer.Tianditu({projection:"EPSG:4326",isLabel:!0}),"sm"===Map.current_map?map.removeLayer(layer_map):"google"===Map.current_map&&map.removeLayer(layer_google),map.addLayer(layer_tdt_img),map.setLayerIndex(layer_tdt_img,0),map.setBaseLayer(layer_tdt_img),map.addLayer(layer_tdt_label),map.setLayerIndex(layer_tdt_label,1),map.removeControl(controls_zoombars[0]),map.removeControl(controls_zoombars[1]),controls_zoombars=[],controls_zoombars=[new SuperMap.Control.PanZoomBar({showSlider:!0}),new SuperMap.Control.Navigation({dragPanOptions:{enableKinetic:!0}})],map.addControls(controls_zoombars),t=Dituhui.Coords.sm2tdt(t),map.setCenter(t,e-1),Map.current_map="tdt"}},Map.toSuperMap=function(){if("sm"!==Map.current_map){var t=map.getCenter(),e=map.getZoom();"tdt"===Map.current_map?(map.removeLayer(layer_tdt_img),map.removeLayer(layer_tdt_label)):"google"===Map.current_map&&map.removeLayer(layer_google),layer_map=new SuperMap.Layer.CloudLayer({url:urls.map_img}),map.addLayer(layer_map),map.setLayerIndex(layer_map,0),map.setBaseLayer(layer_map),map.removeControl(controls_zoombars[0]),map.removeControl(controls_zoombars[1]),controls_zoombars=[],controls_zoombars=[new SuperMap.Control.PanZoomBar({showSlider:!0}),new SuperMap.Control.Navigation({dragPanOptions:{enableKinetic:!0}})],map.addControls(controls_zoombars),t=Dituhui.Coords.tdt2sm(t),map.setCenter(t,e+1),Map.current_map="sm"}},Map.toGoogleMap=function(){if("google"!==Map.current_map){var t=map.getCenter(),e=map.getZoom();"tdt"===Map.current_map?(map.removeLayer(layer_tdt_img),map.removeLayer(layer_tdt_label)):"sm"===Map.current_map&&map.removeLayer(layer_map),layer_google_img=new SuperMap.Layer.Google("google_img",{version:"3",sphericalMercator:!0}),map.addLayer(layer_google_img),map.setLayerIndex(layer_google_img,0),map.setBaseLayer(layer_google_img),map.removeControl(controls_zoombars[0]),map.removeControl(controls_zoombars[1]),controls_zoombars=[],controls_zoombars=[new SuperMap.Control.PanZoomBar({showSlider:!0}),new SuperMap.Control.Navigation({dragPanOptions:{enableKinetic:!0}})],map.addControls(controls_zoombars),"tdt"===Map.current_map&&(t=Dituhui.Coords.tdt2sm(t)),map.setCenter(t,e),Map.current_map="google"
}},Map.refreshDataAfterChangeMap=function(){if(layer_branches.visibility&&layer_branches.features.length>0&&Map.searchBranches(),layer_boundry.visibility&&layer_boundry.features.length>0){var t=$(".mcity");Dituhui.SMCity.GetBoundryByCode(t.attr("admincode"),t.attr("level"))}layer_region.visibility&&layer_region.features.length>0&&Map.searchRegions()};var drag=null,layer_edit_temp=null;Map.isDragging=!1,Map.enableEdit=function(){var t=layer_edit_branch.features[0];layer_edit_temp=new SuperMap.Layer.Vector("edit_temp"),map.addLayers([layer_edit_temp]);var e=new SuperMap.Geometry.Point(t.geometry.x,t.geometry.y),a=t.attributes,i=t.style,o=new SuperMap.Feature.Vector(e,a,i);layer_edit_temp.addFeatures(o),drag=new SuperMap.Control.DragFeature(layer_edit_temp),map.addControl(drag),drag.activate(),Map.isDragging=!0,drag.onComplete=function(e,a){var i=map.getLonLatFromPixel(a);if(null!=Map.popup?(Map.popup.hide(),Map.popup.lonlat=i,Map.popup.show()):1===t.attributes.type&&Map.openAddBranchPopup(i),Map.regeocode(i),Baidu&&Baidu.using){var o=Baidu.restoreCoord(i.lon,i.lat);i.lon=o.x,i.lat=o.y}$('input[name="smx"]').val(i.lon),$('input[name="smy"]').val(i.lat);var o=Dituhui.metersToLatLon(new SuperMap.LonLat(i.lon,i.lat));$(".smx-popup").val(o.lon.toFixed(2)),$(".smy-popup").val(o.lat.toFixed(2)),Map.needCaculateCoord=!1}},Map.endDragBranch=function(){layer_edit_temp&&(layer_edit_temp.removeAllFeatures(),drag.deactivate(),map.removeControl(drag),drag=null,map.removeLayer(layer_edit_temp,!0),layer_edit_temp.destroy(),layer_edit_temp=null,Map.isDragging=!1)},Map.Pictures={},Map.Pictures.search=function(t){var e=$("#txt_upload_point_picture_pointid").val();$(".ul-point-pictures li.normal").remove(),Dituhui.Point.Pictures.search(e,function(t){for(var e=t.length,a="",i=0;e>i;i++){var o=t[i];a+='<li class="normal">',a+='	<img src="'+urls.server+"/pointService/getImg?path="+o.filepath.replace(/\\/g,"/")+'">',a+='	<div class="del" title="删除" data-id="'+o.id+'"></div>',a+="</li>"}$(".add-point-pictures").before(a),$(".preview-img").show(),e>4?$(".add-point-pictures").hide():$(".add-point-pictures").show();var r='<img src="'+urls.server+"/pointService/getImg?path="+t[0].filepath.replace(/\\/g,"/")+'">';r+='<div class="count"><span>'+e+"张</span></div>",$(".photo:not(.edit)").removeClass("none").html(r).unbind("click").click(function(){Map.Pictures.viewPictures(),$(".view-pictures").removeClass("hide")}),$(".photo.add:not(.edit)").removeClass("add"),$(".ul-point-pictures .del").unbind("click").click(Map.Pictures.remove),$(".upload-pictures-title").html("图集("+e+")")},function(){$(".upload-pictures-title").html("图集"),$(".add-point-pictures").show(),$(".ul-point-pictures li.normal").remove(),$(".preview-img").hide(),t?$(".photo").removeClass("none").addClass("add").html('<div class="caption"><span>上传图片<span></div>').unbind("click").click(function(){Map.Pictures.viewPictures(),$(".upload-pictures").removeClass("hide")}):$(".photo").removeClass("none").unbind("click").addClass("none").html("")})},Map.Pictures.upload=function(){var t=document.getElementById("txt_upload_point_picture");if(urls.ie_case){if(""==t.value)return Dituhui.showHint("请选择文件"),!1;var e=t.value,a=e.split("\\");return e=a[a.length-1],div.html(e),!0}var i=t.files;if(!i||i.length<1)return Dituhui.showHint("请选择文件"),!1;var o=i[0];return o.size>2048e3?(Dituhui.showHint("文件大于2M，请重新选择"),!1):""==$("#txt_upload_point_picture_pointid").val()?(Dituhui.showHint("获取网点ID失败"),!1):($(".add-point-pictures").addClass("load"),void $("#form_upload_point_picture").ajaxSubmit({timeout:3e4,error:function(){Dituhui.showHint("上传失败"),$(".add-point-pictures").removeClass("load")},success:function(t){if($(".add-point-pictures").removeClass("load"),t&&t.result){Dituhui.showPopover("上传成功"),$(".preview-img").show();var e="";e+='<li class="normal">',e+='	<img src="'+urls.server+"/pointService/getImg?path="+t.result.picPath.replace(/\\/g,"/")+'">',e+='	<div class="del" title="删除" data-id="'+t.result.picid+'"></div>',e+="</li>",$(".add-point-pictures").before(e),$(".ul-point-pictures .del").unbind("click").click(Map.Pictures.remove),Map.Pictures.refreshPictures(),$(".upload-pictures-title").html("图集("+$(".ul-point-pictures li.normal").length+")")}else Dituhui.showHint(t&&t.info?t.info:"上传失败，请稍候重试");var a=$("#txt_upload_point_picture");a.after(a.clone().val("")),a.remove()}}))},Map.Pictures.remove=function(){var t=$(this);Dituhui.Point.Pictures.remove(t.attr("data-id"),function(){Dituhui.showPopover("删除成功"),t.parent("li").remove(),$(".add-point-pictures").show(),Map.Pictures.refreshPictures(),$(".upload-pictures-title").html("图集("+$(".ul-point-pictures li.normal").length+")")},function(){Dituhui.showHint("删除失败")})},Map.Pictures.refreshPictures=function(){var t=$(".ul-point-pictures li.normal").length;if(0==t){var e='<div class="caption"><span>上传照片</span></div>';return $(".pictures .photo.edit").html(e).unbind("click").click(function(){$(".upload-pictures").removeClass("hide")}),$(".preview-img").hide(),void $(".photo:not(.edit)").addClass("add")}t>4&&$(".add-point-pictures").hide();var a=$(".ul-point-pictures li.normal:first-child img").attr("src"),i='<img src="'+a+'">';i+='<div class="count"><span>'+t+"张</span></div>",$(".photo:not(.edit), .preview-img").html(i).unbind("click").click(function(){Map.Pictures.viewPictures(),$(".view-pictures").removeClass("hide")}),$(".photo.add:not(.edit)").removeClass("add")},Map.Pictures.viewPictures=function(){var t=[];$(".ul-point-pictures li.normal").each(function(){var e=$(this).find("img").attr("src");t.push({image:e})}),Page.viewPictures(t)};var Baidu={};Baidu.layer=null,Baidu.using=!1,Baidu.init=function(){Baidu.layer=new SuperMap.Layer.Baidu,$("a.to-baidu").click(Baidu.use)},Baidu.use=function(){if(Baidu.using!==!0){var t=Map.checkAction();if(t){var e=map.getCenter(),a=map.getZoom();Map.unuse(),Baidu.using=!0,Baidu.layer=new SuperMap.Layer.Baidu,map.addLayer(Baidu.layer),map.setLayerIndex(Baidu.layer,0),map.setBaseLayer(Baidu.layer);var i=Baidu.getCoord(e.lon,e.lat);map.setCenter(new SuperMap.LonLat(i.x,i.y),a-2),Baidu.redrawBoundry(),Map.redrawDataPoints(),$(".map-copyright").html("&copy; 2015 Baidu - GS(2015)2650号 - Data &copy; NavInfo & CenNavi"),$(".nav-tools .second-menu a").removeClass("action").addClass("normal"),$("a.to-baidu").removeClass("normal").addClass("action")}}},Baidu.unuse=function(){Baidu.using&&(Baidu.using=!1,map.removeLayer(Baidu.layer,!1))},Baidu.getCoord=function(t,e,a){var i;i="undefined"==typeof a||"meters"==a?Dituhui.metersToLatLon(new SuperMap.LonLat(t,e)):new SuperMap.LonLat(t,e),t=i.lon,e=i.lat;var o=52.35987755982988,r=Math.sqrt(t*t+e*e)+2e-5*Math.sin(e*o),n=Math.atan2(e,t)+3e-6*Math.cos(t*o);bdLon=r*Math.cos(n)+.0065,bdLat=r*Math.sin(n)+.006;var s=Baidu.coord.convertLL2MC(bdLon,bdLat);return s},Baidu.restoreCoord=function(t,e,a){var i=Baidu.coord.convertMC2LL(t,e),o=i.x-.0065,r=i.y-.006,n=52.35987755982988,s=Math.sqrt(o*o+r*r)-2e-5*Math.sin(r*n),l=Math.atan2(r,o)-3e-6*Math.cos(o*n),c=s*Math.cos(l),u=s*Math.sin(l);if("undefined"==typeof a||"meters"==a){var d=Dituhui.latLonToMeters(new SuperMap.LonLat(c,u));return{y:d.lat,x:d.lon}}return new SuperMap.LonLat(c,u)},Baidu.redrawBoundry=function(){for(var t=layer_boundry.features,e=[],a=t.length;a--;){for(var i=t[a],o=i.attributes,r=o.geo.points.length,n=[],s=0;r>s;s++){var l=o.geo.points[s],c=Baidu.getCoord(l.x,l.y);n.push(c)}var u=Dituhui.Zone.DrawRegion(o.geo.parts,n),d=new SuperMap.Feature.Vector(u,o,i.style);e.push(d)}layer_boundry.removeAllFeatures(),layer_boundry.addFeatures(e),layer_boundry.redraw()},Baidu.coord={},Baidu.coord.EARTHRADIUS=6370996.81,Baidu.coord.MCBAND=[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],Baidu.coord.LLBAND=[75,60,45,30,15,0],Baidu.coord.LL2MC=[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],Baidu.coord.MC2LL=[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],Baidu.coord.getRange=function(t,e,a){return null!=e&&(t=Math.max(t,e)),null!=a&&(t=Math.min(t,a)),t},Baidu.coord.getLoop=function(t,e,a){for(;t>a;)t-=a-e;for(;e>t;)t+=a-e;return t},Baidu.coord.converter=function(t,e,a){var i=a[0]+a[1]*Math.abs(t),o=Math.abs(e)/a[9],r=a[2]+a[3]*o+a[4]*o*o+a[5]*o*o*o+a[6]*o*o*o*o+a[7]*o*o*o*o*o+a[8]*o*o*o*o*o*o;i*=0>t?-1:1,r*=0>e?-1:1;var n={x:i,y:r};return n},Baidu.coord.convertLL2MC=function(t,e){var a=null;t=Baidu.coord.getLoop(t,-180,180),e=Baidu.coord.getRange(e,-74,74);for(var i=Baidu.coord.LLBAND.length,o=0;i>o;o++)if(e>=Baidu.coord.LLBAND[o]){a=Baidu.coord.LL2MC[o];break}if(null!=a)for(var o=Baidu.coord.LLBAND.length-1;o>=0;o--)if(e<=-Baidu.coord.LLBAND[o]){a=Baidu.coord.LL2MC[o];break}return Baidu.coord.converter(t,e,a)},Baidu.coord.convertMC2LL=function(t,e){var a=null;t=Math.abs(t),e=Math.abs(e);for(var i=Baidu.coord.MCBAND.length,o=0;i>o;o++)if(e>=Baidu.coord.MCBAND[o]){a=Baidu.coord.MC2LL[o];break}var r=Baidu.coord.converter(t,e,a);return r},Map.initZoomControl=function(){$(".zoom-in").on("click",function(){map.zoomIn()}),$(".zoom-out").on("click",function(){map.zoomOut()}),$(".map-zoom").html(map.getZoom()),map.events.on({moveend:function(){$(".map-zoom").html(map.getZoom())}});var t=map.getControl("overviewMap");t&&(t.showToggle=function(t){this.maximizeDiv.style.display=t?"":"none",this.minimizeDiv.style.display=t?"none":"",t?$(".zoom-control").removeClass("higher"):$(".zoom-control").addClass("higher")})},Map.using=!0,Map.layer=null,Map.layer_townboundry=null,Map.showTownBoundry=!1,Map.cloud_resolutions=[156543.033928041,78271.5169640203,39135.7584820102,19567.8792410051,9783.93962050254,4891.96981025127,2445.98490512563,1222.99245256282,611.496226281409,305.748113140704,152.874056570352,76.4370282851761,38.218514142588,19.109257071294,9.55462853564701,4.77731426782351,2.38865713391175,1.19432856695588,.59716428347793],Map.init=function(t){var e=Dituhui.User.special?urls.map_img_special:urls.map_img;Map.layer=new SuperMap.Layer.CloudLayer({url:e}),map.addLayer(Map.layer),map.setLayerIndex(Map.layer,0),map.setBaseLayer(Map.layer),t===!0&&(Map.showTownBoundry=!0,Map.layer_townboundry=new SuperMap.Layer.CloudLayer({url:urls.map_townboundry,s:2,resolutions:Map.cloud_resolutions.slice(12)}),map.addLayer(Map.layer_townboundry),map.setLayerIndex(Map.layer_townboundry,1)),$("a.to-supermap").click(Map.use),$(".nav-tools .second-menu a").removeClass("action").addClass("normal"),$("a.to-supermap").removeClass("normal").addClass("action"),Map.initZoomControl()},Map.use=function(){if(!Map.using){var t=Map.checkAction();if(t){var e=map.getCenter(),a=map.getZoom();Baidu.unuse(),Map.layer=new SuperMap.Layer.CloudLayer({url:urls.map_img}),map.addLayer(Map.layer),map.setLayerIndex(Map.layer,0),map.setBaseLayer(Map.layer);var i=$("#btn_showCountryBoundry");i.length>0&&($("#btn_showCountryBoundry").parents("li.sec").removeClass("hide"),map.addLayer(layer_countyboundry),map.setLayerIndex(layer_countyboundry,1)),Map.showTownBoundry===!0&&(Map.layer_townboundry=new SuperMap.Layer.CloudLayer({url:urls.map_townboundry,s:2,resolutions:Map.cloud_resolutions.slice(12)}),map.addLayer(Map.layer_townboundry),map.setLayerIndex(Map.layer_townboundry,1)),Map.using=!0;var o=Baidu.restoreCoord(e.lon,e.lat);map.setCenter(new SuperMap.LonLat(o.x,o.y),a+2),Map.redrawBoundry(),Map.redrawDataPoints(),$(".map-copyright").html("&copy;2014 SuperMap - GS(2014)6070号-data&copy;Navinfo"),$(".nav-tools .second-menu a").removeClass("action").addClass("normal"),$("a.to-supermap").removeClass("normal").addClass("action")}}},Map.unuse=function(){if(Map.using){Map.using=!1,map.removeLayer(Map.layer,!1),Map.layer=null,Map.showTownBoundry===!0&&(map.removeLayer(Map.layer_townboundry,!1),Map.layer_townboundry=null);var t=$("#btn_showCountryBoundry");t.length>0&&($("#btn_showCountryBoundry").parents("li.sec").addClass("hide"),map.removeLayer(layer_countyboundry))}},Map.redrawBoundry=function(){for(var t=layer_boundry.features,e=[],a=t.length;a--;){var i=t[a],o=i.attributes,r=Dituhui.Zone.DrawRegion(o.geo.parts,o.geo.points),n=new SuperMap.Feature.Vector(r,o,i.style);e.push(n)}layer_boundry.removeAllFeatures(),layer_boundry.addFeatures(e)},Map.redrawDataPoints=function(){1==$("#btn_showBranch").prop("checked")&&Map.searchBranches(),1==$("#btn_showRegion").prop("checked")&&Map.searchRegions(),layer_cloudpois.features.length>0&&Map.searchFromCloud(),map.removeAllPopup()};