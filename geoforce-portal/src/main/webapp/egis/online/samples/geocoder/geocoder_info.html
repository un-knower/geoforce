<html>
<head>
    <title>地址匹配</title>
    <link rel="stylesheet" href="../style.css" type="text/css" />
</head>
<body>
    <div id="banner">
        地址匹配
    </div>
    <div id="text">
        <h4 class="dtH4">
            描述</h4>
        <ol type="1">
            <li>通过搜索关键字来确定地理位置
            </li>            
        </ol>
        <h4 class="dtH4">
            代码 (文件格式为 UTF-8)</h4>
        <div class="detailSample">
            <pre><code>
&lthtml&gt
&lthead&gt
    &ltmeta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt
	&lttitle&gtSuperMap Online Service Platform Sample - 地址匹配&lt/title&gt
	&ltscript type="text/javascript" src="http://services.supermapcloud.com/iserver/api?key=aXtbCHyF5FSZn6TeeEywSW0u8TDHrwC0IjFudD2j5xM%3D&v=1.1"&gt&lt/script&gt
    &ltscript type="text/javascript"&gt
        var map = null;
        var featuresLayer = null;
		var markerLayer = null;
		var poiSearchGroup = null; //poi搜索结果分组
		var poiManager = null;
		var layer = null;
		var poiIndex = 0;
        //初始化地图
        function onPageLoad() {
           layer = new SuperMap.Layer.CloudLayer();
			markerLayer = new SuperMap.Layer.Markers("maker");
			featuresLayer = new SuperMap.Layer.Vector();
			 map = new SuperMap.Map("mapDiv", { controls: [
                      new SuperMap.Control.PanZoomBar(),
                      new SuperMap.Control.Navigation({
                          dragPanOptions: {
                              enableKinetic: true
                          }
                      })], allOverlays: true
            });
			map.addLayer(layer);
			map.addLayer(featuresLayer);
			map.addLayer(markerLayer);
			map.setCenter(new SuperMap.LonLat(12958399.4681885, 4852082.44060595),11);
			createPoiService();
        }
		
		function createPoiService(){
			poiManager = new SuperMap.OSP.UI.POIManager(map);
			poiManager.markerLayer = markerLayer;
			poiSearchGroup = new SuperMap.OSP.UI.POIGroup("poi_searchGroupId");
			poiSearchGroup.caption = "poi搜索分组";
			var scaledContent = new SuperMap.OSP.UI.ScaledContent();
			scaledContent.content = '&ltimg src="images/num_map/1.png" /&gt';
			scaledContent.offset = new SuperMap.OSP.Core.Point2D(0, 0);
			poiSearchGroup.scaledContents = scaledContent;
			poiManager.addPOIGroup(poiSearchGroup);
		}

           //地址匹配
        //地址匹配
        function doGeocorder() {
            var myGeo = new SuperMap.OSP.ExtentionService.Geocoder();
			myGeo.url = "http://services.supermapcloud.com";
			// 将地址解析结果显示在地图上,并调整地图视野
			var address = document.getElementById("txtAddress").value;
			var geocoderParam = new SuperMap.OSP.ExtentionService.GeocodeParam();
			geocoderParam.dataSourceName = "zhongguo";
			geocoderParam.datasetName = "table_1P";
			geocoderParam.expectCount = 10;
			geocoderParam.startRecord = 0;
			geocoderParam.address = address;
			geocoderParam.province = document.getElementById("txtProvince").value;
			geocoderParam.city = document.getElementById("txtCity").value;
			var objInfo = document.getElementById("divGeocoder");
			objInfo.innerHTML = "正在获取数据，请稍候……";
			if (address != "") {
				myGeo.getPoint(geocoderParam, function(result) {
					//if (result) {
					//var entitys = result.entities;
					// var point = SuperMap.OSP.Core.Utility.latLonToMeters(result.entities[0].shape.point2Ds[0]);
					var point = result.entities[0].shape.point2Ds[0];
					//var tableHtml = "匹配到" + entitys.length + "个对象&ltbr/&gt&lttable&gt";
					if (!!point.x && !!point.y) {
						var x = point.x;
						var y = point.y;
						//document.getElementById("geocoderLng").innerHTML = x.toFixed(6);
						//document.getElementById("geocoderLat").innerHTML = y.toFixed(6);
						map.setCenter(new SuperMap.LonLat(x,y),16);
						var poi = new SuperMap.OSP.UI.POI("poi" + poiIndex++);
						poi.imageSize = new SuperMap.Size(18,18);
						poi.title = document.getElementById("txtAddress").value;
						var scaledContent = new SuperMap.OSP.UI.ScaledContent();
						scaledContent.content = '../../images/pin2.png';
						scaledContent.offset = new SuperMap.OSP.Core.Point2D(0, 0);
						poi.scaledContents = scaledContent;
						poi.position = new SuperMap.OSP.Core.Point2D(x, y);
						poiSearchGroup.addPOIs(poi);
						poiManager.editPOIGroup(poiSearchGroup);
						poiManager.refreshPOI();
						objInfo.innerHTML = "";
						//} else {
						// objInfo.innerHTML = "没查到结果";
						// }
						// objInfo.innerHTML = "";
					}
					},	function(error){
						objInfo.innerHTML = "很抱歉，你所输入的地址未找到匹配结果";
				}, "北京市");
			} else {
				alert("查询的地址不能为空");
			} 
        }
    &lt/script&gt

&lt/head&gt
&ltbody onload="onPageLoad()"&gt
    &ltdiv id="mapDiv" style="position: absolute; height:398px;width:498px; top: 0px;
        left: 0px;"&gt
    &lt/div&gt
    &ltdiv id="operatePanel" style="position: absolute;width: 200px; left: 500px; top: 0px;
        font-size: 12px; border: solid 1px #969696; z-index: 100; padding-bottom: 5px;
        background-image: url(../../images/toolbar_backgroundb.png);"&gt地址匹配：&lt/font&gt
        &ltp style="font-size: 12px"&gt
            在输入框中输入要查询的地址，点击地址匹配按钮，则程序会调用地址匹配服务，返回一个地址对应的经纬度坐标。
        &lt/p&gt
       &lttable&gt
				&lttr&gt
					&lttd&gt
						省：
					&lt/td&gt
					&lttd&gt
						&ltinput type="text" id="txtProvince" style="width: 110px;" value="四川省" /&gt 
					&lt/td&gt
				&lt/tr&gt
				&lttr&gt
					&lttd&gt
						市：
					&lt/td&gt
					&lttd&gt
						&ltinput type="text" id="txtCity" style="width: 110px;" value="成都市" /&gt 
					&lt/td&gt
				&lt/tr&gt
				&lttr&gt
					&lttd&gt
						地址：
					&lt/td&gt
					&lttd&gt
						&ltinput type="text" id="txtAddress" style="width: 110px;" value="棕榈南岸" /&gt
					&lt/td&gt
				&lt/tr&gt
				&lttr&gt
					&lttd&gt
						&ltinput type="button" value="地址匹配" onclick="doGeocorder()" /&gt
					&lt/td&gt
				&lt/tr&gt
			&lt/table&gt
    &lt/div&gt
    &ltdiv id="divGeocoder" style="clear: both"&gt
    &lt/div&gt
&lt/body&gt
&lt/html&gt



            </code></pre>
        </div>
    </div>
</body>
</html>
